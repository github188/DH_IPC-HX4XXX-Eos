!function(){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("heatmap",function(require,a,b){var c=require("jsCore/rpc"),d=require("jsCore/pageBase"),e=require("jsCore/plugin"),f=(require("common/common"),null),g=webApp.CHANNEL_NUMBER>1?1:0,h=0,i=null,j=!1,k=!1;b.exports=d.extend({init:function(){f=this,f.render()},render:function(){f.$("#heat_gif").hide(),f.$("[btn-for=onExport]").removeClass("disabled"),e.addEvent("HeatmapData",function(a){$clear(i),k=!0,f.$("#heat_gif").hide(),f.$("[btn-for=onExport]").removeClass("disabled"),f.$("#heat_tip").tip("success",tl("exportsuccess")+a),f._detachPro()})},leave:function(){j&&f._detachPro()},onExport:function(){h=(h+1)%65536,c.RadiometryManager.attachProc(h,g).done(function(){k=!1,j=!0,e.SnatchAtHeatmapData(),f.$("#heat_gif").show(),f.$("[btn-for=onExport]").addClass("disabled"),f.$("#heat_tipLong").text(tl("pleaseWaitLastDown")),setTimeout(function(){f.toFetch()},1e3)})},toFetch:function(){c.RadiometryManager.toFetch(g).done(function(a){if("Ready"==a.params.status){if(k)return;var b=0;i=setInterval(function(){b>600?(f._detachPro(),f.$("#heat_tip").tip("error",tl("failtureHeatmap")),$clear(i)):k&&$clear(i),b++},100)}else f._detachPro(),f.$("#heat_tip").tip("error",tl("busy"))})},_detachPro:function(){c.RadiometryManager.detachProc(h,g).done(function(){f.$("#heat_gif").hide(),f.$("[btn-for=onExport]").removeClass("disabled"),f.$("#heat_tipLong").text("")})}})})}(jQuery);