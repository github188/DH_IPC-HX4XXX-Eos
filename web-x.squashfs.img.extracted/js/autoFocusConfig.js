!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("autoFocus",function(require,b,c){var d=require("jsCore/rpc"),e=(require("jsCore/ability"),require("jsCore/plugin")),f=require("jsCore/pageBase");require("jsCore/modules/ptzPreset");var g=null,h=webApp.CHANNEL_NUMBER>1?1:0,i=null,j=null,k=null,l=null,m=null,n=null,o=null;c.exports=f.extend({init:function(){g=this,g.$("#a_f_presetCon").ptzPreset(h).ptzPreset("change",g._savePstRule,g._renderPstRule,h),d.ConfigManager.getDefault("PresetFocusROI").done(function(a){m=a[h]?a[h][0]:null}),g.bind(),g.render()},bind:function(){g.$("input[name=focusMode]").click(function(a){var b=g.$(a.target);"ROI"==b.val()?g._renderPstRule():(g.$("#a_f_presetCon").hide(),n&&e.DeleteOneIntelShape(n))})},render:function(){e.cover("#a_f_video",function(){e.SetRegionNum(0),e.SetModuleMode(1);var a="Monitor_0"+(h+1);login.chkAuthority(a)?(e.SetVisibleVideoWnd(1,h),e.ConnectRealVideoEx(h,h,0)):(e.SetVisibleVideoWnd(1,h),e.SetVideoWndTip(h,tl("noVideoAuthoity")))}),g._getRefresh(!1)},leave:function(){o&&e.DeleteAllIntelShape(o)},onDraw:function(){n&&e.DeleteOneIntelShape(n),n=e.CreateOneIntelShape(o,"RectangleShape","VideoAnalyzeConfig","RectangleShape","","","")},onClean:function(){n&&e.DeleteOneIntelShape(n)},_renderElements:function(){i&&i[h]&&("ROI"==i[h].Mode?(g.$("input[name=focusMode]:first").prop("checked",!0),g._renderPstRule()):"ColdSpot"==i[h].Mode?(g.$("input[name=focusMode]:eq(1)").prop("checked",!0),g.$("#a_f_presetCon").hide()):(g.$("input[name=focusMode]:last").prop("checked",!0),g.$("#a_f_presetCon").hide()))},_renderPstRule:function(){if(j=g.$("#a_f_presetCon").ptzPreset("get"),j&&g.$("#a_f_presetCon").show(),console.log("presetJson[curChannel]",l[h],"curPreset",j),k=l[h].filter(function(a){return a.PresetId==j})[0],!k){var b=a.extend(!0,{},m);b=j,l[h].push(b),k=l[h][l[h].length-1]}g.$("#a_f_presetEnable").prop("checked",k.Enable),o?g._creatROI():e.CreateOneIntelShapeContainer(h,"").done(function(a){o=a,g._creatROI()})},_savePstRule:function(){k.Enable=g.$("#a_f_presetEnable").prop("checked")},_creatROI:function(){n=n&&e.DeleteOneIntelShape(n);var a=k.Regions;a&&a.length>0&&(0!=a[0]||0!=a[1]||0!=a[2]||0!=a[3])&&(info={RectangleShape:[[a[0],a[1]],[a[2],a[3]]]},info=JSON.encode(info),n.CreateOneIntelShape(o,"RectangleShape","VideoAnalyzeConfig","RectangleShape","",info,"").done(function(a){n=a,e.SelectOneIntelShape(n,!0),e.SetOneIntelShapeThickness(n,2)}))},onDefault:function(){return d.ConfigManager.getDefault(["IntelligentFocus","PresetFocusROI"]).done(function(a){i=a[0].params.table,l=a[1].params.table,g._renderElements(),g.$("#a_f_tip").tip("success",tl("Defaultsuccess"))}).fail(function(){g.$("#a_f_tip").tip("error",tl("Defaultfailure"))}),!1},onRefresh:function(){return g._getRefresh(!0),!1},onSave:function(){var a=g.$("input[name=focusMode]:checked").val();return"ROI"==a?(i[h].Mode=a,g._savePstRule(),d.ConfigManager.setConfig(["IntelligentFocus","PresetFocusROI"],i,l).done(function(){g.$("#a_f_tip").tip("success",tl("Succeed in saving configure"))}).fail(function(){g.$("#a_f_tip").tip("error",tl("Saving failure"))})):("ColdSpot"==a||"HotSpot"==a)&&(i[h].Mode=a,d.ConfigManager.setConfig("IntelligentFocus",i).done(function(){g.$("#a_f_tip").tip("success",tl("Succeed in saving configure"))}).fail(function(){g.$("#a_f_tip").tip("error",tl("Saving failure"))})),!1},_getRefresh:function(a){d.ConfigManager.getConfig(["IntelligentFocus","PresetFocusROI"]).done(function(b){i=b[0].params.table,l=b[1].params.table,g._renderElements(),a&&g.$("#a_f_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){a&&g.$("#a_f_tip").tip("error",tl("Operateingfailure"))})}})})}(jQuery);