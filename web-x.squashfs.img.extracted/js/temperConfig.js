!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("temperature",function(require,b,c){var d,e,f,g=require("jsCore/rpc"),h=require("jsCore/ability"),i=require("jsCore/plugin"),j=require("jsCore/rpcLogin"),k=require("jsCore/PageBase"),l=null,m=0,n=!1,o=null,p=[],q=webApp.CHANNEL_NUMBER>1?1:0;c.exports=k.extend({init:function(){l=this,i.CheckFuncSupport(2).done(function(b){b?a("#temper_a_fullscreen").show():a("#temper_a_fullscreen").hide()}),a.when(h.get("TemperatureDifference")).done(function(a){n=a.Support,g.RadiometryManager.getCaps("All",q).done(function(a){e=a,l._initTab(),l.render()})})},_initTab:function(){var a=l.$(".u-tab"),b=l.$(".u-tab-content");l.tabs={},a.tab({switched:function(a,c){var d=l.tabs[c.from],e=l.tabs[c.to];d&&d.leave(),e?(e.render(),l.current=e):require.async(c.to,function(a){l.tabs[c.to]=new a({element:b.find("[data-page="+c.to+"]")}),l.current=l.tabs[c.to]})}})},render:function(){i.cover("#temper_video",function(){var a="Monitor_0"+(q+1);j.chkAuthority(a)?(i.SetVisibleVideoWnd(1,q),i.ConnectRealVideoEx(q,q,0)):(i.SetVisibleVideoWnd(1,q),i.SetVideoWndTip(q,tl("noVideoAuthoity")))})},leave:function(){d&&i.DeleteAllIntelShape(d),i.hide()},destory:function(){l.$(".u-tab").children().each(function(a,b){l.$(b).data("tabInstance").destory()})},onFullScreen:function(){return i.SetFullScreen(),!1}}),define("temper_item_params",function(require,b,c){var h,j,l,n=null,r=[],s=null,t=0,u=0,v=0,w=0,x=0,y=[],z=[],A=[],B=[],C=[],D=[],E=[],F=null,G=!0;c.exports=k.extend({init:function(){n=this,n.bind(),g.PTZ.getPresets(q).done(function(a){f=a,n._renderPresetList(),n.render()})},bind:function(){n.$("#temp_local_Emissivity").numberfield({min:e.ObjectEmissivity.Min.round(2),max:e.ObjectEmissivity.Max.round(2),allowNegative:!1,decimalPrecision:2}),n.$("#temp_local_Distance").numberfield({min:e.ObjectDistanceMeter.Min.round(),max:e.ObjectDistanceMeter.Max.round(),allowNegative:!1,allowDecimal:!1}),n.$("#temp_local_RefalectedTemp").numberfield({min:e.ReflectedTemperature.Min.round(1),max:e.ReflectedTemperature.Max.round(1),decimalPrecision:1}),n.$("#temp_alarm_Threshold").numberfield({min:-40,max:550,decimalPrecision:1}),n.$("#temp_alarm_TemperatureSlope").numberfield({min:-40,max:550,decimalPrecision:1}),n.$("#temp_alarm_Hysteresis").numberfield({min:0,allowNegative:!1,decimalPrecision:1}),n.$("#temp_alarm_Duration").numberfield({min:0,max:1e3,allowNegative:!1,allowDecimal:!1}),n.$("#temp_items_all").click(function(){a("#temp_showMeasureItems .temp_items_enable").prop("checked",n.$(this).prop("checked"))}),n.$("#temp_addItems").click(function(){var b=0,c=0,d=0;return a.each(r,function(a,e){"Line"==e.Type&&b++,"Spot"==e.Type&&c++,"Area"==e.Type&&d++}),b>e.Line.MaxLines||c>e.Spot.MaxSpots||d>e.Area.MaxAreas?void n.$("#temper_tip").tip("error",tl("w_tempeTypeAddMax")):r.length>=e.TotalNum?void n.$("#temper_tip").tip("error",tl("w_tempeAddMax")):void n.$("#temp_addItems_box").toggle()}),n.$("#temp_addItems_box .temp_types").click(function(){var a=n.$(this),b=a.prevAll().length;a.addClass("current").siblings().removeClass("current"),2==b?n.$("#temp_addItems_box .area_types").show():(n.$("#temp_addItems_box .area_types").hide(),n._addItemsSave(b))}),n.$("#temp_addItems_box .area_types").click(function(){var a=n.$(this),b=a.prevAll().length;a.addClass("current").siblings().removeClass("current"),n._addItemsSave(b)}),n.$("#temp_alarm_result").change(function(){n._onTempSlopeAlarmClick()}),a("#temp_redraw").click(function(){i.DeleteOneIntelShape(l[s]);var a,b=r[s],c=b.Type;"Spot"==c?i.CreateOneIntelShape(d,"Spot","VideoAnalyzeConfig","Spot",b.Name,"","").done(function(b){a=b}):"Line"==c?i.CreateOneIntelShape(d,"Line","VideoAnalyzeConfig","Line",b.Name,"","").done(function(b){a=b,i.SetOneIntelShapeThickness(a,2)}):"Polygon"==b.AreaSubType?i.CreateOneIntelShape(d,"Polygon","VideoAnalyzeConfig","Polygon",b.Name,"","").done(function(b){a=b,i.SetOneIntelShapeThickness(a,2)}):"Rect"==b.AreaSubType?i.CreateOneIntelShape(d,"RectangleShape","VideoAnalyzeConfig","RectangleShape",b.Name,"","").done(function(b){a=b,i.SetOneIntelShapeThickness(a,2)}):i.CreateOneIntelShape(d,"OvalShape","VideoAnalyzeConfig","OvalShape",b.Name,"","").done(function(b){a=b,i.SetOneIntelShapeThickness(a,2)}),l[s]=a}),n.$("#temp_params_content .ui-switch-icon").click(function(){var a=n.$(this).toggleClass("toggle").attr("data-link");new Fx.Slide(a).toggle()}),new Fx.Slide("temp_alarmbox").hide()},render:function(){p.contains(0)?n.$("#temper_presetcon").hide():n.$("#temper_presetcon").show(),a("#temp_redraw").show(),g.ConfigManager.getConfig("HeatImagingThermometry").done(function(a){F=a,n.$(".temp_unit").text("Centigrade"==F.TemperatureUnit?"ºC":"ºF"),F&&"Centigrade"==F.TemperatureUnit?n.$("#temp_alarm_Hysteresis").numberfield("max",10):n.$("#temp_alarm_Hysteresis").numberfield("max",18),i.CreateOneIntelShapeContainer(q,"").done(function(a){d=a}),n._getConfig(!1)}),i.addEvent("VideoAnalyzeConfig",function(b){var c,d=JSON.decode(b),e=null;e="Spot"==d.EventParam.ShapeName?d.EventParam.ShapeID:d.EventParam.ObjectID,a.each(l,function(a,b){i.SelectOneIntelShape(b,!1),b==e&&s!=a&&(n.$(".temp_items_tr").removeClass("ui-table-tr-current"),n.$("#temp_items_tr_"+a).addClass("ui-table-tr-current"),n._saveCurItem(),s=a,n._showParams())}),i.SelectOneIntelShape(l[s],!0),i.GetIntelShapeData(l[s]).done(function(a){c=JSON.decode(a),c||(c=d.ShapeData)}),"Spot"==r[s].Type?r[s].MeterRegion.Coordinates[0]=c.Spot:r[s].MeterRegion.Coordinates="Line"==r[s].Type?c.Line:"Polygon"==r[s].AreaSubType?c.Polygon:n._tansformCoordinate("Rect"==r[s].AreaSubType?c.RectangleShape:c.OvalShape)})},leave:function(){n.$("#temp_addItems_box").hide()},_renderPresetList:function(){null==o&&m>=0&&(o=m-0);var b=n.$("#temper_preset");b.empty(),p=[],null!=f&&0!=f.length&&webApp.DeviceType.contains("SD")?(n.$("#temper_presetcon").show(),a.each(f,function(a,c){b.append("<option value = '"+c.Index+"'>"+c.Index+"</option>"),p.push(c.Index)}),0!=o&&o?b.val(o):b.get(0).selectedIndex=0,o=b.val()-0):(p.push(0),b.append("<option value = '0'>0</option>"),n.$("#temper_presetcon").hide(),o=0),0!=o&&g.PTZ.gotoPreset(q,o),o=b.val()-0,b.change(function(){var a=[];n._saveCurItem(),null==j||0==j.length||null==j[0]?j=[]:a=j.filter(function(a){return a.PresetId!=o}),j=a.combine(r),o=b.val()-0,g.PTZ.gotoPreset(q,o),n._renderElement()})},_renderElement:function(){n._AnalyseData(),n._showMeasureItems()},_AnalyseData:function(){return null==j||0==j.length||null==j[0]?void(r=[]):void(r=j.filter(function(a){return a.PresetId==o}))},_showMeasureItems:function(){if(i.DeleteAllIntelShape(d),l=[],E=[],n.$("#temp_addItems_box").hide(),n.$("#temp_showMeasureItems").html(""),n.$("#temp_items_all").prop("checked",!0),n.$("#temp_params_content").hide(),t=0,u=0,v=0,polyonNum=0,w=0,x=0,E=[],y=[],A=[],z=[],B=[],C=[],D=[],null!=r&&0!=r.length){n.$("#temp_params_content").show();var b=(r.length,'<table cellpadding="0" cellspacing="0" >');a.each(r,function(a,c){0==c.Enable&&n.$("#temp_items_all").prop("checked",!1),b+=a%2?'<tr class="temp_items_tr" id="temp_items_tr_'+a+'">':'<tr class="temp_items_tr ui-table-tr-odd" id="temp_items_tr_'+a+'">';var d=c.Enable?"checked":"";b+='<td class="fn-widp10"><input class="temp_items_enable" id="temp_items_enable_'+a+'" checked='+d+' type="checkbox"/></td>',b+='<td class="fn-widp5">'+c.RuleId+":</td>","Spot"==c.Type?(t++,y.push(c.Name),b+='<td class="fn-widp5"><i class="i-flir-dpoint"></i></td>'):"Line"==c.Type?(u++,A.push(c.Name),b+='<td class="fn-widp5"><i class="i-flir-dline"></i></td>'):"Area"==c.Type&&(v++,z.push(c.Name),"Polygon"==c.AreaSubType?(B.push(c.Name),polyonNum++):"Rect"==c.AreaSubType?(C.push(c.Name),w++):(D.push(c.Name),x++),b+='<td class="fn-widp5"><i class="i-flir-darea"></i></td>'),b+='<td class="fn-widp65" ><span id="temp_items_name_'+a+'" class="i-flir-font temp_items_name" title="'+c.Name+'">'+c.Name+'</span><input type="text" id="temp_items_name_input_'+a+'" class=" i-flir-inputs temp_items_name_input fn-hide fn-width200" maxlength ="10"></td>',b+='<td class="temp_items_delete"><i id="temp_items_delete_'+a+'" class="i-flir-gdelect fn-marl2"></i></td>',b+="</tr>",E.push(c.RuleId)}),b+="</table>",n.$("#temp_showMeasureItems").html(b);var c=n.$("#temp_items_tr_"+s);c.length||(s=0),c.addClass("ui-table-tr-current"),n._showParams(),n._showFigure(),n.$("#temp_showMeasureItems tr").click(function(){var b=n.$(this),c=b.attr("id").replace(/[^\d]/g,"")-0;c!=s&&(n._saveCurItem(),s=c,n._showParams()),b.addClass("ui-table-tr-current").siblings().removeClass("ui-table-tr-current"),a.each(l,function(a,b){i.SelectOneIntelShape(b,!1)}),i.SelectOneIntelShape(l[c],!0)}),n.$("#temp_showMeasureItems .temp_items_enable").click(function(b){var c=n.$(b.target),d=c.attr("id").replace(/[^\d]/g,"")-0;r[d].Enable=c.prop("checked"),n.$("#temp_items_all").prop("checked",!0),a.each(r,function(a,b){0==b.Enable&&n.$("#temp_items_all").prop("checked",!1)})}),n.$("#temp_showMeasureItems .temp_items_delete").click(function(){var a=n.$(this).children("i").attr("id").replace(/[^\d]/g,"")-0;r.erase(r[a]),i.DeleteOneIntelShape(l[a]),l.erase(l[a]),s==a&&(s-=1),n._showMeasureItems()}),n.$("#temp_showMeasureItems .temp_items_name").dblclick(function(a){var b=n.$(a.target),c=b.attr("id").replace(/[^\d]/g,"")-0;b.hide(),n.$("#temp_items_name_input_"+c).show().val(b.text())}),n.$("#temp_showMeasureItems .temp_items_name_input").blur(function(){var a=n.$(this),b=a.val(),c=a.attr("id").replace(/[^\d]/g,"")-0;a.hide(),n.$("#temp_items_name_"+c).show().text(b),r[c].Name=b})}},_showFigure:function(){var b,c,e,f,g;a.each(r,function(a,h){c=h.Type,f=h.AreaSubType,"Spot"==c?(b=h.MeterRegion.Coordinates[0],b&&b.length>0?(e={Spot:b},e=JSON.encode(e)):e="",i.CreateOneIntelShape(d,"Spot","VideoAnalyzeConfig","Spot",h.Name,e,"").done(function(b){g=b,l[a]=g})):"Line"==c?(b=h.MeterRegion.Coordinates,b&&b.length>0?(e={Line:b},e=JSON.encode(e)):e="",i.CreateOneIntelShape(d,"Line","VideoAnalyzeConfig","Line",h.Name,e,"").done(function(b){g=b,l[a]=g,i.SetOneIntelShapeThickness(g,2)})):(b=h.MeterRegion.Coordinates,b&&b.length>0?(e={Polygon:b},e=JSON.encode(e)):e="","Polygon"==f?i.CreateOneIntelShape(d,"Polygon","VideoAnalyzeConfig","Polygon",h.Name,e,"").done(function(b){g=b,l[a]=g,i.SetOneIntelShapeThickness(g,2)}):"Rect"==f?(b&&b.length>0?(e={RectangleShape:[b[0],b[2]]},e=JSON.encode(e)):e="",i.CreateOneIntelShape(d,"RectangleShape","VideoAnalyzeConfig","RectangleShape",h.Name,e,"").done(function(b){g=b,l[a]=g,i.SetOneIntelShapeThickness(g,2)})):(b&&b.length>0?(e={OValShape:[b[0],b[2]]},e=JSON.encode(e)):e="",i.CreateOneIntelShape(d,"OvalShape","VideoAnalyzeConfig","OvalShape",h.Name,e,"").done(function(b){g=b,l[a]=g,i.SetOneIntelShapeThickness(g,2)}))),s==a?i.SelectOneIntelShape(l[s],!0):i.SelectOneIntelShape(l[a],!1)})},_showParams:function(){var a=r[s],b=a.LocalParameters,c=a.AlarmSetting[0],d=n.$("#temp_alarm_result");n.$("#temp_local_enable").prop("checked",b.Enable),n.$("#temp_local_Emissivity").val(b.ObjectEmissivity.round(2)),n.$("#temp_local_Distance").val(b.ObjectDistance),n.$("#temp_local_RefalectedTemp").val(b.ReflectedTemp.round(1)),n.$("#temp_alarm_enable").prop("checked",c.Enable),n.$("#temp_alarm_condition").val(c.AlarmCondition),"Spot"==a.Type?(d.empty(),d.append('<option value="Value">'+tl("w_temper_Aver")+"</option>").append('<option value="Slope">'+tl("w_temper_Slope")+"</option>")):"Line"==a.Type?(d.empty(),d.append('<option value="Max">'+tl("w_temper_Max")+"</option>").append('<option value="Min">'+tl("w_temper_Min")+"</option>").append('<option value="Aver">'+tl("w_temper_Aver")+"</option>").append('<option value="Slope">'+tl("w_temper_Slope")+"</option>").append('<option value="Diff">'+tl("w_TemperatureDifference")+"</option>")):(d.empty(),d.append('<option value="Max">'+tl("w_temper_Max")+"</option>").append('<option value="Min">'+tl("w_temper_Min")+"</option>").append('<option value="Aver">'+tl("w_temper_Aver")+"</option>").append('<option value="Std">'+tl("w_temper_Std")+"</option>").append('<option value="Mid">'+tl("w_temper_Mid")+"</option>").append('<option value="Slope">'+tl("w_temper_Slope")+"</option>").append('<option value="Diff">'+tl("w_TemperatureDifference")+"</option>")),d.val(c.Result),n._onTempSlopeAlarmClick(),n.$("#temp_alarm_Threshold").val(c.Threshold.round(1)),n.$("#temp_alarm_TemperatureSlope").val(c.Threshold.round(1)),n.$("#temp_alarm_Hysteresis").val(c.Hysteresis.round(1)),n.$("#temp_alarm_Duration").val(c.Duration),n.$("#temp_TemperSampPeriod").val(a.T/60)},_saveCurItem:function(){if(r&&r[s]){var a=r[s],b=a.LocalParameters;b.Enable=n.$("#temp_local_enable").prop("checked"),b.ObjectEmissivity=n.$("#temp_local_Emissivity").val()-0,b.ObjectDistance=n.$("#temp_local_Distance").val()-0,b.ReflectedTemp=n.$("#temp_local_RefalectedTemp").val()-0;var c=a.AlarmSetting[0];c.Enable=n.$("#temp_alarm_enable").prop("checked"),c.AlarmCondition=n.$("#temp_alarm_condition").val(),c.Result=n.$("#temp_alarm_result").val(),c.Threshold=n.$("#temp_alarm_Threshold").val()-0-c.Threshold==0?n.$("#temp_alarm_TemperatureSlope").val()-0:n.$("#temp_alarm_Threshold").val()-0,c.Hysteresis=n.$("#temp_alarm_Hysteresis").val()-0,c.Duration=n.$("#temp_alarm_Duration").val()-0,a.T=60*(n.$("#temp_TemperSampPeriod").val()-0)}},_addItemsSave:function(b){var c={Enable:!0,PresetId:o-0,RuleId:null,Name:"",Type:"Spot",AreaSubType:"Polygon",MeterRegion:{Coordinates:[]},T:3,AlarmSetting:[{Id:0,Enable:!1,Result:"Max",AlarmCondition:"Below",Threshold:20,Hysteresis:.1,Duration:30}],LocalParameters:{Enable:!0,ObjectEmissivity:F.ObjectEmissivity,ObjectDistance:F.ObjectDistance,ReflectedTemp:F.ReflectedTemperature}};a.each(E,function(a){E.contains(a+1)||(c.RuleId=a+1)}),null==c.RuleId&&(c.RuleId=t+u+v+1);var e=null;0==b?(c.Type="Spot",c.AlarmSetting[0].Result="Value",c.Name=tl("w_spot")+(t+1),c.Name=n._ishasSameName(c.Name,y,"spot"),i.CreateOneIntelShape(d,"Spot","VideoAnalyzeConfig","Spot",c.Name,"","").done(function(a){e=a})):1==b?(c.Type="Line",c.Name=tl("w_line")+(u+1),c.Name=n._ishasSameName(c.Name,A,"line"),i.CreateOneIntelShape(d,"Line","VideoAnalyzeConfig","Line",c.Name,"","").done(function(a){e=a,i.SetOneIntelShapeThickness(e,2)})):(c.Type="Area",3==b?(c.Name=tl("w_polyon")+(polyonNum+1),c.Name=n._ishasSameName(c.Name,B,"polyon"),i.CreateOneIntelShape(d,"Polygon","VideoAnalyzeConfig","Polygon",c.Name,"","").done(function(a){e=a,i.SetOneIntelShapeThickness(e,2)})):4==b?(c.AreaSubType="Rect",c.Name=tl("w_rect")+(w+1),c.Name=n._ishasSameName(c.Name,C,"rect"),i.CreateOneIntelShape(d,"RectangleShape","VideoAnalyzeConfig","RectangleShape",c.Name,"","").done(function(a){e=a,i.SetOneIntelShapeThickness(e,2)})):5==b&&(c.AreaSubType="Ellipse",c.Name=tl("w_ellipse")+(x+1),c.Name=n._ishasSameName(c.Name,D,"ellipse"),i.CreateOneIntelShape(d,"OvalShape","VideoAnalyzeConfig","OvalShape",c.Name,"","").done(function(a){e=a,i.SetOneIntelShapeThickness(e,2)}))),n._saveCurItem(),r.push(c),s=t+u+v,l[s]=e,n._showMeasureItems()},_onTempSlopeAlarmClick:function(){"Slope"==n.$("#temp_alarm_result").val()?(n.$("#temp_alarm_ThresholdDiv").hide(),n.$("#temp_alarm_TemperatureSlopeDiv").show()):(n.$("#temp_alarm_ThresholdDiv").show(),n.$("#temp_alarm_TemperatureSlopeDiv").hide())},_ishasSameName:function(b,c,d){return c&&c.contains(b)&&a.each(c,function(a){c.contains(tl("w_"+d)+(a+1))||(b=tl("w_"+d)+(a+1))}),b},onDefault:function(){return g.ConfigManager.getDefault("ThermometryRule").done(function(a){h=a,j=h[q],s=0,n._renderElement(),n.$("#temper_tip").tip("success",tl("Defaultsuccess"))}).fail(function(){n.$("#temper_tip").tip("error",tl("Defaultfailure"))}),!1},onRefresh:function(){return n._getConfig(!0),!1},onSave:function(){if(n._checkNoDraw(),n._checkSameName(),!G)return!1;var a=[],b=[];return q&&(a[0]=null),null==j||null==j[0]||0==j.length?a[q]=r:(b=j.filter(function(a){return a.PresetId!=o}),a[q]=b.combine(r)),g.ConfigManager.setConfig("ThermometryRule",a).done(function(){n._compareIsChange(a),n.$("#temper_tip").tip("success",tl("Succeed in saving configure"))}).fail(function(){n.$("#temper_tip").tip("error",tl("Saving failure"))}),!1},_checkSameName:function(){return a.each(r,function(b,c){return""==c.Name?(n.$("#temper_tip").tip("error",tl("w_mustName")),void(G=!1)):void a.each(r,function(a,b){return c.Name==b.Name&&c!=b?(n.$("#temper_tip").tip("error",tl("w_groupNameSame")),void(G=!1)):void 0})}),!0},_checkNoDraw:function(){var b=null,c=a.Deferred(),e=0;G=!0,0!=r.length&&null!=r[0]?(n._saveCurItem(),a.each(l,function(a,f){i.GetIntelShapeData(f).done(function(g){b=JSON.decode(g),b||(n.$("#temper_tip").tip("error",tl("Draw_RuleFirst")),G=!1,c.resolve()),"Area"==r[a].Type&&b.Polygon&&b.Polygon.length>7&&(n.$("#temp_items_tr"+a).addClass("ui-table-tr-current").siblings().removeClass("ui-table-tr-current"),i.DeleteOneIntelShape(f),n._saveCurItem(),s=a,n._showParams(),r[a].MeterRegion.Coordinates=[],b=[],info={Polygon:b},info=JSON.encode(info),i.CreateOneIntelShape(d,"Polygon","VideoAnalyzeConfig","Polygon","","","").done(function(a){var b;b=a,i.SetOneIntelShapeThickness(b,2),f=b}),n.$("#temper_tip").tip("error",tl("w_areaNotMoreSeven")),G=!1,c.resolve()),++e==l.length&&c.resolve()})})):c.resolve(),a.when(c).done(function(){})},_compareIsChange:function(b){var c,d,e=b[q],f={};g.ConfigManager.getConfig("TemperatureDifferenceOSD").done(function(b){d=b,c=d[q].Info,null==e||null==e[0]||0==e.length?c=null:(a.each(e,function(a,b){f[b.PresetId]||(f[b.PresetId]=[]),1==b.Enable&&f[b.PresetId].push(b.RuleId)}),c&&c.length>0&&a.each(c,function(a,b){f[b.PresetId]&&f[b.PresetId].contains(b.RuleId1)&&f[b.PresetId].contains(b.RuleId2)||c.erase(c[a])})),d[q].Info=c,g.ConfigManager.setConfig("TemperatureDifferenceOSD",d).done(function(){})})},_getConfig:function(a){g.ConfigManager.getConfig("ThermometryRule").done(function(b){h=b,j=h[q],s=0,n._renderElement(),a&&n.$("#temper_tip").tip("success",tl("Operateingsuccess"))}).fail(function(){n.$("#temper_tip").tip("error",tl("Operateingfailure"))})},_tansformCoordinate:function(a){return[[a[0][0],a[0][1]],[a[1][0],a[0][1]],[a[1][0],a[1][1]],[a[0][0],a[1][1]]]}})}),define("temper_item_comp",function(require,b,c){var f,h,j,l,m,n,p,r,s,t=null,u=null;c.exports=k.extend({init:function(){t=this,t.bind(),t.render()},bind:function(){t.$("#temp_alarm_Threshold2").numberfield({min:-40,max:550,decimalPrecision:1}),t.$("#temp_addCompItems").click(function(){if(j.length<2)return t.$("#temper_tip2").tip("error",tl("w_TwoRuleAtLeast")),!1;if(p.length>=e.TeperatureDifferenceOSD.Max)return t.$("#temper_tip2").tip("error",tl("w_tempeAddMax")),!1;addCompItem={Enable:!0,Id:0,PresetId:o-0,RuleId1:0,RuleId2:0,Mode:"Aver",AlarmCondition:"Below",Threshold:20},a.each(p,function(a){p.contains(a+1)||(addCompItem.Id=a+1)});var b,c=0;a.each(s,function(a){0==c&&(b=a-0),c++}),addCompItem.RuleId1=b,addCompItem.RuleId2=b,r=!0,u=addCompItem.Id,n.push(addCompItem),t._showMeasureItems()}),t.$("#temp_comp_all").click(function(){var b=t.$(this).prop("checked");t.$("#temp_showCompItems .temp_comp_enable").prop("checked",b),a.each(n,function(a,c){c.Enable=b})})},render:function(){a("#temp_redraw").hide(),t.$("#temper_presetcon").hide(),i.DeleteAllIntelShape(d),g.ConfigManager.getConfig(["ThermometryRule","TemperatureDifferenceOSD"]).done(function(a){f=a[0].params.table,h=f[q],t._AnalyseRule(),l=a[1].params.table,m=l[q].Info,t._renderElement()})},leave:function(){},_AnalyseRule:function(){return null==h||0==h.length||null==h[0]?void(j=[]):(j=h.filter(function(a){return a.PresetId==o}),s={},void a.each(j,function(a,b){1==b.Enable&&(s[b.RuleId]=b.Name)}))},_renderElement:function(){t._AnalyseData(),t._showMeasureItems()},_AnalyseData:function(){null==m||0==m.length?n=[]:(n=[],a.each(m,function(a,b){b.PresetId==o&&0!=b.RuleId1&&0!=b.RuleId2&&n.push(b)}))},_showMeasureItems:function(){if(p=[],t.$("#temp_showCompItems").empty(),t.$("#temp_params_content2").hide(),t.$("#temp_comp_all").prop("checked",!0),0!=n.length){var b='<table cellpadding="0" cellspacing="0">';a.each(n,function(a,c){0==c.Enable&&t.$("#temp_comp_all").prop("checked",!1),b+=a%2?'<tr class="temp_items_tr" id="compId_'+a+'">':'<tr class="temp_items_tr ui-table-tr-odd" id="compId_'+a+'">';var d=1==c.Enable?"checked":"none";b+='<td class="fn-widp10"><input class="temp_comp_enable" type="checkbox" checked = "'+d+'"></td>',b+='<td class="fn-widp10">"'+(c.Id+1)+':"</td>',b+='<td class="fn-textleft fn-widp65"><span ruleId="'+c.ruleId1+'"" class="spanRule spanRule1">"'+s[c.RuleId1]+'"</span><select class="rule rule1 fn-width70"></select> - <span ruleId="'+c.RuleId2+'" class="spanRule spanRule2">"'+s[c.RuleId2]+'"</span><select class="rule rule2 fn-width70"></select></td>',b+='<td class="temp_items_delete fn-textleft"><i id="temp_comp_delete_'+a+'" class="i-flir-gdelect fn-marl2"></i></td>',b+="</tr>",p.push(c.Id)}),b+="</table>",t.$("#temp_showCompItems").html(b),t.$("#temp_params_content2").show(),(null==u||0==t.$("#compId_"+u).length)&&t.$("#temp_showCompItems .temp_items_tr").length>0&&(u=t.$("#temp_showCompItems .temp_items_tr:first").attr("id").replace(/[^\d]/g,"")-0),t.$("compId_"+u).addClass("ui-table-tr-current"),t._showParams();var c=t.$("#temp_showCompItems .rule");c.hide(),a.each(s,function(a,b){c.append("<option value="+a+">"+tl(b)+"</option>")}),t.$("#temp_showCompItems tr").click(function(){var a=t.$(this),b=a.attr("id").replace(/[^\d]/g,"")-0;b!=u&&(t._saveCurItem(),u=b,t._showParams()),a.addClass("ui-table-tr-current").siblings().removeClass("ui-table-tr-current")}),t.$("#temp_showCompItems .temp_comp_enable").click(function(){var b=t.$(this),c=b.closest("tr").attr("id").replace(/[^\d]/g,"")-0;n[c].Enable=b.prop("checked"),t.$("#temp_comp_all").prop("checked",!0),a.each(n,function(a,b){0==b.Enable&&t.$("#temp_comp_all").prop("checked",!1)})}),t.$("#temp_showCompItems .temp_items_delete").click(function(){var a=t.$(this).children("i").attr("id").replace(/[^\d]/g,"")-0;n.erase(n[a]),p.erase(a),u==a&&(u-=1),t._showMeasureItems()}),t.$("#temp_showCompItems .spanRule").dblclick(function(){var a=t.$(this);a.hide().next("select").show()}),c.blur(function(){var a=t.$(this),b=a.closest("tr").attr("id").replace(/[^\d]/g,"")-0;a.hide().prev("span").text(s[a.val()]).show(),a.hasClass("rule1")?n[b].RuleId1=a.val()-0:n[b].RuleId2=a.val()-0}).change(function(){var a=t.$(this),b=a.closest("tr").attr("id").replace(/[^\d]/g,"")-0;a.hide().prev("span").text(s[a.val()]).show(),a.hasClass("rule1")?n[b].RuleId1=a.val()-0:n[b].RuleId2=a.val()-0}),r&&(t.$("#compId_"+u+" .spanRule").hide().text(""),t.$("#compId_"+u+" select").show(),r=!1)}},_showParams:function(){var a=u==n.length?n[0]:n[u];t.$("#temp_alarm_result2").val(a.Mode),t.$("#temp_alarm_condition2").val(a.AlarmCondition),t.$("#temp_alarm_Threshold2").val(a.Threshold.round(1))},_saveCurItem:function(){if(n&&n[u]){var a=n[u];a.Mode=t.$("#temp_alarm_result2").val(),a.AlarmCondition=t.$("#temp_alarm_condition2").val(),a.Threshold=t.$("#temp_alarm_Threshold2").val()-0}},_checkCanSave:function(){var b=!1,c=!1;return a.each(n,function(d,e){return e.RuleId1==e.RuleId2?void(b=!0):void a.each(n,function(a,b){return d!=a&&e.RuleId1==b.RuleId1&&e.RuleId2==b.RuleId2?void(c=!0):void 0})}),b?(t.$("#temper_tip2").tip("error",tl("w_wrongCompareRule")),!1):c?(t.$("#temper_tip2").tip("error",tl("w_notSameCompareRule")),!1):!0},onDefault:function(){return g.ConfigManager.getDefault("TemperatureDifferenceOSD").done(function(a){l=a,m=l[q].Info,t._renderElement(),t.$("#temper_tip2").tip("success",tl("Defaultsuccess"))}).fail(function(){t.$("#temper_tip2").tip("error",tl("Defaultfailure"))}),!1},onRefresh:function(){return g.ConfigManager.getConfig("TemperatureDifferenceOSD").done(function(a){l=a,m=l[q].Info,t._renderElement(),t.$("#temper_tip2").tip("success",tl("Operateingsuccess"))}).fail(function(){t.$("#temper_tip2").tip("error",tl("Operateingfailure"))}),!1},onSave:function(){if(!t._checkCanSave())return!1;t._saveCurItem();var b=[];return m&&a.each(m,function(a,c){c.PresetId!=o&&b.push(c)}),m=0==b.length?n:b.combine(n),l[q].EncodeBlend=!0,l[q].Info=m,g.ConfigManager.setConfig("TemperatureDifferenceOSD",l).done(function(){t.$("#temper_tip2").tip("success",tl("Succeed in saving configure"))}).fail(function(){t.$("#temper_tip2").tip("error",tl("Saving failure"))}),!1}})})})}(jQuery);