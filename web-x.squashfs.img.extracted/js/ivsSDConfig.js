!function(){define(function(require){function a(a){var b={w_Otheruserconfig:"其它用户正在配置！",w_completeConfigure:"全局配置",w_sceneConfigure:"场景配置",w_ruleConfigure:"规则配置",w_parameterConfigure:"参数配置",w_aptitudeTrackConfigure:"智能配置",w_startupAptitudeTrack:"启用智能功能",w_trackManner:"跟踪方式",w_alarmTrack:"报警跟踪",w_manualTrack:"手动跟踪",w_TrackStyle:"场景类型",w_singleSceneTrack:"单场景",w_multiplicitySceneTrack:"多场景",w_fullSceneTrack:"全景",w_ivs_SingleScene:"单场景",w_ivs_MultiScene:"多场景",w_ivs_FullScene:"全景",w_ivs_MultiSceneExtention:"多场景扩展",w_TrackTime:"跟踪时间",w_maxTrackDynameter:"最大跟踪倍率",w_furbishDefaultConfigureSucceed:"恢复默认配置成功",w_changeTimes:"变倍",w_setTrackDynameter:"设为跟踪倍率",w_scene:"场景",w_sceneMark:"场景号",w_sceneName:"场景名称",w_limitTrack:"限位跟踪",w_delete:"删除",w_Mark:"编号",w_settleTime:"停留时间",w_addScene:"增加场景",w_addPath:"添加路径",w_setScene:"设置场景",w_previewScene:"预览场景",w_scene1SetAndGet:"场景限位跟踪设置及获取",w_upLine:"上边界",w_downLine:"下边界",w_leftLine:"左边界",w_rightLine:"右边界",w_choiceTrackScene:"选择场景",w_addRule:"添加规则",w_StartRule:"启用规则",w_sequenceNumber:"序号",w_groupName:"规则名称",w_RuleStyle:"规则类型",w_protract:"绘制",w_checkType:"检测类型",TrafficRecognition:"交通场景",w_TrafficParking:"违章停车",w_AlarmWait:"报警等待时间",w_tp_allow_time:"允许停车时间",w_tp_code:"违章停车代码",w_tp_code_tip:"只支持输入字母、数字",w_tp_showname:"违章停车显示名称",w_tp_detail:"违章停车描述信息",w_ivs_upload_info:"上传全部车辆信息",w_wtEastToWest:"东向西",w_wtWestToEast:"西向东",w_wtSouthToNorth:"南向北",w_wtNorthToSouth:"北向南",w_ALL:"全部",w_coptTo:"复制到",w_areaSet:"区域及属性设置",w_alarmSet:"报警联动设置",TrafficCrossLane:"违章变道",appEventTrafficCrossLane:"违章变道",TrafficOverLine:"违章压线",appEventTrafficOverLine:"违章压线",TrafficRetrograde:"违章逆行",appEventTrafficRetrograde:"违章逆行","TrafficU-Turn":"违章掉头","appEventTrafficU-Turn":"违章掉头",TrafficVehicleInBusRoute:"违章占道",appEventTrafficVehicleInBusRoute:"违章占道",TrafficBacking:"违章倒车",appEventTrafficBacking:"违章倒车",TrafficParking:"违章停车",appEventTrafficParking:"违章停车",TrafficTollGate:"交通卡口",appEventTrafficTollGate:"交通卡口",XXX:"XXX"};if(void 0==b[a]){var c=Site.languages[Site.currentLanguage];return c&&(c[a]||c[a+" "]||"").trim()||a}return b[a]}var b=require("jsCore/rpc"),c=require("jsCore/plugin"),d=require("jsCore/ability");require("jsCore/modules/minPtzControl");var e=webApp.ALARM_OUT_NUMBER,f=jQuery.browser.ie,g=null,h=null,i=null,j=null,k=0,l=[],m=[],o=-1,p=-1,q=-1,r=-1,s={},t={},u=["Normal"],v=null,w=0,x=null,y=0,z=[],A=!0,B=!1,C=!1,D="Normal",E={};!function(){var e=Page.ivsSDConfig={Tab:[],init:function(){d.get("IVSCaps").done(function(a){u=a.SupportedScene,support_sceneTypes=a.IntelliTracker.SupportCategory}),e.IDevIntelliTracker=b.DevIntelliTracker,e.ConfigManager=b.ConfigManager,e.magic=b.MagicBox,e._getServiceList(),e.Tab.glogal.init(),e.Tab.scene.init(),e.Tab.rule.init(),e.Tab.para.init(),e.Tab.plan.init(),e.Tab.lane.init(),e.Tab.global.init(),e.translate(),e.bind(),e.render()},translate:function(){$("ivs_glogal_tab").set("text",a("w_completeConfigure")),$("ivs_scene_tab").set("text",a("w_sceneConfigure")),$("ivs_rule_tab").set("text",a("w_ruleConfigure")),$("ivs_para_tab").set("text",a("w_parameterConfigure")),$("ivs_lane_tab").set("text",a("w_lane")),$("ivs_help").addEvent("click",function(){openHelp("intellent.htm")}),$("page_ivs").translation()},render:function(){isEnable("is_notshow_help")&&$("ivs_help").setStyle("display","none"),$$(".ivs_tab_title.ui-tab-current")[0].hasClass("ui-tab-disabled")&&($$(".ivs_tab_title").removeClass("ui-tab-current"),$("ivs_glogal_tab").addClass("ui-tab-current")),$$(".ivs_tab_title.ui-tab-current").fireEvent("click"),e._stopIVS.delay(300),c.addEvent("OutPutStringInfo",function(a,b){Site.currentPage.is.ivsSDConfig&&"OutPutModuleRect"==a&&$("ivs_para_tab").hasClass("ui-tab-current")&&Page.ivsSDConfig.Tab.para.OutPutModuleRect(b),Site.currentPage.is.ivsSDConfig&&"OutPutRuleRect"==a&&Page.ivsSDConfig.Tab.rule.minGatherRegion(b),Site.currentPage.is.ivsSDConfig&&$("ivs_rule_tab").hasClass("ui-tab-current")&&"OutPutGlobalInfo"==a&&Page.ivsSDConfig.Tab.rule._OutPutGlobalRect(b),Site.currentPage.is.ivsSDConfig&&"OutPutFilterRect"==a&&($("ivs_rule_tab").hasClass("ui-tab-current")&&Page.ivsSDConfig.Tab.rule.setFilterValue(b),$("ivs_para_tab").hasClass("ui-tab-current")&&Page.ivsSDConfig.Tab.para.setFilterValue(b)),Site.currentPage.is.ivsSDConfig&&"OutPutGlobalLaneInfo"==a&&$("ivs_lane_tab").hasClass("ui-tab-current")&&Page.ivsSDConfig.Tab.lane.setFilterValue(b),Site.currentPage.is.ivsSDConfig&&"OutPutGlobalCalibrateInfo"==a&&Page.ivsSDConfig.Tab.global.OutPutGlobalCalibrateInfo(b),Site.currentPage.is.ivsSDConfig&&"OutPutCheckedInfo"==a&&Page.ivsSDConfig.Tab.global.OutPutCheckedInfo(b),Site.currentPage.is.ivsSDConfig&&"OutPutShapeRect"==a&&$("ivs_rule_tab").hasClass("ui-tab-current")&&Page.ivsSDConfig.Tab.rule.OutPutShapeRect(b),Site.currentPage.is.ivsSDConfig&&"OutPutDFilter"==a&&Page.ivsSDConfig.Tab.scene.cameraMark.ocxInfo(b)})},leave:function(){c.hide(),b.DevIntelliTracker.start()},_openIVSVideo:function(a,b){Site.currentPage.is.ivsSDConfig&&(c.cover("#"+a),c.SetModuleMode(2),c.ConnectRealVideo(0,1),void 0!=b&&b())},_getServiceList:function(){e.magic.getProductDefinition("IntelliTracker").done(function(a){A=a.Support,$("ivs_scene_setdyn").style.display=A?"":"none",$("ivs_sene_limit_wrap").style.display=A?"":"none",$("ivs_glogal_type_wrap").style.display=A?"":"none"}),isEnable("is_show_WideView")||e.magic.getProductDefinition("WideViewControl").done(function(a){var b=a.Support;F.varSetSupport(b),b&&F.requestGetConfig()})},_onTabTitleClick:function(){if(!$(this.id).hasClass("ui-tab-disabled")){var a=this.getProperty("data-for");t.close(),e.Tab[a].render(),$$(".ivs_tab_title").removeClass("ui-tab-current"),$$(".ivs_tab_con").setStyle("display","none"),this.addClass("ui-tab-current"),$("ivs_tab_"+a).setStyle("display","block")}},bind:function(){$$(".ivs_tab_title").addEvent("click",e._onTabTitleClick),$("ivs_help").addEvent("click",function(){openHelp("intellent.htm")}),s=new Dialog("ivs_popAlarmCfg",e._saveAlarmTime,"ivs_rule_day_confirm","ivs_rule_day_cancel",a("w_TimeAlarmPeriod"),e._cancelAlarmTime),s.setPosition(10,3),t=new Dialog("ivs_scene_dialog",e._deleteScene,"ivs_scene_dialog_confirm","ivs_scene_dialog_cancel",a("w_deleteScene")),t.setPosition(410,380)},_isgotoScene:function(a){-1!=a&&Page.ivsSDConfig.IDevIntelliTracker.gotoScene(a)},_getSid:function(a){for(var b=0;b<g[k].Scene.length;b++)if(g[k].Scene[b].PresetID==a)return b;return 0},_deleteScene:function(){var a=g[k].Scene[q].PresetID;if(g[k].Scene.erase(g[k].Scene[q]),C){var b;b="Scene"+a,h[k][b]=null}g[k].SingleScene.PresetID==a&&g[k].Scene.length>0&&(g[k].SingleScene.PresetID=g[k].Scene[0].PresetID),g[k].Scene.length<1&&(g[k].SingleScene.PresetID=-1,q=-1),e._deleteMsceneEx(a),g[k].Scene&&Page.ivsSDConfig.Tab.scene._showScene(!0),t.close()},_deleteMsceneEx:function(a){g[k].MultiScene.TourPath=g[k].MultiScene.TourPath||[];for(var b=0;b<g[k].MultiScene.TourPath.length;b++){var c=g[k].MultiScene.TourPath[b].PresetID;c==a&&(g[k].MultiScene.TourPath.erase(g[k].MultiScene.TourPath[b]),--b)}},_gotoScene:function(b){Page.ivsSDConfig.IDevIntelliTracker.gotoScene(b).fail(function(){remarkDisplay("ivs_scene_remark",a("Operateingfailure"),3e3,1)})},_saveAlarmTime:function(){for(var a=j[k][o].EventHandler.TimeSection,b=[],c=0;6>c;c++)b[c]=$("ivs_c_ts"+c).checked?"1 ":"0 ",b[c]+=$("ivs_i_t"+c+"0").value+":"+$("ivs_i_t"+c+"1").value+":"+$("ivs_i_t"+c+"2").value+"-"+$("ivs_i_t"+c+"3").value+":"+$("ivs_i_t"+c+"4").value+":"+$("ivs_i_t"+c+"5").value;for(var c=0;7>c;c++)$("ivs_rule_day_"+c).checked&&(a[c]=b);s.close()},_cancelAlarmTime:function(){$("ivs_popAlarmCfg").style.top="-10000px",Page.ivsSDConfig._openIVSVideo.delay(10,"","ivs_rule_vedio")},_drawArea:function(){(!$("ivs_rule_filter_draw").hasClass("ui-button-disabled")&&$("ivs_rule_tab").hasClass("ui-tab-current")||$("ivs_para_tab").hasClass("ui-tab-current"))&&$("ocx").AddShape(3,"","filter",0,-1)},_delArea:function(){(!$("ivs_rule_filter_draw").hasClass("ui-button-disabled")&&$("ivs_rule_tab").hasClass("ui-tab-current")||$("ivs_para_tab").hasClass("ui-tab-current"))&&($("ocx").DeleteShape("filter"),e._setFilterValue(0,0,8191,8191))},_setFilterValue:function(a,b,c,d){$("ivs_rule_tab").hasClass("ui-tab-current")?($("ivs_rule_filter_minw").value=a,$("ivs_rule_filter_minh").value=b,$("ivs_rule_filter_maxw").value=c,$("ivs_rule_filter_maxh").value=d):($("ivs_para_filter_minw").value=a,$("ivs_para_filter_minh").value=b,$("ivs_para_filter_maxw").value=c,$("ivs_para_filter_maxh").value=d)},_stopIVS:function(){Site.currentPage.is.ivsSDConfig&&jQuery('.u-tab.main li[data-for="set"]').hasClass("current")&&null!=h&&"WideView"!=h[k].Scene.Type&&(Site.currentPage.is.ivsSDConfig?(Page.ivsSDConfig.IDevIntelliTracker.stop().fail(function(b){alert(b.error&&269221888==b.error.code?a("w_Otheruserconfig"):a("Operateingfailure"))}),e._stopIVS.delay(3e4)):Page.ivsSDConfig.IDevIntelliTracker.start())},_stopSingleIVS:function(){Site.currentPage.is.ivsSDConfig&&jQuery('.u-tab.main li[data-for="set"]').hasClass("current")&&"WideView"!=h[k].Scene.Type&&Page.ivsSDConfig.IDevIntelliTracker.stop().fail(function(b){alert(b.error&&269221888==b.error.code?a("w_Otheruserconfig"):a("Operateingfailure"))})}}}(),function(){var e=Page.ivsSDConfig.Tab.glogal={init:function(){e.videoAnaly=b.DevVideoAnalyse,e.IDevIntelliTracker=b.DevIntelliTracker,e.translate(),e._sliderInit(),e.bind()},translate:function(){$("ivs_glogal_type_title").set("text",a("w_AlarmTrackEnable")),$("ivs_glogal_category_title").set("text",a("w_TrackStyle")),$("ivs_glogal_alarmDelay_title").set("text",a("w_TriggerDelay")),$("ivs_glogal_alarmDelay_second").set("text",a("w_Second")),$("ivs_glogal_duration_title").set("text",a("w_TrackTime")),$("ivs_glogal_duration_second").set("text",a("w_Second")),$("ivs_glogal_refresh").set("text",a("w_Refresh")),$("ivs_glogal_confirm").set("text",a("w_Save")),$("ivs_glogal_dejitter_title").set("text",a("w_dejitter"))},render:function(){c.hide(),u.contains("Traffic")?Page.ivsSDConfig.ConfigManager.getConfig(["IntelliTrackScene","VideoAnalyseGlobal","TrafficGlobal"]).done(function(a){g=a[0].params.table,h=a[1].params.table,E=a[2].params.table,k=e._findTypeChannel(),e._renderGlobalElements()}):Page.ivsSDConfig.ConfigManager.getConfig(["IntelliTrackScene","VideoAnalyseGlobal"]).done(function(a){g=a[0].params.table,h=a[1].params.table,k=e._findTypeChannel(),e._renderGlobalElements()}),F.support&&F.requestGetConfig()},bind:function(){e._scenesInit(),e._scenesTypeInit(),$("ivs_glogal_enable").addEvent("click",function(){F.support&&($("ivs_glogal_enable").checked?(remarkDisplay("ivs_glogal_remark",a("w_wv_tip1"),3e3,0),$("ivs_wv_enable").disabled="disabled"):$("ivs_wv_enable").disabled="",$("ivs_wv_enable").checked=!1),e._onGlobalEnableClick()}),$("ivs_glogal_refresh").addEvent("click",e._onGlobalRefreshClick),$("ivs_glogal_confirm").addEvent("click",e._onGlobalConfirmClick),$("ivs_glogal_category").addEvent("change",e._onSceneTypeChange),$("ivs_glogal_scene").addEvent("change",e._onApplyScenceChange),attachLimit("ivs_glogal_alarmDelay",1,600),attachLimit("ivs_glogal_duration",0,600),attachLimit("ivs_glogal_overlap",0,100),attachLimit("ivs_glogal_DistLimit",0,100),attachLimit("ivs_glogal_TimeLimit",0,100),attachLimit("ivs_TP_IdleDelay",10,3600),$("ivs_glogal_PriorMode").addEvent("change",function(){"Tour"==this.value?$("ivs_glogal_PriorMode_tip").removeClass("fn-hide"):$("ivs_glogal_PriorMode_tip").addClass("fn-hide")})},_sliderInit:function(){$("ivs_tab_glogal").setStyle("display","block")},_scenesTypeInit:function(){$("ivs_glogal_category").empty();for(var b=0;b<support_sceneTypes.length;b++)$("ivs_glogal_category").options.add(new Option(a("w_ivs_"+support_sceneTypes[b]),support_sceneTypes[b]))},_scenesInit:function(){$("ivs_glogal_scene").innerHTML="";for(var b=u.length,c=0;b>c;c++)switch(u[c]){case"Normal":$("ivs_glogal_scene").options.add(new Option(a("w_face_Normal"),u[c]));break;case"FaceDetection":$("ivs_glogal_scene").options.add(new Option(a("FaceRecognition"),u[c]));break;case"Traffic":$("ivs_glogal_scene").options.add(new Option(a("TrafficRecognition"),u[c]));break;case"wideview":$("ivs_glogal_scene").options.add(new Option(a("WideView"),u[c]));break;default:$("ivs_glogal_scene").options.add(new Option(a(u[c]),u[c]))}},_renderGlobalElements:function(){var a=g[k].Scene||[];B=!(a.length<1),$("ivs_glogal_scene").value=h[k].Scene.Type,$("ivs_glogal_enable").checked=g[k].Enable,$("ivs_glogal_type").checked=!g[k].Type,$("ivs_glogal_category").value=g[k].Category,"FullScene"==g[k].Category&&($("ivs_glogal_alarmDelay").value=g[k].FullScene.AlarmDelay,$("ivs_glogal_duration").value=g[k].FullScene.Duration),"MultiSceneExtention"==g[k].Category?($("ivs_plan_tab").removeClass("fn-hide"),$("ivs_glogal_PriorMode_wrap").style.display=""):($("ivs_plan_tab").addClass("fn-hide"),$("ivs_glogal_PriorMode_wrap").style.display="none"),$("ivs_glogal_PriorMode").value=g[k].MultiScene.PriorMode||"Detect",$("ivs_glogal_PriorMode").fireEvent("change"),e._onGlobalEnableClick(),$("ivs_g_sceneType_wrap").value=h[k].Scene.Detail.Type,"Gate"==h[k].Scene.Detail.Type&&($("ivs_glogal_scene_wrap").addClass("fn-hide"),$("ivs_g_sceneType_wrap").removeClass("fn-hide")),D=h[k].Scene.Type,$("ivs_glogal_optionsWrap").removeClass("fn-hide"),e._renderNewView();var b=h[k].Scene.Detail;b.Track&&($("ivs_glogal_overlap").value=b.Track.OverlapPercent,$("ivs_glogal_DistLimit").value=b.Track.DistLimit,$("ivs_glogal_TimeLimit").value=b.Track.TimeLimit),$("ivs_glogal_dejitter").checked=h[k].Scene.Dejitter},_checkMoveDetection:function(){d.get("IVSCaps",!0).done(function(a){z=a.SupportedRules||[],-1!==z.indexOf("MoveDetection")?$("ivs_global_tab").removeClass("fn-hide"):$("ivs_global_tab").addClass("fn-hide")})},_glogalTrackItem:function(a){var b=$("ivs_glogal_scene").value;switch(b){case"Normal":$("ivs_glogal_alarmDelay_wrap").style.display=a?"none":"",$("ivs_glogal_duration_wrap").style.display=!a&&A?"":"none";break;case"Track":$("ivs_glogal_alarmDelay_wrap").style.display=a?"none":"",$("ivs_glogal_duration_wrap").style.display=a?"none":"";break;default:$("ivs_glogal_alarmDelay_wrap").style.display="none",$("ivs_glogal_duration_wrap").style.display="none"}},_onGlobalEnableClick:function(){$("ivs_glogal_enable").checked?(e._ckeEnableIVS(!1),"FullScene"==$("ivs_glogal_category").value||"WideView"==$("ivs_glogal_scene").value?(e._glogalTrackItem(!1),e._disableIVSTab(!0)):(e._glogalTrackItem(!0),e._disableIVSTab(!1))):(e._ckeEnableIVS(!0),e._disableIVSTab(!0))},_ckeEnableIVS:function(a){$("ivs_glogal_type").disabled=a,$("ivs_glogal_category").disabled=a,$("ivs_glogal_scene").disabled=a,$("ivs_glogal_PriorMode").disabled=a,$("ivs_glogal_overlap").disabled=a,$("ivs_glogal_DistLimit").disabled=a,$("ivs_glogal_TimeLimit").disabled=a,$("ivs_g_sceneType").disabled=a,$("ivs_TP_IdleDelay").disabled=a,$("ivs_glogal_dejitter").disabled=a,$("ivs_glogal_alarmDelay").disabled=a,$("ivs_glogal_duration").disabled=a},_onGlobalRefreshClick:function(){Page.ivsSDConfig.ConfigManager.getConfig(["IntelliTrackScene","VideoAnalyseGlobal"]).done(function(b){g=b[0].params.table,h=b[1].params.table,k=e._findTypeChannel(),e._renderGlobalElements(),remarkDisplay("ivs_glogal_remark",a("Operateingsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_glogal_remark",a("Operateingfailure"),3e3,1)}),F.support&&F.requestGetConfig()},_findTypeChannel:function(){for(var a=0,b=0;b<h.length;b++)if(1==h[b].Enable){a=b;break}return a},_onGlobalConfirmClick:function(){for(var b=0;b<h.length;b++)g[b].Enable=!1,h[b].Enable=!1;if(g[k].Enable=$("ivs_glogal_enable").checked,h[k].Enable=g[k].Enable,g[k].Type=$("ivs_glogal_type").checked?0:1,g[k].Category=$("ivs_glogal_category").value,"FullScene"==$("ivs_glogal_category").value&&(g[k].FullScene.AlarmDelay=$("ivs_glogal_alarmDelay").value-0,g[k].FullScene.Duration=$("ivs_glogal_duration").value-0),g[k].MultiScene.PriorMode&&(g[k].MultiScene.PriorMode=$("ivs_glogal_PriorMode").value),h[k].Scene.Dejitter=$("ivs_glogal_dejitter").checked,h[k].Scene.Detail.Track){g[k].Scene=g[k].Scene||[],h[k].Scene.Detail.Track.OverlapPercent=$("ivs_glogal_overlap").value-0,h[k].Scene.Detail.Track.DistLimit=$("ivs_glogal_DistLimit").value-0,h[k].Scene.Detail.Track.TimeLimit=$("ivs_glogal_TimeLimit").value-0;for(var b=1;b<g[k].Scene.length;b++)h[k]["Scene"+b].Detail.Track&&(h[k]["Scene"+b].Detail.Track.OverlapPercent=$("ivs_glogal_overlap").value-0,h[k]["Scene"+b].Detail.Track.DistLimit=$("ivs_glogal_DistLimit").value-0,h[k]["Scene"+b].Detail.Track.TimeLimit=$("ivs_glogal_TimeLimit").value-0)}"Traffic"==h[k].Scene.Type&&(g[k].IdleDelay=$("ivs_TP_IdleDelay").value-0),Page.ivsSDConfig.ConfigManager.setConfig(["IntelliTrackScene","VideoAnalyseGlobal"],[g,h]).done(function(b){if(e._onGlobalEnableClick(),remarkDisplay("ivs_glogal_remark",a("Succeed in saving configure"),3e3,0),g[k].Enable&&"FullScene"!=g[k].Category&&e._disableIVSTab(!1),$("ivs_glogal_scene").value!=D){var c=!1,d=!1;if(b.params[0].result&&b.params[0].params&&b.params[0].params.options&&b.params[0].params.options.contains("NeedReboot")&&(c=!0),b.params[1].result&&b.params[1].params&&b.params[1].params.options&&b.params[1].params.options.contains("NeedReboot")&&(d=!0),c||d){var f='{"result":true,"params":{"options":["NeedReboot"]}}';isNeedReboot(f,"w_Rebooting...",!1,!1)}}e._renderGlobalElements()}).fail(function(){remarkDisplay("ivs_glogal_remark",a("Saving failure"),3e3,1)}),F.support&&F.requestSaveConfig(),F.newRequestSaveConfig("WideView"==h[k].Scene.Type?!0:!1)},_onSceneTypeChange:function(){var a=$("ivs_glogal_category").value;"FullScene"==a?($("ivs_glogal_alarmDelay").value=g[k].FullScene.AlarmDelay,$("ivs_glogal_duration").value=g[k].FullScene.Duration,e._glogalTrackItem(!1),e._disableIVSTab(!0)):(e._glogalTrackItem(!0),$("ivs_glogal_alarmDelay").value&&(g[k].FullScene.AlarmDelay=$("ivs_glogal_alarmDelay").value-0,g[k].FullScene.Duration=$("ivs_glogal_duration").value-0),e._disableIVSTab(!1)),"MultiSceneExtention"==a?($("ivs_plan_tab").removeClass("fn-hide"),$("ivs_glogal_PriorMode_wrap").style.display=""):($("ivs_plan_tab").addClass("fn-hide"),$("ivs_glogal_PriorMode_wrap").style.display="none")},_onApplyScenceChange:function(){var a=$("ivs_glogal_scene").value;e._refreshTypeChannel(a),"TrafficRecognition"==a?($("ivs_glogal_type_wrap").style.display=A?"block":"none",jQuery('li[filename="ivsTrafficConfig"]').removeClass("fn-hide"),jQuery('li[filename="ivsTrafficDefault"]').removeClass("fn-hide"),C=!1):"FaceDetection"==a?($("ivs_glogal_type_wrap").style.display="none",C=!0,jQuery('li[filename="ivsTrafficConfig"]').addClass("fn-hide"),jQuery('li[filename="ivsTrafficDefault"]').addClass("fn-hide")):($("ivs_glogal_type_wrap").style.display=A?"block":"none",C=!1,jQuery('li[filename="ivsTrafficConfig"]').addClass("fn-hide"),jQuery('li[filename="ivsTrafficDefault"]').addClass("fn-hide")),e._renderNewView()},_refreshTypeChannel:function(a){for(var b=0;b<h.length;b++)if(h[b].Scene.Type==a){k=b;break}},_renderNewView:function(){var a=$("ivs_glogal_scene").value;switch($("ivs_scene_setdyn").addClass("fn-hide"),$("ivs_global_tab").addClass("fn-hide"),isEnable("is_expertParams_intellent")?$$("#page_ivs .normalParams").removeClass("fn-hide"):$$("#page_ivs .normalParams").addClass("fn-hide"),$("ivs_glogal_optionsWrap").removeClass("fn-hide"),$("ivs_glogal_enable").checked&&"FullScene"!=$("ivs_glogal_category").value&&$("ivs_scene_tab").removeClass("ui-tab-disabled"),e._disableIVSTab(!1),a){case"Track":A=!0;break;case"Normal":isEnable("is_show_WideView")&&(A=!1);break;default:A=!1}switch($("ivs_para_tab").style.display="none",a){case"SDTraffic":$("ivs_para_tab").style.display="";case"Traffic":$("ivs_glogal_type_wrap").style.display="none",$("ivs_lane_tab").removeClass("fn-hide"),$("ivs_scene_cm").removeClass("fn-hide"),$("ivs_glogal_PriorMode_wrap").removeClass("fn-hide"),$("ivs_record_wrap").addClass("fn-hide"),$("ivs_snap_wrap").addClass("fn-hide"),$("ivs_TP_IdleDelay_wrap").removeClass("fn-hide"),"Gate"==h[k].Scene.Detail.Type&&($("ivs_para_tab").style.display=""),$("ivs_TP_IdleDelay").value=g[k].IdleDelay||10,Page.ivsSDConfig.Tab.scene.cameraMark.support=!0;break;case"FaceDetection":C=!0,$("ivs_glogal_type_wrap").style.display="none",$("ivs_para_tab").style.display="";break;case"WideView":$("ivs_glogal_optionsWrap").addClass("fn-hide"),$("ivs_scene_tab").addClass("ui-tab-disabled"),e._disableIVSTab(!0),F.newRequestGetConfig();break;case"Track":case"Normal":e._checkMoveDetection(),$("ivs_scene_setdyn").removeClass("fn-hide"),$("ivs_glogal_type_wrap").style.display=A?"block":"none",$("ivs_para_tab").style.display="";break;default:alert("is there any new Scene Type? "+a)}"WideView"!=a&&(e._onSceneTypeChange(),$("ivs_glogal_enable").checked||e._disableIVSTab(!0))},buildGlobalJson:function(){var a=h[k],b="",c=a.Scene.Detail.MainDirection;b+='{"config":{"MainDirection":[['+c[0]+"],["+c[1]+"]]}}",v='{"result":true,"params":{"table":['+b+"]}}"},_disableIVSTab:function(a){$("ivs_scene_tab").setProperty("disabled",a),a&&$("ivs_scene_tab").addClass("ui-tab-disabled"),!a&&$("ivs_scene_tab").removeClass("ui-tab-disabled"),$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").setProperty("disabled",a||!B),a||!B?$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").addClass("ui-tab-disabled"):$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").removeClass("ui-tab-disabled")}}}(),function(){function c(a,c,d,e,f,g){a?b.PTZ.start(c,d,e,f,0,0,g):b.PTZ.stop(c,d,e,f,0,0,g)}var d,j=Page.ivsSDConfig.Tab.scene={cameraMark:null,init:function(){d=$("ivs_tab_scene"),j.translate(),j.bind(),j.cameraMark.init(),j.initDom()},$:function(a){return d.getElements(a)||null},initDom:function(){0==e&&$("ivs_rule_alarmOut").addClass("fn-hide")},translate:function(){$("ivs_scene_zoom_title").set("text",a("w_changeTimes")),$("ivs_scene_setdyn").set("text",a("w_setTrackDynameter")),$("ivs_footStep_title").set("text",a("w_Step")),$("ivs_sene_scene_title").set("text",a("w_scene")),$("ivs_sene_single_title").set("text",a("w_singleSceneTrack")),$("ivs_sene_multi_title").set("text",a("w_multiplicitySceneTrack")),$("ivs_scene_addScene").set("text",a("w_addScene")),$("ivs_scene_addPath").set("text",a("w_addPath")),$("ivs_sene_limit_title").set("text",a("w_scene1SetAndGet")),$("ivs_sene_set_top_title").set("text",a("w_upLine")),$("ivs_scene_set_Top").set("text",a("w_Setup")),$("ivs_scene_pre_Top").set("text",a("w_Preview")),$("ivs_sene_set_down_title").set("text",a("w_downLine")),$("ivs_scene_set_Bottom").set("text",a("w_Setup")),$("ivs_scene_pre_Bottom").set("text",a("w_Preview")),$("ivs_sene_set_left_title").set("text",a("w_leftLine")),$("ivs_scene_set_Left").set("text",a("w_Setup")),$("ivs_scene_pre_Left").set("text",a("w_Preview")),$("ivs_sene_set_right_title").set("text",a("w_rightLine")),$("ivs_scene_set_Right").set("text",a("w_Setup")),$("ivs_scene_pre_Right").set("text",a("w_Preview")),$("ivs_scene_refresh").set("text",a("w_Refresh")),$("ivs_scene_confirm").set("text",a("w_Save"))},render:function(){Page.ivsSDConfig._stopSingleIVS(),$("ocx").SetIVSConfig("",2),$("ocx").SetCurShape(""),$("ocx").SetCurPtzID(-1),Page.ivsSDConfig._openIVSVideo.delay(10,"","ivs_scene_vedio"),Page.ivsSDConfig.ConfigManager.getConfig(["IntelliTrackScene","VideoAnalyseCalibrate"]).done(function(a){g=a[0].params.table,a[1].result&&(i=a[1].params.table),j._scenceRenderElements()}),j.cameraMark.support&&(j.cameraMark.render(),j.cameraMark.applyRefresh())},bind:function(){$("ivs_scene_setdyn").addEvent("click",j._setMaxDyn),$("ivs_scene_setScene").addEvent("click",j._setScene),$("ivs_scene_previewScene").addEvent("click",j._previewScene),$$(".scenesetLimit").addEvent("click",function(){var a=this.id.split("_");!this.hasClass("ui-button-disabled")&&-1!=q&&j._setLimit(a[3])}),$$(".scenepreLimit").addEvent("click",function(){var a=this.id.split("_");!this.hasClass("ui-button-disabled")&&-1!=q&&j._preLimit(a[3])});var a={ivs_boat_Up:1,ivs_boat_Left:2,ivs_boat_Right:4,ivs_boat_Down:5};for(var b in a)j._onDirectionEvent(b,a[b]);$$(".ptzzoom").addEvent("mousedown",function(){var a=this.id.split("_");!$("ivs_scene_setdyn").hasClass("ui-button-disabled")&&c(!0,a[2],$("ivs_footStep").value-0,0,!1)}),$$(".ptzzoom").addEvent("mouseup",function(){var a=this.id.split("_");!$("ivs_scene_setdyn").hasClass("ui-button-disabled")&&c(!1,a[2],$("ivs_footStep").value-0,0,!1)}),$$(".ptzzoom").addEvent("mouseout",function(){var a=this.id.split("_");!$("ivs_scene_setdyn").hasClass("ui-button-disabled")&&c(!1,a[2],$("ivs_footStep").value-0,0,!1)}),$("ivs_sene_scene_title").addEvent("click",function(){g[k].Scene&&j._showScene(!0),j._chkSceneTab("ivs_sene_scene","ivs_sene_scene_title"),-1!=q&&j._chkPositionLimit(q),j._displayPtzSet(!1),$("ivs_scene_addScene").style.display="",$("ivs_scene_addPath").style.display="none"}),$("ivs_sene_single_title").addEvent("click",function(){j._chkSceneTab("ivs_sene_single","ivs_sene_single_title"),j._showSingleScene(),j._displayPtzSet(!0),j._disabledSceneLimit(!0),$("ivs_scene_addScene").style.display="none",$("ivs_scene_addPath").style.display="none"}),$("ivs_sene_multi_title").addEvent("click",function(){j._chkSceneTab("ivs_sene_multi","ivs_sene_multi_title"),j._showMultiScene(),j._displayPtzSet(!0),j._disabledSceneLimit(!0),$("ivs_scene_addScene").style.display="none",$("ivs_scene_addPath").style.display=""}),$("ivs_scene_addPath").addEvent("click",j._onIVSSceneAddPathClick),$("ivs_scene_addScene").addEvent("click",j._onIVSSceneAddClick),$("ivs_scene_refresh").addEvent("click",j._onIVSSceneRefreshClick),$("ivs_scene_confirm").addEvent("click",j._onIVSSceneConfirmClick),j._tableBind(),attachLimit("ivs_CalibratePixel",80,200)},_onDirectionEvent:function(a){var b=a.split("_");$(a).addEvent("mouseover",function(){!$("ivs_scene_setdyn").hasClass("ui-button-disabled")&&$("ivs_boatX").addClass("ui-boat-current-"+b[2].toLowerCase())}),$(a).addEvent("mouseout",function(){$("ivs_boatX").removeClass("ui-boat-current-"+b[2].toLowerCase()),$(a).removeClass("IVSBoat"+b[2]),!$("ivs_scene_setdyn").hasClass("ui-button-disabled")&&c(!1,b[2],$("ivs_footStep").value-0,0,!1)}),$(a).addEvent("mousedown",function(){$(a).addClass("IVSBoat"+b[2]),j._seriousSend(a)}),$(a).addEvent("mouseup",function(){$(a).removeClass("IVSBoat"+b[2]),!$("ivs_scene_setdyn").hasClass("ui-button-disabled")&&c(!1,b[2],$("ivs_footStep").value-0,0,!1)})},_seriousSend:function(a){var b=a.split("_");$(a)&&$(a).hasClass("IVSBoat"+b[2])&&(!$("ivs_scene_setdyn").hasClass("ui-button-disabled")&&c(!0,b[2],$("ivs_footStep").value-0,0,!1),j._seriousSend.delay(500,"",a))},_disabledSceneLimit:function(a){f?$$(".scenesetLimit",".scenepreLimit",".scenesetLimittitle","#ivs_sene_limit_title").setProperty("disabled",a):a?($$("#ivs_sene_limit_title",".scenesetLimittitle").addClass("fn-word-disabled"),$$(".scenesetLimit",".scenepreLimit").addClass("ui-button-disabled")):($$("#ivs_sene_limit_title",".scenesetLimittitle").removeClass("fn-word-disabled"),$$(".scenesetLimit",".scenepreLimit").removeClass("ui-button-disabled"))},_chkSceneTab:function(a,b){$$(".scenecon").setStyle("display","none"),$(a).style.display="",$$(".scenetab").removeClass("ui-table-tab-current"),$(b).addClass("ui-table-tab-current"),t.close()},_displayPtzSet:function(a){a?($("ivs_boatX").addClass("ui-boat-current-disabled"),$("ivs_zoom_ZoomTele").addClass("ui-ptz-icon-disabled"),$("ivs_zoom_ZoomWide").addClass("ui-ptz-icon-disabled")):($("ivs_boatX").removeClass("ui-boat-current-disabled"),$("ivs_zoom_ZoomTele").removeClass("ui-ptz-icon-disabled"),$("ivs_zoom_ZoomWide").removeClass("ui-ptz-icon-disabled")),f?($$(".ptzway",".ptzzoom","#ivs_scene_setdyn").setProperty("disabled",a),$("ivs_scene_zoom_title").disabled=a,$("ivs_footStep_title").disabled=a):a?($$("#ivs_scene_zoom_title","#ivs_footStep_title").addClass("fn-word-disabled"),$$("#ivs_scene_setdyn").addClass("ui-button-disabled")):($$("#ivs_scene_zoom_title","#ivs_footStep_title").removeClass("fn-word-disabled"),$$("#ivs_scene_setdyn").removeClass("ui-button-disabled")),$("ivs_footStep").disabled=a},_scenceRenderElements:function(){var a=g[k].Scene||[];B=!(a.length<1),$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").setProperty("disabled",!B),!B&&$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").addClass("ui-tab-disabled"),B&&$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").removeClass("ui-tab-disabled"),$("ivs_sene_scene").innerHTML="",!B&&Page.ivsSDConfig.Tab.scene.cameraMark.uiDisable(!0),B&&Page.ivsSDConfig.Tab.scene.cameraMark.uiDisable(!1),g[k].Scene&&j._showScene(!0),!g[k].Scene&&(q=-1),j._chkSceneTab("ivs_sene_scene","ivs_sene_scene_title"),j._displayPtzSet(!1),$("ivs_scene_addScene").style.display="",$("ivs_scene_addPath").style.display="none";var b=h[k].Scene.Type;isEnable("is_show_WideView")||A&&(b="Track"),j.$("*[data-cap]").addClass("fn-hide"),j.$('*[data-cap="'+b+'"]').removeClass("fn-hide"),"SingleScene"==g[k].Category?($("ivs_sene_multi_title").style.display="none",$("ivs_sene_single_title").style.display=""):"MultiScene"==g[k].Category?($("ivs_sene_single_title").style.display="none",$("ivs_sene_multi_title").style.display=""):($("ivs_sene_multi_title").style.display="none",$("ivs_sene_single_title").style.display="none")},_showScene:function(b){var c=b?!0:!1;$("ivs_sene_scene").innerHTML="";var d=g[k].Scene.length,e=!1;"Traffic"==$("ivs_glogal_scene").value&&(e=!0);var f='<table cellpadding="0" cellspacing="0" class="">';f+=A?isEnable("is_expertParams_intellent")?'<tr><th class="fn-widp15">'+a("w_sceneMark")+'</th><th class="fn-widp25">'+a("w_sceneName")+'</th><th class="fn-widp25">'+a("w_TrackTime")+'(s)</th><th class="fn-widp20">'+a("w_limitTrack")+"</th><th>"+a("w_delete")+"</th></tr>":'<tr><th class="fn-widp15">'+a("w_sceneMark")+'</th><th class="fn-widp25">'+a("w_sceneName")+'</th><th class="fn-widp25">'+a("w_TrackTime")+'(s)</th><th class="fn-widp15">'+a("w_Save")+"</th><th>"+a("w_delete")+"</th></tr>":e?'<tr><th class="fn-widp15">'+a("w_sceneMark")+'</th><th class="fn-widp60">'+a("w_sceneName")+'<th class="fn-widp60">'+a("w_direction1")+'</th><th class="fn-widp15">'+a("w_Save")+"</th><th>"+a("w_delete")+"</th></tr>":'<tr><th class="fn-widp15">'+a("w_sceneMark")+'</th><th class="fn-widp60">'+a("w_sceneName")+'</th><th class="fn-widp15">'+a("w_Save")+"</th><th>"+a("w_delete")+"</th></tr>";for(var h=0;d>h;h++){var i=h%2?"ui-table-tr-odd":"",l=h+1;f+='<tr class="SelectScene '+i+'"  id="sceneLimit_'+h+'" >',f+='<td data-for="gotoScene" data-id="'+h+'">'+l+"</td>",f+='<td data-for="gotoScene" data-id="'+h+'"><a class ="showSceneName fn-word-wrap "  id="sceneName_'+h+'" title="'+g[k].Scene[h].Name+'">'+g[k].Scene[h].Name.replace("<","&lt;")+'</a><input type="text" id="inputScene_'+h+'" class= "saveSceneName" size="5" maxlength=25 style="display:none;"></td>',A&&(isEnable("is_expertParams_intellent")?(f+='<td data-for="gotoScene" data-id="'+h+'"><span class = "showSceneDuration"  id="sceneDuration_'+h+'">'+g[k].Scene[h].Duration+'</span><input type="text" id="inputDuration_'+h+'" class = "saveSceneDuration" size="3" style="display:none;"></td>',f+='<td data-for="gotoScene" data-id="'+h+'"><input type="checkbox" id="xwgz_'+h+'" class ="chkPositionLimit" /></td>'):(f+='<td data-for="gotoScene" data-id="'+h+'"><span class = "showSceneDuration"  id="sceneDuration_'+h+'">'+g[k].Scene[h].Duration+'</span><input type="text" id="inputDuration_'+h+'" class = "saveSceneDuration" size="3" style="display:none;"></td>',f+='<td data-for="gotoScene" data-id="'+h+'" class="fn-hide"><input type="checkbox" id="xwgz_'+h+'" class ="chkPositionLimit" /></td>')),e&&(f+='<td><a class ="showSceneDirect fn-word-wrap"  id="sceneDir_'+h+'" title="'+g[k].Scene[h].Direction+'">'+a("w_wt"+g[k].Scene[h].Direction)+'</a>                            <select id="inputDir_'+h+'" class= "saveSceneDir" style="display:none;"><option value="EastToWest">'+a("w_wtEastToWest")+'</option><option value="WestToEast">'+a("w_wtWestToEast")+'</option><option value="SouthToNorth">'+a("w_wtSouthToNorth")+'</option><option value="NorthToSouth">'+a("w_wtNorthToSouth")+"</option></select></td>"),f+='<td data-for="gotoScene" data-id="'+h+'"><a href="javascript:;" data-for="setScene" data-id="'+h+'" class = "ui-table-icon-save saveScene"></a></td>',f+='<td data-for="gotoScene" data-id="'+h+'"><a href="javascript:;" data-for="deleteScene" data-cutid="'+h+'" class = "ui-table-icon-del deleteScene"></a></td>',f+="</tr>"
}if(f+="</table>",f+='<div id="SceneCover" class="fn-absolute intel-sceneboxCover" style="display:none;"></div>',$("ivs_sene_scene").innerHTML=f,$$("#page_ivs .showSceneName").addEvent("dblclick",function(){var a=this.id.replace(/[^\d]/g,"");a==q&&($("sceneName_"+a).style.display="none",$("inputScene_"+a).style.display="",$("inputScene_"+a).focus(),$("inputScene_"+a).value=g[k].Scene[a].Name)}),$$("#page_ivs .saveSceneName").addEvent("blur",function(){var b=this.id.replace(/[^\d]/g,"");if(""==$("inputScene_"+b).value.trim()&&($("inputScene_"+b).value=g[k].Scene[b].Name),$("inputScene_"+b).value==g[k].Scene[b].Name)return g[k].Scene[b].Name=$("inputScene_"+b).value,$("sceneName_"+b).set("text",g[k].Scene[b].Name),$("sceneName_"+b).style.display="block",void($("inputScene_"+b).style.display="none");for(var c=g[k].Scene.length,d=0;c>d;d++)if($("inputScene_"+b).value==g[k].Scene[d].Name)return remarkDisplay("ivs_scene_remark",a("Operateingfailure"),3e3,1),$("sceneName_"+b).set("text",g[k].Scene[b].Name),$("sceneName_"+b).style.display="block",void($("inputScene_"+b).style.display="none");g[k].Scene[b].Name=$("inputScene_"+b).value,$("sceneName_"+b).set("text",g[k].Scene[b].Name),$("sceneName_"+b).style.display="block",$("inputScene_"+b).style.display="none",$("sceneName_"+b).title=g[k].Scene[b].Name}),$$("#page_ivs .saveSceneName").addEvent("keyup",function(){}),$$("#page_ivs .showSceneDuration").addEvent("dblclick",function(){var a=this.id.replace(/[^\d]/g,"");a==q&&($("sceneDuration_"+a).style.display="none",$("inputDuration_"+a).style.display="",$("inputDuration_"+a).focus(),$("inputDuration_"+a).value=g[k].Scene[a].Duration,j._attachScenceDurationLimit("inputDuration_"+a,0,300,a))}),$$("#page_ivs .showSceneDirect").addEvent("dblclick",function(){var a=this.id.replace(/[^\d]/g,"");a==q&&($("sceneDir_"+a).style.display="none",$("inputDir_"+a).style.display="",$("inputDir_"+a).focus(),$("inputDir_"+a).value=g[0].Scene[a].Direction)}),$$("#page_ivs .saveSceneDir").addEvent("change",function(){var b=this.id.replace(/[^\d]/g,"");return""==$("inputDir_"+b).value.trim()&&($("inputDir_"+b).value=g[0].Scene[b].Direction),$("inputDir_"+b).value==g[0].Scene[b].Direction?(g[0].Scene[b].Direction=$("inputDir_"+b).value,$("sceneDir_"+b).innerHTML=a("w_wt"+g[0].Scene[b].Direction),$("sceneDir_"+b).style.display="block",void($("inputDir_"+b).style.display="none")):(g[0].Scene[b].Direction=$("inputDir_"+b).value,$("sceneDir_"+b).innerHTML=a("w_wt"+g[0].Scene[b].Direction),$("sceneDir_"+b).style.display="block",$("inputDir_"+b).style.display="none",void($("sceneDir_"+b).title=g[0].Scene[b].Direction))}),$$("#page_ivs .chkPositionLimit").addEvent("click",function(){var a=this.id.replace(/[^\d]/g,"");j._chkPositionLimit(a)}),A)for(var h=0;d>h;h++)$("xwgz_"+h).checked=g[k].Scene[h].PositionLimit.Enable;-1!=q?j._onSelectScene(q,c):j._onSelectScene(0,c)},_tableBind:function(){$("ivs_sene_scene").addEvent("click",function(a){var b=a.target,c=b.getProperty("data-for");switch(c){case"setScene":var d=b.getProperty("data-id");j._onSelectScene(d,!1),j._setScene();break;case"deleteScene":q=b.getProperty("data-cutid"),$("SceneCover").setStyle("display",""),t.show();break;case"gotoScene":var d=b.getProperty("data-id");j._onSelectScene(d,!0);break;default:var d=b.id.replace(/[^\d]/g,"");""!=d&&j._onSelectScene(d,!0)}})},_attachScenceDurationLimit:function(a,b,c,d){var e=$(a);e.removeEvents("keyup"),e.removeEvents("blur"),e.addEvents({keyup:function(){limit(this,c)},blur:function(){limit(this,c),limitMin(this,b),g[k].Scene[d].Duration=""==$("inputDuration_"+d).value?0:$("inputDuration_"+d).value-0,$("sceneDuration_"+d).style.display="",$("inputDuration_"+d).style.display="none",$("sceneDuration_"+d).innerHTML=g[k].Scene[d].Duration}})},_onIVSSceneAddClick:function(){for(var b=[],c=[],d=0,e=1;17>e;e++)b.push(e),c.push(a("w_scene")+e);for(var f=0;f<g.length;f++)g[f].Scene&&(d+=g[f].Scene.length);for(var f=0;f<g.length;f++)if(null==g[f].Scene)g[f].Scene=[];else{if(d>=16)return void alert("场景最多16个！");for(var h=0;h<g[f].Scene.length;h++)b.contains(g[f].Scene[h].PresetID)&&b.erase(g[f].Scene[h].PresetID),c.contains(g[f].Scene[h].Name)&&c.erase(g[f].Scene[h].Name)}var i={Duration:30,Direction:"EastToWest",Name:c[0],PositionLimit:{Bottom:0,Enable:!1,Left:0,Right:0,Top:0,Type:0},PresetID:b[0],MaxZoom:.2};g[k].Scene.push(i);var l=g[k].Scene.length-1;l=-1==l?"":l,l=0==l?"":l,Page.ivsSDConfig.Tab.scene.cameraMark.uiDisable(!1),Page.ivsSDConfig.IDevIntelliTracker.markScene(b[0]).done(function(){q=d,g[k].Scene&&j._showScene(!1)}).fail(function(){remarkDisplay("ivs_scene_remark",a("Operateingfailure"),3e3,1)}),!(1!==g[k].Scene.length)&&(g[k].SingleScene.PresetID=g[k].Scene[0].PresetID)},_onIVSSceneConfirmClick:function(){if(C){var b,c,d=$$("#ivs_sene_scene tbody tr").length-1;delete h[k].Scene0;for(var e=0;d>e;e++)0==e&&(e=""),b={Type:"FaceDetection",Jitter:50,Dejitter:!0,Detail:{CameraHeight:6.2,CameraDistance:10,MainDirection:[[1e3,4e3],[6e3,4e3]],FaceAngleDown:-30,FaceAngleUp:30,FaceAngleLeft:30,FaceAngleRight:-30,DetectType:"SmallFace"}},c="Scene"+e,null==h[k][c]&&(h[k][c]=b);Page.ivsSDConfig.ConfigManager.setConfig(["IntelliTrackScene"],[g]).done(function(){var b=g[k].Scene||[];B=!(b.length<1),$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").setProperty("disabled",!B),!B&&$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").addClass("ui-tab-disabled"),B&&$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").removeClass("ui-tab-disabled"),remarkDisplay("ivs_scene_remark",a("Succeed in saving configure"),3e3,0)}).fail(function(){remarkDisplay("ivs_scene_remark",a("Saving failure"),3e3,1)})}else{var f=["IntelliTrackScene"],l=[g];"Traffic"==$("ivs_glogal_scene").value&&(j._saveVAG(),f.push("VideoAnalyseCalibrate"),l.push(i)),Page.ivsSDConfig.ConfigManager.setConfig(f,l).done(function(){var b=g[k].Scene||[];B=!(b.length<1),$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").setProperty("disabled",!B),!B&&$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").addClass("ui-tab-disabled"),B&&$$("#ivs_rule_tab","#ivs_para_tab","#ivs_plan_tab","#ivs_lane_tab","#ivs_global_tab").removeClass("ui-tab-disabled"),remarkDisplay("ivs_scene_remark",a("Succeed in saving configure"),3e3,0),j.cameraMark.support&&j.cameraMark.applyRefresh()}).fail(function(){remarkDisplay("ivs_scene_remark",a("Saving failure"),3e3,1)})}},_onIVSSceneRefreshClick:function(){Page.ivsSDConfig.ConfigManager.getConfig("IntelliTrackScene").done(function(b){g=b,g[k].MultiScene.TourPath=g[k].MultiScene.TourPath||[],j._scenceRenderElements(),remarkDisplay("ivs_scene_remark",a("Operateingsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_scene_remark",a("Operateingfailure"),3e3,1)}),j.cameraMark.support&&(j.cameraMark.varSetMarkflag(!1),j.cameraMark.applyRefresh())},_onIVSSceneAddPathClick:function(){g[k].MultiScene.TourPath=g[k].MultiScene.TourPath||[];var a=g[k].MultiScene.TourPath.length,b=g[k].Scene[0].PresetID,c='{"Duration":600,"PresetID":'+b+"}";16>a&&(g[k].MultiScene.TourPath.push(JSON.decode(c)),j._showMultiScene())},_showMultiScene:function(){var b=!0;if(!$chk(g[k].Scene)||g[k].Scene.length<1||!$chk(g[k].MultiScene.TourPath))return r=-1,void($("ivs_sene_multi").innerHTML="");var c=g[k].MultiScene.TourPath.length,d=g[k].Scene.length;$("ivs_sene_multi").innerHTML="";var e='<table cellpadding="0" cellspacing="0">';if(b)var f="m";else var f="s";e+='<tr><th class="fn-widp15">'+a("w_Mark")+'</th><th class="fn-widp40">'+a("w_sceneName")+'</th><th class="fn-widp25">'+a("w_settleTime")+"("+f+")</th><th>"+a("w_delete")+"</th></tr>";for(var h=0;c>h;h++){for(var i=g[k].MultiScene.TourPath[h].PresetID,l=0,m=0;d>m;m++)if(i==g[k].Scene[m].PresetID){l=m;break}var n=h%2?"ui-table-tr-odd":"";if(e+='<tr class="onSelectMScen1e '+n+'" id="sceneMLimit_'+h+'" >',e+="<td>"+(h+1)+"</td>",e+='<td><a class ="showList fn-word-wrap fn-width140"  id="MultiName_'+h+'" title="'+g[k].Scene[l].Name+'">'+g[k].Scene[l].Name+'</a><select id="multiList_'+h+'" style="display:none;" class ="savemultiScene fn-width140" ></select></td>',b)var o=g[k].MultiScene.TourPath[h].Duration/60;else var o=g[k].MultiScene.TourPath[h].Duration;e+='<td><span class = "showMDuration fn-width60 fn-show" id="MDuration_'+h+'">'+o+'</span><input type="text" id="multiDuration_'+h+'" size="3" style="display:none;" class ="fn-width60" ></td>',e+='<td><i class ="ui-table-icon-del deleteMScene"></i></td>',e+="</tr>"}e+="</table>",$("ivs_sene_multi").innerHTML=e,j._onSelectMScene(0),$$("#page_ivs .onSelectMScen1e").addEvent("click",function(){var a=this.id.replace(/[^\d]/g,"");j._onSelectMScene(a)}),$$("#page_ivs .showList").addEvent("dblclick",function(){var a=this.id.replace(/[^\d]/g,"");if(a==r){$("MultiName_"+a).style.display="none",$("multiList_"+a).style.display="block",$("multiList_"+a).focus(),$("multiList_"+a).innerHTML="";for(var b=g[k].Scene.length,c=0;b>c;c++)$("multiList_"+a).options.add(new Option(g[k].Scene[c].Name,c));for(var d=g[k].MultiScene.TourPath[a].PresetID,e=0,f=0;b>f;f++)if(d==g[k].Scene[f].PresetID){e=f;break}$("multiList_"+a).value=e}}),$$("#page_ivs .savemultiScene").addEvent("change",function(){var a=this.id.replace(/[^\d]/g,""),b=$("multiList_"+a).value;g[k].MultiScene.TourPath[a].PresetID=g[k].Scene[b].PresetID,$("MultiName_"+a).style.display="block",$("multiList_"+a).style.display="none",$("MultiName_"+a).innerHTML=g[k].Scene[b].Name}),$$("#page_ivs .savemultiScene").addEvent("blur",function(){var a=this.id.replace(/[^\d]/g,"");$("MultiName_"+a).style.display="block",$("multiList_"+a).style.display="none"}),$$("#page_ivs .showMDuration").addEvent("dblclick",function(){var a=this.id.replace(/[^\d]/g,"");if(a==r){if($("MDuration_"+a).style.display="none",$("multiDuration_"+a).style.display="block",b){$("multiDuration_"+a).value=g[k].MultiScene.TourPath[a].Duration/60;var c=900}else{$("multiDuration_"+a).value=g[k].MultiScene.TourPath[a].Duration;var c=54e3}$("multiDuration_"+a).focus(),j._attachScenceLimit("multiDuration_"+a,1,c,a,b)}}),$$("#page_ivs .deleteMScene").addEvent("click",function(){var a=this.getParent().getParent().id.replace(/[^\d]/g,"");g[k].MultiScene.TourPath.erase(g[k].MultiScene.TourPath[a]),j._showMultiScene()})},_attachScenceLimit:function(a,b,c,d,e){var f=$(a);f.removeEvents("keyup"),f.removeEvents("blur"),f.addEvents({keyup:function(){limit(this,c)},blur:function(){limit(this,c),limitMin(this,b),$("MDuration_"+d).style.display="block",$("multiDuration_"+d).style.display="none",e?(g[k].MultiScene.TourPath[d].Duration=""==$("multiDuration_"+d).value?600:60*($("multiDuration_"+d).value-0),$("MDuration_"+d).innerHTML=g[k].MultiScene.TourPath[d].Duration/60):(g[k].MultiScene.TourPath[d].Duration=""==$("multiDuration_"+d).value?600:$("multiDuration_"+d).value-0,$("MDuration_"+d).innerHTML=g[k].MultiScene.TourPath[d].Duration)}})},_onSelectMScene:function(a){var b=g[k].MultiScene.TourPath.length;if(0!==b){r=$("sceneMLimit_"+a)?a:0,$$(".onSelectMScen1e").removeClass("ui-table-tr-current"),$("sceneMLimit_"+r).addClass("ui-table-tr-current");var c=g[k].MultiScene.TourPath[r].PresetID;Page.ivsSDConfig._isgotoScene(c)}},_onSelectScene:function(a,b){0!=g[k].Scene.length&&(q=$("sceneLimit_"+a)?a:0,$$(".SelectScene").removeClass("ui-table-tr-current"),$("sceneLimit_"+q).addClass("ui-table-tr-current"),j._chkPositionLimit(q),b&&Page.ivsSDConfig._isgotoScene(g[k].Scene[q].PresetID),j.cameraMark.support&&j._renderVAG())},_chkPositionLimit:function(a){A&&(g[k].Scene[a].PositionLimit.Enable=$("xwgz_"+a).checked,j._disabledSceneLimit(!$("xwgz_"+a).checked))},_showSingleScene:function(){var b=g[k].Scene.length;if(1>b){var c=$("ivs_sene_single"),d="";return c.innerHTML="",d='<table cellpadding="0" cellspacing="0" class=""><tr><th class="fn-widp10"></th><th class="fn-widp20">'+a("w_Mark")+"</th><th>"+a("w_sceneName")+"</th></tr></table>",void(c.innerHTML=d)}$("ivs_sene_single").innerHTML="";var e='<table cellpadding="0" cellspacing="0" class="">';e+='<tr><th class="fn-widp10"></th><th class="fn-widp20">'+a("w_Mark")+"</th><th>"+a("w_sceneName")+"</th></tr>";for(var f=g[k].SingleScene.PresetID,h=0;b>h;h++){var i=h%2?"ui-table-tr-odd":"";e+='<tr class="chkSingleScene '+i+'"  id="chksinglescene_'+h+'">',e+=f==g[k].Scene[h].PresetID?'<td><input type="radio" checked name="chkSingle"  id="chksscene_'+h+'" /></td>':'<td><input type="radio" name="chkSingle" id="chksscene_'+h+'" /></td>',e+="<td>"+(h+1)+"</td>",e+='<td><a class="intel-scene-name" title="'+g[k].Scene[h].Name+'">'+g[k].Scene[h].Name+"</a></td>",e+="</tr>"}e+="</table>",$("ivs_sene_single").innerHTML=e,Page.ivsSDConfig._isgotoScene(f),$$("#page_ivs .chkSingleScene").addEvent("click",function(){var a=this.id.replace(/[^\d]/g,"");$("chksscene_"+a).checked=!0,g[k].SingleScene.PresetID=g[k].Scene[a].PresetID;var b=g[k].SingleScene.PresetID;Page.ivsSDConfig._isgotoScene(b)})},_setMaxDyn:function(){if(-1!=q){var b=g[k].Scene[q].PresetID;$("ivs_scene_setdyn").hasClass("ui-button-disabled")||Page.ivsSDConfig.IDevIntelliTracker.markSceneMaxZoom(b).done(function(){remarkDisplay("ivs_scene_remark",a("Operateingsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_scene_remark",a("Operateingfailure"),3e3,1)})}},_setScene:function(){if(-1!=q){var b=g[k].Scene[q].PresetID;$("ivs_scene_setdyn").hasClass("ui-button-disabled")||Page.ivsSDConfig.IDevIntelliTracker.markScene(b).done(function(){remarkDisplay("ivs_scene_remark",a("Operateingsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_scene_remark",a("Operateingfailure"),3e3,1)})}},_previewScene:function(){var a=-1;if($("ivs_sene_scene_title").hasClass("ui-table-tab-current")){if(-1==q)return;a=g[k].Scene[q].PresetID}if($("ivs_sene_single_title").hasClass("ui-table-tab-current"))for(var b=0;b<g[k].Scene.length;b++)if($("chksscene_"+b).checked){a=g[k].Scene[b].PresetID;break}if($("ivs_sene_multi_title").hasClass("ui-table-tab-current")){if(-1==r)return;a=g[k].MultiScene.TourPath[r].PresetID}-1!=a&&Page.ivsSDConfig._gotoScene(a)},_setLimit:function(b){var c=g[k].Scene[q].PresetID;Page.ivsSDConfig.IDevIntelliTracker.markSceneLimit(c,b).done(function(){remarkDisplay("ivs_scene_remark",a("Operateingsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_scene_remark",a("Operateingfailure"),3e3,1)})},_preLimit:function(b){var c=g[k].Scene[q].PresetID;Page.ivsSDConfig.IDevIntelliTracker.gotoSceneLimit(c,b).done(function(){remarkDisplay("ivs_scene_remark",a("Operateingsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_scene_remark",a("Operateingfailure"),3e3,1)})},_renderVAG:function(){for(var a=i[k].Detail,b=0;b<a.length;b++)a[b]&&($("ivs_CalibratePixel").value=a[b].CalibratePixel||120)},_saveVAG:function(){for(var a=i[k].Detail,b=0;b<a.length;b++)a[b]&&(a[b].CalibratePixel=$("ivs_CalibratePixel").value-0)}},l=Page.ivsSDConfig.Tab.scene.cameraMark={support:!1,markFlag:!1,rect:[],sceneID:0,VideoAnalyseCalibrate:[[{ChannelID:0,Detail:[]}]],singleCalibrate:{},ptzPosition:[0,0,0],rpcPtz:b.PTZ,init:function(){l.bind()},render:function(){l.varSetMarkflag(!1)},bind:function(){$("ivs_scene_csStart").addEvent("click",l.startMark),$("ivs_scene_csComplate").addEvent("click",l.endMark),$("ivs_scene_csPreview").addEvent("click",l.watchMark)},varSetMarkflag:function(a){l.markFlag=a,l.uiChange(a),l.ocxChange(a)},startMark:function(){if(!$("ivs_scene_csStart").hasClass("ui-button-disabled")){l.findConfig();var b=l.checkSceneSaved();if(!b)return void remarkDisplay("ivs_scene_remark",a("请先保存此场景，再开始标定"),3e3,1);l.varSetMarkflag(!0)}},checkSceneSaved:function(){var a=0==q?"Scene":"Scene"+q;return void 0!==h[k][a]?!0:!1},findConfig:function(){if(-1!==q){for(var a=!0,b=l.VideoAnalyseCalibrate[k].Detail,c={x:140,y:51},d={x:90,y:25},e=l.ocxNumChange(c,Video.resolution),f=l.ocxNumChange(d,Video.resolution),h=0;h<b.length;h++)if(b[h]&&b[h].SceneID==q){l.singleCalibrate=b[h],l.singleCalibrate.CalibrateArea[0].Area=[e[0],e[1],f[0],f[1]],a=!1;break}if(a){var i={SceneID:1,PtzPosition:[-2,-2,-2],PtzPresetID:1,ZoomValue:0,CalibrateArea:[{Type:"Groud",Area:[[3754,3868],[4437,3868],[3754,4323],[4437,4323]]}]};i.PtzPresetID=g[k].Scene[q].PresetID||0,i.SceneID=q-0,i.CalibrateArea[0].Area=[e[0],e[1],f[0],f[1]],b.push(i),l.findConfig()}}},endMark:function(){if($("ivs_scene_csComplate").hasClass("ui-button-disabled"))return!1;var b=l.checkSceneSaved();return b?(l.varSetMarkflag(!1),void l.applyRefreshPtz(!0)):void remarkDisplay("ivs_scene_remark",a("请先保存此场景，再开始标定"),3e3,1)},watchMark:function(){if($("ivs_scene_csPreview").hasClass("ui-button-disabled"))return!1;l.findConfig();var c=l.singleCalibrate.PtzPosition;if(c[0]<-1||c[1]<-1||c[2]<-1)return void remarkDisplay("ivs_scene_remark",a("请先标定此场景，再预览标定位置"),3e3,1);var d=(l.singleCalibrate.PtzMotorSteps,b.PTZ.moveAbsolutely(c));d.done(function(){var a=l.ocxBulidString();$("ocx").SetCurPtzID(0),$("ocx").SetObjectConfig(a)}),setTimeout(function(){$("ocx").DeleteShape("filter")},4e3)},applyRefresh:function(){Page.ivsSDConfig.ConfigManager.getConfig(["VideoAnalyseCalibrate","VideoAnalyseGlobal"]).done(function(a){a[0].result&&a[0].params.table&&(l.VideoAnalyseCalibrate=a[0].params.table,l.findConfig(),i=a[0].params.table,j._renderVAG()),a[1].result&&(h=a[1].params.table)})},applyRefreshPtz:function(a){b.PTZ.getStatus().done(function(c){l.singleCalibrate.PtzPosition=c.Postion,l.singleCalibrate.ZoomValue=c.ZoomValue,b.PTZ.getMotorSteps().done(function(b){l.singleCalibrate.PtzMotorSteps=b,a===!0&&l.applySave()})})},applySave:function(){var b=l.VideoAnalyseCalibrate;Page.ivsSDConfig.ConfigManager.setConfig("VideoAnalyseCalibrate",b).done(function(){remarkDisplay("ivs_scene_remark",a("Succeed in saving configure"),3e3,0)}).fail(function(){remarkDisplay("ivs_scene_remark",a("Saving failure"),3e3,1)})},uiChange:function(a){a?$("ivs_scene_csStart").addClass("ui-button-hover"):$("ivs_scene_csStart").removeClass("ui-button-hover")},uiDisable:function(a){a?($("ivs_scene_csStart").addClass("ui-button-disabled"),$("ivs_scene_csComplate").addClass("ui-button-disabled"),$("ivs_scene_csPreview").addClass("ui-button-disabled")):($("ivs_scene_csStart").removeClass("ui-button-disabled"),$("ivs_scene_csComplate").removeClass("ui-button-disabled"),$("ivs_scene_csPreview").removeClass("ui-button-disabled"))},ocxChange:function(a){if(a){var b=l.ocxBulidString();$("ocx").SetCurPtzID(0),$("ocx").SetObjectConfig(b)}else $("ocx").DeleteShape("filter")},ocxNumChange:function(a,b){var c=[],d=a.x,e=a.y,f=b.x,g=b.y,h=8191,i=8191,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;return j=(4096-h*d/(2*f)).toInt(),k=(4096-i*e/(2*g)).toInt(),n=(4096+h*d/(2*f)).toInt(),o=(4096+i*e/(2*g)).toInt(),l=n,m=k,p=j,q=o,c[0]=[j,k],c[1]=[n,o],c},ocxBulidString:function(){var a="";if(l.singleCalibrate.CalibrateArea){var b={DFilter:[]},c=l.singleCalibrate.CalibrateArea[0].Area;b.DFilter=c,a=JSON.encode(b)}else{var d={x:140,y:51},e={x:90,y:25},f=l.ocxNumChange(d,Video.resolution),g=l.ocxNumChange(e,Video.resolution);a='{"DFilter":[['+f[0]+"],["+f[1]+"],["+g[0]+"],["+g[1]+"]]}"}return a},ocxInfo:function(a){var b=JSON.decode(a);l.rect=b.DFilter;var c=l.rect;l.singleCalibrate.CalibrateArea[0].Area=[c[0],c[1],c[2],c[3]]},translate:function(){}}}(),function(){var d=null,i={},n={},r={},t={},u={},x={},y={},A={},B={},D={},E=Page.ivsSDConfig.Tab.rule={Mode:"Normal",MaxRules:10,init:function(){E.videoAnaly=b.DevVideoAnalyse,E.translate(),E.bind()},translate:function(){for(var b=0;7>b;b++){$("ivs_rule_triggerposition_title"+b).set("text",a("w_touchOffAlarm"));var c=$("ivs_rule_triggerposition"+b).getElements("option");c[0].setProperty("text",a("w_Center")),c[1].setProperty("text",a("w_LeftCenter")),c[2].setProperty("text",a("w_TopCenter")),c[3].setProperty("text",a("w_RightCenter")),c[4].setProperty("text",a("w_BottomCenter"))}$$(".ruleperiodset").set("text",a("w_Set")),$("ivs_rule_RD_draw").set("text",a("minGatherRegion")),$("ivs_rule_choiceScene_title").set("text",a("w_choiceTrackScene")),$("ivs_rule_addRule").set("text",a("w_addRule")),$("ivs_rule_number_title").set("text",a("w_sequenceNumber")),$("ivs_rule_name_title").set("text",a("w_groupName")),$("ivs_rule_type_title").set("text",a("w_RuleStyle")),$("ivs_t_direction").set("text",a("w_direction1")),$("ivs_t_MaxTarget").set("text",a("w_MaxTargets")),$("ivs_t_MinTarget").set("text",a("w_MinTargets")),$("ivs_t_MinDuration").set("text",a("w_MinDuration")),$("ivs_t_ReportInterval").set("text",a("w_ReportInterval")),$("ivs_rule_cope").set("text",a("copy")),$("ivs_rule_copyto_title").set("text",a("w_coptTo")),$("ivs_rule_area_set_title").set("text",a("w_areaSet")),$("ivs_rule_alarm_set_title").set("text",a("w_alarmSet")),$("ivs_rule_paraset_title").set("text",a("w_parameterSet")),$("ivs_rule_action_list").set("text",a("w_inspectActionList")),$("ivs_rule_action_appear_title").set("text",a("w_appear")),$("ivs_rule_action_inside_title").set("text",a("w_inArea")),$("ivs_rule_action_disappear_title").set("text",a("w_disappear")),$("ivs_rule_action_cross_title").set("text",a("w_throughArea")),$("ivs_rule_filter_min_title").set("text",a("w_leastSize")),$("ivs_rule_filter_max_title").set("text",a("w_mostSize")),$("ivs_rule_filter_draw").set("text",a("w_protract")),$("ivs_rule_filter_clean").set("text",a("w_cleanup")),$("ivs_direction3").set("text",a("w_direction1")),$("ivs_showSetDialog").set("text",a("w_Set")),$("ivs_t_kinescope").set("text",a("w_Record")),$("ivs_t_alarmexport").set("text",a("w_Alarm Out")),$("ivs_t_sendmail").set("text",a("w_Send E-Mail")),$("ivs_t_grasp1").set("text",a("w_Snap")),$("ivs_rule_refresh").set("text",a("w_Refresh")),$("ivs_rule_confirm").set("text",a("w_Save")),$("ivs_rule_dialog_set").set("text",a("w_Set")),$("ivs_t_sun").set("text",a("w_Sunday")),$("ivs_t_mon").set("text",a("w_Monday")),$("ivs_t_tue").set("text",a("w_Tuesday")),$("ivs_t_wen").set("text",a("w_Wednesday")),$("ivs_t_thu").set("text",a("w_Thursday")),$("ivs_t_fri").set("text",a("w_Friday")),$("ivs_t_sat").set("text",a("w_Saturday")),$("ivs_rule_day_title0").set("text",a("w_Sunday")),$("ivs_rule_day_title1").set("text",a("w_Monday")),$("ivs_rule_day_title2").set("text",a("w_Tuesday")),$("ivs_rule_day_title3").set("text",a("w_Wednesday")),$("ivs_rule_day_title4").set("text",a("w_Thursday")),$("ivs_rule_day_title5").set("text",a("w_Friday")),$("ivs_rule_day_title6").set("text",a("w_Saturday")),$("ivs_rule_filter_title").set("text",a("w_aimFiltrate"));var d=$("ivs_slct_chkType").getElements("option");d[0].setProperty("text",a("w_runFast")),d[1].setProperty("text",a("w_speedupSuuddely")),d[2].setProperty("text",a("w_speeddownSuuddely"));var e=$("ivs_slct_direction0").getElements("option");e[0].setProperty("text",a("w_LeftToRight")),e[1].setProperty("text",a("w_RightToLeft")),e[2].setProperty("text",a("w_toBoth")),$("ivs_title_minDuration0").set("text",a("w_MinDuration")),$("ivs_title_minDuration1").set("text",a("w_MinDuration")),$("ivs_title_minDuration2").set("text",a("w_MinDuration")),$("ivs_title_minDuration4").set("text",a("w_MinDuration")),$("ivs_title_minDuration5").set("text",a("w_MinDuration")),$("ivs_title_chkType").set("text",a("w_checkType")),$("ivs_title_delicacy").set("text",a("w_Sensitivity")),$("ivs_title_low").set("text",a("w_low")),$("ivs_title_high").set("text",a("w_high")),$("ivs_title_speed").set("text",a("w_springSpeed")),$("ivs_title_minTargets2").set("text",a("w_touchOffAlarmNum")),$("ivs_title_reportInterval2").set("text",a("w_ReportInterval")),$("ivs_direction4").set("text",a("w_direction1")),$("ivs_title_scene").set("text",a("w_scene")),$("ivs_title_sizeFilter").set("text",a("w_aimFiltrate")),$("ivs_title_antiDisturbance").set("text",a("w_antiDisturbance")),$("ivs_rule_day_all_title").set("text",a("w_Weekall")),$("ivs_t_tmsection0").set("text",a("w_Time1")),$("ivs_t_tmsection1").set("text",a("w_Time2")),$("ivs_t_tmsection2").set("text",a("w_Time3")),$("ivs_t_tmsection3").set("text",a("w_Time4")),$("ivs_t_tmsection4").set("text",a("w_Time5")),$("ivs_t_tmsection5").set("text",a("w_Time6")),$("ivs_rule_day_confirm").set("text",a("w_Confirm")),$("ivs_rule_day_cancel").set("text",a("w_Cancel")),$("ivs_doDeleteINFO").set("text",a("w_doDeleteINFO")),$("ivs_scene_dialog_confirm").set("text",a("w_Confirm")),$("ivs_scene_dialog_cancel").set("text",a("w_Cancel")),$("ivs_t_bftime").set("text",a("w_TimeAlarmPeriod"));var f=$("ivs_direction0").getElements("option");f[0].setProperty("text",a("w_Enter")),f[1].setProperty("text",a("w_Leave")),f[2].setProperty("text",a("w_Both"));var g=$("ivs_direction1").getElements("option");g[0].setProperty("text",a("w_LeftToRight")),g[1].setProperty("text",a("w_RightToLeft")),g[2].setProperty("text",a("w_toBoth")),$("facedectetion_pitching_angle_label").set("text",a("w_pitchingAngle")),$("facedectetion_left_angle_label").set("text",a("w_leftAngle")),$("MainDirection_draw0").set("text",a("w_protract")),$("MainDirection_delDraw0").set("text",a("w_cleanup")),$("MainDirection_label").set("text",a("w_MainDirection")),$("tp_wait_time").set("text",a("w_AlarmWait")),$("tp_allow_time").set("text",a("w_tp_allow_time")),$("tp_second_1").set("text",a("w_Second")),$("tp_hour").set("text",a("Hour")),$("tp_min").set("text",a("Minute")),$$(".ivs_second").set("text",a("w_Second")),$$(".ivs_hour").set("text",a("Hour")),$("ivs_upload_info_title").set("text",a("w_ivs_upload_info"))},render:function(){E.Mode=$("ivs_glogal_scene").value,"FaceDetection"==E.Mode?($("ivs_rule_enable_title").set("text",a("")),$("ivs_rule_draw_title").set("text",a("")),$("ivs_rule_dele_title").set("text",a(""))):($("ivs_rule_enable_title").set("text",a("Enable")),$("ivs_rule_draw_title").set("text",a("w_protract")),$("ivs_rule_dele_title").set("text",a("w_delete"))),s&&s.close(),Page.ivsSDConfig._stopSingleIVS(),E.videoAnaly.getCaps().done(function(a){d=a;var b=d.MaxPointOfLine,c=d.MaxPointOfRegion;z=d.SupportedRules,$("ocx").SetMaxPntNum(b,c),E._showSupportedDetectTypes(),E._showTriggerPosition()}),Page.ivsSDConfig._openIVSVideo.delay(10,"",["ivs_rule_vedio",Page.ivsSDConfig.Tab.rule._onRuleRefresh]),E._renderSelect(),"FaceDetection"==$("ivs_glogal_scene").value?($("ivs_rule_addRule").addClass("fn-hide"),$("ivs_copyAlarm").addClass("fn-hide")):($("ivs_rule_addRule").removeClass("fn-hide"),$("ivs_copyAlarm").removeClass("fn-hide"))},bind:function(){$("ivs_tab_rule").style.display="",$("ivs_tab_rule").style.position="absolute",$("ivs_tab_rule").style.top="-10000px",$("ivs_rule_MoveDetection").style.display="",$("ivs_rule_content").style.display="",i=new Slider($("ivs_slider_Sensbg"),$("ivs_slder_SK"),{range:[1,10],steps:9,wheel:!0,onChange:function(a){$("ivs_slder_SK").setProperty("title",a),w=a}}),$("ivs_rule_MoveDetection").style.display="none",$("ivs_rule_TrafficParking").style.display="",n=new FineSlider("ivs_Parking_first","ivs_Parking_end",{range:[1,10],onComplete:function(){}}),$("ivs_rule_TrafficParking").style.display="none",$("ivs_rule_TrafficCrossLane").style.display="",r=new FineSlider("ivs_CrossLane_first","ivs_CrossLane_end",{range:[1,10],onComplete:function(){}}),$("ivs_rule_TrafficCrossLane").style.display="none",$("ivs_rule_TrafficOverLine").style.display="",t=new FineSlider("ivs_OverLine_first","ivs_OverLine_end",{range:[1,10],onComplete:function(){}}),$("ivs_rule_TrafficOverLine").style.display="none",$("ivs_rule_TrafficRetrograde").style.display="",u=new FineSlider("ivs_Retrograde_first","ivs_Retrograde_end",{range:[1,10],onComplete:function(){}}),$("ivs_rule_TrafficRetrograde").style.display="none",$("ivs_rule_TrafficU-Turn").style.display="",x=new FineSlider("ivs_UTurn_first","ivs_UTurn_end",{range:[1,10],onComplete:function(){}}),$("ivs_rule_TrafficU-Turn").style.display="none",$("ivs_rule_TrafficVehicleInBusRoute").style.display="",y=new FineSlider("ivs_BusRoute_first","ivs_BusRoute_end",{range:[1,10],onComplete:function(){}}),$("ivs_rule_TrafficVehicleInBusRoute").style.display="none",$("ivs_rule_TrafficBacking").style.display="",A=new FineSlider("ivs_Backing_first","ivs_Backing_end",{range:[1,10],onComplete:function(){}}),$("ivs_rule_TrafficBacking").style.display="none",$("ivs_rule_RioterDetection").style.display="",B=new FineSlider("ivs_RioterDetection_first","ivs_RioterDetection_end",{range:[1,10],onComplete:function(){}}),$("ivs_rule_RioterDetection").style.display="none",$("ivs_rule_SmokeDetection").style.display="",D=new FineSlider("ivs_smoke_first","ivs_smoke_end",{range:[1,10],onComplete:function(){}}),$("ivs_rule_SmokeDetection").style.display="none",$("ivs_rule_content").style.display="none",$("ivs_tab_rule").style.display="none",$("ivs_tab_rule").style.position="",$("ivs_tab_rule").style.top="",E._attachLimitCompare("ivs_MinTargets","ivs_MaxTargets",1,100,!0),E._attachLimitCompare("ivs_MaxTargets","ivs_MinTargets",1,100,!1),attachLimit("ivs_MinDuration",1,600),attachLimit("ivs_ReportInterval",0,600),attachLimit("ivs_input_speed",1,100),attachLimit("ivs_input_minDuration2",1,600),attachLimit("ivs_input_reportInterval2",0,600),attachLimit("ivs_input_minDuration0",6,1800),attachLimit("ivs_input_minDuration1",1,600),attachLimit("ivs_input_minDuration4",6,1800),attachLimit("ivs_input_minDuration5",6,1800),attachLimit("ivs_input_minDuration6",0,65535),attachLimit("traffic_park_delay",2,180),attachLimit("traffic_park_allow",6,10800),attachLimit("traffic_park_allow_h",0,2),attachLimit("traffic_park_allow_m",0,59),attachLimit("traffic_park_allow_s",0,59),attachTimeEvent("ivs_i_t0"),attachTimeEvent("ivs_i_t1"),attachTimeEvent("ivs_i_t2"),attachTimeEvent("ivs_i_t3"),attachTimeEvent("ivs_i_t4"),attachTimeEvent("ivs_i_t5"),attachLimit("facedectetion_pitching_angle_start",0,45),E._attachLimits("facedectetion_pitching_angle_end",45),attachLimit("facedectetion_left_angle",0,45),E._attachLimits("facedectetion_right_angle",45),attachLimit("ivs_face_TriggerTargets",1,35),$("ivs_rule_addRule").addEvent("click",E._onAddRuleClick),$("ivs_rule_choiceScene").addEvent("change",E.onSceneChange),$("ivs_rule_refresh").addEvent("click",E._cclRuleCfg),$("ivs_rule_confirm").addEvent("click",E._postRuleCfg),$("MainDirection_draw0").addEvent("click",E._drawLine),$("MainDirection_delDraw0").addEvent("click",E._delLine),$("ivs_showSetDialog").addEvent("click",function(){0!=$$("#ivs_ruleList tr").length&&(c.hide(),E._drawTimeChartAll(),E._putTimePeriod(0),s.show())}),$$(".ruleperiodset").addEvent("click",function(){var a=this.id.split("_");E._putTimePeriod(a[3]-0)}),$$(".ruleperiodday").addEvent("click",E._onWorkDayClick),$("ivs_rule_day_all").addEvent("click",E._onAllWorkDayClick),$("ivs_rule_filter_draw").addEvent("click",Page.ivsSDConfig._drawArea),$("ivs_rule_filter_clean").addEvent("click",Page.ivsSDConfig._delArea),$$(".ruledirection").addEvent("change",E._onWayChange),$("ivs_rule_cope").addEvent("click",function(){E._saveRuleInfo(),E._copyAlarmCfg()}),$("ivs_rule_action_inside").addEvent("click",E._showInAreaInput),$("ivs_rule_action_cross").addEvent("click",E._showThroughAreaInput),$("ivs_rule_filter").addEvent("click",E._showDisableRegion),$("facedectetion_choiceScene").addEvent("change",E._onFaceSceneChange),$("ivs_rule_TRe_draw").addEvent("click",E._addTRetrogradeDirecttion),$("ivs_rule_TBa_draw").addEvent("click",E._addTBackingDirecttion),$("ivs_rule_RD_draw").addEvent("click",E._addMinGatherRegion)},_addMinGatherRegion:function(){var a=g[k].Scene[q].PresetID;$("ocx").AddShape(6,"","RuleRect",-1,a)},_addTRetrogradeDirecttion:function(){if($("ivs_rule_TRe_draw").hasClass("ui-button-hover"))$("ivs_rule_TRe_draw").removeClass("ui-button-hover");else{var a=g[k].Scene[q].PresetID,b=$$(".ui-table-tr-current .showRuleName")[0].get("text")+"_dir";$("ocx").SetCurShape(b),$("ocx").AddShape(2,"TrafficRetrograde",b,-1,a),$("ivs_rule_TRe_draw").addClass("ui-button-hover")}},_addTBackingDirecttion:function(){if($("ivs_rule_TBa_draw").hasClass("ui-button-hover"))$("ivs_rule_TBa_draw").removeClass("ui-button-hover");else{var a=g[k].Scene[q].PresetID,b=$$(".ui-table-tr-current .showRuleName")[0].get("text")+"_dir";
$("ocx").SetCurShape(b),$("ocx").AddShape(2,"TrafficBacking",b,-1,a),$("ivs_rule_TBa_draw").addClass("ui-button-hover")}},_onRuleRefresh:function(){if(j){Page.ivsSDConfig.Tab.rule._buildJson();var a=l[p]?l[p].Name:"";$("ocx").SetCurShape(a)}Page.ivsSDConfig.ConfigManager.getConfig(["IntelliTrackScene","VideoAnalyseRule"]).done(function(a){g=a[0].params.table,j=null==a[1].params||null==a[1].params.table||null==a[1].params.table[0]?[[]]:a[1].params.table,E._renderRuleElements()})},_attachLimitCompare:function(a,b,c,d,e){var f=$(a),g=$(b);f.removeEvents("keyup"),f.removeEvents("blur"),f.addEvents({keyup:function(){limit(this,d)},blur:function(){limit(this,d),limitMin(this,c),e?this.value-0>g.value-0&&(this.value=g.value):this.value-0<g.value-0&&(this.value=g.value)}})},setFilterValue:function(a){var b=JSON.decode(a).FilterArea,c=b[0][0],d=b[0][1],e=b[1][0],f=b[1][1];$("ivs_rule_filter_minw").value=c,$("ivs_rule_filter_minh").value=d,$("ivs_rule_filter_maxw").value=e,$("ivs_rule_filter_maxh").value=f},minGatherRegion:function(a){var b=JSON.decode(a).OutPutRuleRect,c=j[k],d=c[o],e=d.Type;switch(e){case"RioterDetection":d.Config.MinDetectRect=b}},OutPutShapeRect:function(a){var b=j[k],c=b[o],d=c.Type,e=JSON.decode(a);switch(d){case"CrossLineDetection":c.Config.DetectLine=e.Config.DetectLine;break;case"CrossRegionDetection":c.Config.DetectRegion=e.Config.DetectRegion;break;case"TakenAwayDetection":c.Config.DetectRegion=e.Config.DetectRegion;break;case"MoveDetection":c.Config.DetectRegion=e.Config.DetectRegion;break;case"WanderDetection":c.Config.DetectRegion=e.Config.DetectRegion;break;case"CrossFenceDetection":c.Config.UpstairsLine=e.Config.UpstairsLine,c.Config.DownstairsLine=e.Config.DownstairsLine;break;case"LeftDetection":c.Config.DetectRegion=e.Config.DetectRegion;break;case"ParkingDetection":c.Config.DetectRegion=e.Config.DetectRegion;break;case"VideoAbnormalDetection":c.Config.DetectRegion=e.Config.DetectRegion;break;case"TrafficRetrograde":e.Config.Direction?(c.Config.Direction=e.Config.Direction,$("ivs_rule_TRe_draw").removeClass("ui-button-hover"),$("ocx").SetCurShape(e.Name)):c.Config.DetectRegion=e.Config.DetectRegion;break;case"TrafficU-Turn":c.Config.DetectRegion=e.Config.DetectRegion;break;case"TrafficParking":c.Config.DetectRegion=e.Config.DetectRegion;break;case"TrafficVehicleInBusRoute":c.Config.DetectRegion=e.Config.DetectRegion;break;case"TrafficBacking":e.Config.Direction?(c.Config.Direction=e.Config.Direction,$("ivs_rule_TBa_draw").removeClass("ui-button-hover"),$("ocx").SetCurShape(e.Name)):c.Config.DetectRegion=e.Config.DetectRegion;break;case"TrafficTollGate":c.Config.DetectLine=e.Config.DetectLine;break;case"FaceDetection":break;case"VideoAbnormalDetection":case"RioterDetection":case"SmokeDetection":default:c.Config.DetectRegion=e.Config.DetectRegion}},_onWayChange:function(){if(!(j[k].length<1)){var a=j[k][o];j[k].length;var b=this.selectedIndex;$("ocx").SetCurDirection(a.Type,b)}},_onAllWorkDayClick:function(){for(var a=0;7>a;a++)$("ivs_rule_day_"+a).checked=$("ivs_rule_day_"+a).disabled?!0:this.checked},_drawLine:function(){},_delLine:function(){$("min1").value="",$("min2").value="",$("ocx").DeleteShape(a("OCX_MainDirection"))},buildGlobalJson:function(){var a=0;a=$("facedectetion_choiceScene").value,0==a&&(a="");var b="Scene"+a,c=h[k],d="",e=c[b].Detail.MainDirection;d+='{"config":{"MainDirection":[['+e[0]+"],["+e[1]+"]]}}",v='{"result":true,"params":{"table":['+d+"]}}"},_OutPutGlobalRect:function(a){var b=JSON.decode(a);$("min1").value=b[0].config.MainDirection[0],$("min2").value=b[0].config.MainDirection[1]},_renderRuleElements:function(){$("ivs_rule_choiceScene_wrap").style.display="block",$("ivs_rule_content").style.display="block",E._buildJson(),$("ivs_rule_choiceScene").innerHTML="",$("ivs_ruleList").innerHTML="",g[k].Scene=g[k].Scene||[];for(var a,b=j[k],c=g[k].Scene.length,d=0;c>d;d++)a=g[k].Scene[d].PresetID,$("ivs_rule_choiceScene").options.add(new Option(g[k].Scene[d].Name,d));if(b.length>0)if(E._isShowAttributeLinkSet(!0),0==b[0].PtzPresetId){if(!(b.length>1)){var e=-1==q?0:q;return $("ivs_rule_choiceScene").value=e,c>0&&E._isgotoScene(g[k].Scene[e].PresetID),void($("ivs_ruleList").innerHTML="")}var e=-1==q?1:q,f=g[k].Scene[e]?g[k].Scene[e].PresetID:1;E._isgotoScene(f);for(var d=0;c>d;d++)g[k].Scene[d].PresetID==f&&(-1!=q?($("ivs_rule_choiceScene").value=q,E._showRules(q)):(q=0,$("ivs_rule_choiceScene").value=0,E._showRules(0)))}else{var f=b[0].PtzPresetId;-1!=q&&(f=g[k].Scene[q].PresetID,$("ivs_rule_choiceScene").value=q),E._isgotoScene(f);for(var d=0;c>d;d++)g[k].Scene[d].PresetID==f&&(-1!=q?($("ivs_rule_choiceScene").value=q,E._showRules(q)):($("ivs_rule_choiceScene").value=d,E._showRules(d)))}else if(E._isShowAttributeLinkSet(!1),c>0){var h=g[k].Scene[0].PresetID;-1!=q?($("ivs_rule_choiceScene").value=q,h=g[k].Scene[q].PresetID,Page.ivsSDConfig._gotoScene(h)):Page.ivsSDConfig._gotoScene(h)}},_isShowAttributeLinkSet:function(a){$("ivs_direction0").disabled=a?"":"disabled",$("ivs_MaxTargets").disabled=a?"":"disabled",$("ivs_MinTargets").disabled=a?"":"disabled",$("ivs_MinDuration").disabled=a?"":"disabled",$("ivs_ReportInterval").disabled=a?"":"disabled",$("ivs_RecordEnable").disabled=a?"":"disabled",$("ivs_AlarmOutEnable").disabled=a?"":"disabled",$("ivs_MailEnable").disabled=a?"":"disabled",$("ivs_SnapshotEnable").disabled=a?"":"disabled",$("ivs_rule_copyto").disabled=a?"":"disabled",$("ivs_rule_filter").disabled=a?"":"disabled",$("ivs_rule_action_inside").disabled=a?"":"disabled",$("ivs_rule_action_cross").disabled=a?"":"disabled",1==a?$$("#ivs_rule_filter_draw","#ivs_rule_filter_clean","#ivs_showSetDialog","#ivs_rule_cope").removeClass("ui-button-disabled"):$$("#ivs_rule_filter_draw","#ivs_rule_filter_clean","#ivs_showSetDialog","#ivs_rule_cope").addClass("ui-button-disabled")},_putValue:function(){-1!=q&&0!=q?($("facedectetion_pitching_angle_end").value=h[k]["Scene"+q].Detail.FaceAngleDown,$("facedectetion_pitching_angle_start").value=h[k]["Scene"+q].Detail.FaceAngleUp,$("facedectetion_left_angle").value=h[k]["Scene"+q].Detail.FaceAngleLeft,$("facedectetion_right_angle").value=h[k]["Scene"+q].Detail.FaceAngleRight,$("min1").value=h[k]["Scene"+q].Detail.MainDirection[0][0]+","+h[k]["Scene"+q].Detail.MainDirection[0][1],$("min2").value=h[k]["Scene"+q].Detail.MainDirection[1][0]+","+h[k]["Scene"+q].Detail.MainDirection[1][1]):($("facedectetion_pitching_angle_end").value=h[k].Scene.Detail.FaceAngleDown,$("facedectetion_pitching_angle_start").value=h[k].Scene.Detail.FaceAngleUp,$("facedectetion_left_angle").value=h[k].Scene.Detail.FaceAngleLeft,$("facedectetion_right_angle").value=h[k].Scene.Detail.FaceAngleRight,$("min1").value=h[k].Scene.Detail.MainDirection[0][0]+","+h[k].Scene.Detail.MainDirection[0][1],$("min2").value=h[k].Scene.Detail.MainDirection[1][0]+","+h[k].Scene.Detail.MainDirection[1][1])},_isgotoScene:function(a){Page.ivsSDConfig.IDevIntelliTracker.gotoScene(a).done(function(){var a=$("ivs_rule_choiceScene").value;E._showRules(a),E._changeStyle(0)})},_onDrawRuleClick:function(b){if(!$("chkrule_"+b).checked)return void remarkDisplay("ivs_rule_remark",a("w_IVSRuleError"),3e3,1);E._chkRuleList(b);var c=j[k],d=c[o];d.Config.DetectLine=null,d.Config.DetectRegion=null,d.Config.UpstairsLine=null,d.Config.DownstairsLine=null,E._drawRuleType(b)},_onDeleRuleClick:function(a){var b=$("ivs_rule_choiceScene").value,c=l[a].Name;$("ocx").DeleteShape(c),$("ocx").DeleteShape(c+"_dir"),j[k].erase(j[k][m[a]]),l.erase(l[a]),m.erase(m[a]);var d=j[k];return E._isShowAttributeLinkSet(d.length<1?!1:!0),l.length<1?(o=-1,$("ocx").SetCurShape(""),void($("ivs_ruleList").innerHTML="")):(l.length<2&&($("ivs_rule_copyto").innerHTML=""),E._showRules(b),void E._changeStyle(p>a?p-1:a>p?p:0))},_attachLimits:function(a,b){var c=$(a);c.removeEvents("keyup"),c.removeEvents("blur"),c.addEvents({keyup:function(){E._limite(this,b)},blur:function(){E._limiteBlur(this,b)}})},_limite:function(a,b){var c=a.value,d="-";if(""!=c){var e=c.replace(/[^\d]/g,"");e-0>b&&(e=b),a.value=a.value-0==0?0:d+e}},_limiteBlur:function(a,b){var c=a.value,d="-";if(""==c)return void(a.value=0);var e=c.replace(/[^\d]/g,"");e-0>b&&(e=b),a.value-0==0?a.value=0:(""==e&&(e=0),a.value=d+e-0)},_onAddRuleClick:function(){var b=$("ivs_rule_choiceScene").value;if(!b||l.length>=E.MaxRules)return void remarkDisplay("ivs_rule_remark",a("w_maxRules_enough"),3e3,1);for(var c=g[k].Scene[b].PresetID,d=g[k].Scene[b].Name,e=j[k],f=0,i=[],n=0;n<e.length;n++){var o=e[n].Name.split("_");if(d==o[0]&&e[n].PtzPresetId!=c){var p=0;for(p=0;p<i.length&&e[n].PtzPresetId!=i[p];p++);p==i.length&&(i[f]=e[n].PtzPresetId,f+=1)}}var q=[];q=0==f?[d+"_1",d+"_2",d+"_3",d+"_4",d+"_5",d+"_6",d+"_7",d+"_8",d+"_9",d+"_a"]:[d+"_1("+f+")",d+"_2("+f+")",d+"_3("+f+")",d+"_4("+f+")",d+"_5("+f+")",d+"_6("+f+")",d+"_7("+f+")",d+"_8("+f+")",d+"_9("+f+")",d+"_a("+f+")"];for(var r=0;r<l.length;r++)q.contains(l[r].Name)&&q.erase(l[r].Name);var s=JSON.encode([[1085,928],[921,6771],[6983,6635],[7044,1038]]),t='{"Config":{"Action":["Cross"],"DetectRegion":'+s+',"Direction":"Enter","MaxTargets":5,"MinDuration":5,"MinTargets":1,"ReportInterval":0,"SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]}},"Enable":true,"EventHandler":{"AlarmOutChannels":[0],"AlarmOutEnable":true,"AlarmOutLatch":10,"BeepEnable":true,"Dejitter":0,"Delay":30,"ExAlarmOutChannels":[0],"ExAlarmOutEnable":false,"LogEnable":true,"MMSEnable":false,"MailEnable":false,"MatrixChannels":[0],"MatrixEnable":true,"MessageEnable":true,"OnVideoMessageEnable":false,"PtzLink":[["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0]],"PtzLinkEnable":false,"RecordChannels":[0],"RecordEnable":true,"RecordLatch":10,"SnapshotChannels":[0],"SnapshotEnable":false,"SnapshotPeriod":0,"SnapshotTimes":1,"SnapshotTitleEnable":false,"TimeSection":[["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"]],"TourChannels":[0],"TourEnable":true,"TourSplit":"Split1","VoiceEnable":false},"Name":"'+q[0]+'","ObjectTypes":["Unknown"],"PtzPresetId":'+c+',"SceneType":"Normal","Type":"CrossRegionDetection"}';"Traffic"==$("ivs_glogal_scene").value?(t='{"Config":{"DetectRegion":[],"LaneNumber":0,"ReportTimes":4,"Delay":30,"ParkingAllowedTime":600},"Enable":true,"EventHandler":{"AlarmOutChannels":[0],"AlarmOutEnable":true,"AlarmOutLatch":10,"BeepEnable":true,"Dejitter":0,"Delay":30,"ExAlarmOutChannels":[0],"ExAlarmOutEnable":false,"LogEnable":false,"MMSEnable":false,"MailEnable":false,"MatrixChannels":[0],"MatrixEnable":true,"MessageEnable":true,"OnVideoMessageEnable":false,"PtzLink":[["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0]],"PtzLinkEnable":false,"RecordChannels":[0],"RecordEnable":false,"RecordLatch":10,"SnapshotChannels":[0],"SnapshotEnable":true,"SnapshotPeriod":0,"SnapshotTimes":1,"SnapshotTitleEnable":false,"TimeSection":[["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"]],"TourChannels":[0],"TourEnable":true,"TourSplit":"Split1","VoiceEnable":false},"Name":"'+q[0]+'","ObjectTypes":["Unknown"],"PtzPresetId":'+c+',"SceneType":"Traffic","Type":"TrafficParking"}',"Gate"==h[k].Scene.Detail.Type&&(t='{"Config":{"Direction":[\'Obverse\'], "SnapMotorcycle":true,"DetectLine":[],"LaneNumber":0},"Enable":true,"EventHandler":{"AlarmOutChannels":[0],"AlarmOutEnable":true,"AlarmOutLatch":10,"BeepEnable":true,"Dejitter":0,"Delay":30,"ExAlarmOutChannels":[0],"ExAlarmOutEnable":false,"LogEnable":false,"MMSEnable":false,"MailEnable":false,"MatrixChannels":[0],"MatrixEnable":true,"MessageEnable":true,"OnVideoMessageEnable":false,"PtzLink":[["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0]],"PtzLinkEnable":false,"RecordChannels":[0],"RecordEnable":false,"RecordLatch":10,"SnapshotChannels":[0],"SnapshotEnable":true,"SnapshotPeriod":0,"SnapshotTimes":1,"SnapshotTitleEnable":false,"TimeSection":[["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"]],"TourChannels":[0],"TourEnable":true,"TourSplit":"Split1","VoiceEnable":false},"Name":"'+q[0]+'","ObjectTypes":[\'Vehicle\',\'Plate\'],"PtzPresetId":'+c+',"SceneType":"Traffic","Type":"TrafficTollGate"}')):"FaceDetection"==$("ivs_glogal_scene").value&&(t='{"Config":{"HumanFaceTypes":[\'Normal\',\'HideNose\'],"DetectRegion":[],"MinDuration":"10","TriggerTargets":1,"SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]}},"Enable":true,"EventHandler":{"AlarmOutChannels":[0],"AlarmOutEnable":true,"AlarmOutLatch":10,"BeepEnable":true,"Dejitter":0,"Delay":30,"ExAlarmOutChannels":[0],"ExAlarmOutEnable":false,"LogEnable":true,"MMSEnable":false,"MailEnable":false,"MatrixChannels":[0],"MatrixEnable":true,"MessageEnable":true,"OnVideoMessageEnable":false,"PtzLink":[["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0],["None",0]],"PtzLinkEnable":false,"RecordChannels":[0],"RecordEnable":true,"RecordLatch":10,"SnapshotChannels":[0],"SnapshotEnable":false,"SnapshotPeriod":0,"SnapshotTimes":1,"SnapshotTitleEnable":false,"TimeSection":[["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"],["1 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59","0 00:00:00-23:59:59"]],"TourChannels":[0],"TourEnable":true,"TourSplit":"Split1","VoiceEnable":false},"Name":"'+q[0]+'","ObjectTypes":["Unknown"],"PtzPresetId":'+c+',"Type":"FaceDetection"}'),j[k].push(JSON.decode(t)),l.push(JSON.decode(t)),m.push(j[k].length-1),E._isShowAttributeLinkSet(!0),E._showRules(b),E._changeStyle(m.length-1),E._buildJson()},_drawTimeChartAll:function(){var a=j[k],b=a[o].EventHandler.TimeSection;$("ivs_chtZone").getElements("div").each(function(a){a.dispose()});for(var c=0;7>c;c++)for(var d=0;6>d;d++){var e=parsrTimeEx(b[c][d]);if(getBitEx(e[0],0)){var f=createDiv(e,c,0);Browser.ie9||Browser.ie10?$("ivs_chtZone").appendChild(f):f.inject($("ivs_chtZone"))}}},_putTimePeriod:function(a){for(var b=j[k][o].EventHandler.TimeSection[a],c=0;6>c;c++){var d=parsrTimeEx(b[c]);$("ivs_c_ts"+c).checked=getBitEx(d[0],0)?!0:!1;for(var e=0;6>e;e++)$("ivs_i_t"+c+e).value=chk10(d[e+1])}for(var c=0;7>c;c++)$("ivs_rule_day_"+c).checked=!1,$("ivs_rule_day_"+c).disabled=!1,$("ivs_rule_day_title"+c).style.color="#3c3c3c";$("ivs_rule_day_all").checked=!1,$("ivs_rule_day_"+a).checked=!0,$("ivs_rule_day_"+a).disabled=!0,$("ivs_rule_day_title"+a).style.color="red"},_onWorkDayClick:function(){$("ivs_rule_day_all").checked=$("ivs_rule_day_0").checked&&$("ivs_rule_day_1").checked&&$("ivs_rule_day_2").checked&&$("ivs_rule_day_3").checked&&$("ivs_rule_day_4").checked&&$("ivs_rule_day_5").checked&&$("ivs_rule_day_6").checked},_changeStyle:function(a){if(!$chk(l)||l.length<1)return p=-1,void(o=-1);a=l.length>a?a:a-1;var b=j[k],c=l.length;o=m[a];for(var d=0;c>d;d++)$("ruleListnum_"+d)&&($("ruleListnum_"+d).className=d%2?"ui-table-tr-odd":"");var e=l[a].Name,f=l[a].PtzPresetId;p=$("ruleListnum_"+a)?a:0,$("ruleListnum_"+p).className="ui-table-tr-current",E._putRuleInfo(p),$("ocx").SetCurShape(e),$("ocx").SetCurPtzID(f);var g=b[o].Type;$$(".ivs_eightrule").setStyle("display","none"),$("ivs_rule_action").style.display="CrossRegionDetection"==g?"":"none","VideoAbnormalDetection"==g?$("ivs_targetFiter").addClass("fn-hide"):$("ivs_targetFiter").removeClass("fn-hide"),"Traffic"==$("ivs_glogal_scene").value&&($("ivs_targetFiter").addClass("fn-hide"),$("ivs_rule_objextType").addClass("fn-hide"),$$("#ivs_rule_content .fn-horizontal-line"),$("ivs_SnapshotEnable").setProperty("disabled","disabled"),$("ivs_SnapshotEnable").setProperty("checked","checked")),E._showCopyRule(),null==$("ivs_rule_"+g)&&alert("程序暂不支持新增的规则："+g+"，请联系技术支持以获得更多帮助。"),$("ivs_rule_"+g).setStyle("display","")},_showCopyRule:function(){var b=$("ivs_rule_choiceScene").value,c=l.length;if(b&&0!=c){$("ivs_rule_copyto").empty();for(var d=0;c>d;d++)if(d!=p){var e=new Element("option",{title:l[d].Name,value:m[d],text:l[d].Name});e.inject($("ivs_rule_copyto"))}var e=new Element("option",{title:a("w_ALL"),value:"all",text:a("w_ALL")});e.inject($("ivs_rule_copyto"))}},_copyAlarmCfg:function(){var a=$("ivs_rule_copyto").value;if(a){var b=j[k],c=m[p];if("all"!=a)b[a].EventHandler=$unlink(b[c].EventHandler);else for(var d=0;d<m.length;d++){var e=m[d];b[e].EventHandler=$unlink(b[c].EventHandler)}}},_renderSelect:function(a){sceneN=void 0==a||-1==a?$("ivs_rule_choiceScene").selectedIndex||q:a;var b="Scene"+sceneN;b="Scene0"==b?"Scene":b,H&&H[k][0][b]&&h[k]&&(h[k][b]=H[k][0][b]);var c=[];h[k][b]&&(c=h[k][b].Detail||[]);var d=0,e=$("ivs_rule_select_TrafficCrossLane"),f=$("ivs_rule_select_TrafficOverLine"),g=$("ivs_rule_select_TrafficRetrograde"),i=$("ivs_rule_select_TrafficU-Turn"),j=$("ivs_rule_select_TrafficVehicleInBusRoute"),l=$("ivs_rule_select_TrafficBacking");e.empty(),f.empty(),g.empty(),i.empty(),j.empty(),l.empty();var m=0;for(c&&c.Lanes&&(m=c.Lanes.length||0),d=0;m>d;d++)e.options.add(new Option(c.Lanes[d].Number,d)),f.options.add(new Option(c.Lanes[d].Number,d)),g.options.add(new Option(c.Lanes[d].Number,d)),i.options.add(new Option(c.Lanes[d].Number,d)),j.options.add(new Option(c.Lanes[d].Number,d)),l.options.add(new Option(c.Lanes[d].Number,d))},_putRuleInfo:function(a){var b=m[a],c=l[a].Type,d=j[k][b];switch(c){case"CrossLineDetection":$("ivs_rule_triggerposition0").value=d.Config.TriggerPosition[0],$("ivs_direction1").value=d.Config.Direction;break;case"CrossFenceDetection":$("ivs_rule_triggerposition4").value=d.Config.TriggerPosition[0],$("ivs_slct_direction0").value=d.Config.Direction;break;case"CrossRegionDetection":var e=d.Config.Action;$("ivs_rule_action_appear").checked=e.contains("Appear")?!0:!1,$("ivs_rule_action_inside").checked=e.contains("Inside")?!0:!1,$("ivs_rule_action_disappear").checked=e.contains("Disappear")?!0:!1,$("ivs_rule_action_cross").checked=e.contains("Cross")?!0:!1,E._showInAreaInput(),E._showThroughAreaInput(),$("ivs_direction0").value=d.Config.Direction,$("ivs_MaxTargets").value=d.Config.MaxTargets,$("ivs_MinTargets").value=d.Config.MinTargets,$("ivs_MinDuration").value=d.Config.MinDuration,$("ivs_ReportInterval").value=d.Config.ReportInterval;break;case"TakenAwayDetection":$("ivs_rule_triggerposition1").value=d.Config.TriggerPosition[0],$("ivs_input_minDuration0").value=d.Config.MinDuration;break;case"MoveDetection":$("ivs_slct_chkType").value=d.Config.DetectType[0],$("ivs_rule_triggerposition2").value=d.Config.TriggerPosition[0],$("ivs_input_minDuration1").value=d.Config.MinDuration,$("ivs_input_speed").value=d.Config.TriggerSpeed,i.set(d.Config.Sensitivity);break;case"WanderDetection":$("ivs_rule_triggerposition3").value=d.Config.TriggerPosition[0],$("ivs_input_minTargets2").value=d.Config.TriggerTargetsNumber,$("ivs_input_minDuration2").value=d.Config.MinDuration,$("ivs_input_reportInterval2").value=d.Config.ReportInterval;break;case"LeftDetection":$("ivs_rule_triggerposition5").value=d.Config.TriggerPosition[0],$("ivs_input_minDuration4").value=d.Config.MinDuration;break;case"ParkingDetection":$("ivs_rule_triggerposition6").value=d.Config.TriggerPosition[0],$("ivs_input_minDuration5").value=d.Config.MinDuration;break;case"TrafficParking":var f=d.Config.ParkingAllowedTime;$("traffic_park_delay").value=d.Config.Delay,$("traffic_park_allow").value=f,$("traffic_park_allow_h").value=parseInt(f/3600),$("traffic_park_allow_m").value=parseInt(f%3600/60),$("traffic_park_allow_s").value=f%3600%60;for(var g=d.Config.Sensitivity||7,h=0;h<j[k].length;h++)if("TrafficParking"==j[k][h].Type){g=j[k][h].Config.Sensitivity||7;break}n.set(g);break;case"TrafficCrossLane":$("ivs_rule_select_TrafficCrossLane").value=d.Config.LaneNumber;var g=d.Config.Sensitivity||5;r.set(g);break;case"TrafficOverLine":$("ivs_rule_select_TrafficOverLine").value=d.Config.LaneNumber,t.set(d.Config.Sensitivity);break;case"TrafficRetrograde":$("ivs_rule_select_TrafficRetrograde").value=d.Config.LaneNumber,$("ivs_rule_TRe_draw").removeClass("ui-button-hover");var g=d.Config.Sensitivity||5;u.set(g);break;case"TrafficU-Turn":$("ivs_rule_select_TrafficU-Turn").value=d.Config.LaneNumber;var g=d.Config.Sensitivity||5;x.set(g);break;case"TrafficVehicleInBusRoute":var g=d.Config.Sensitivity||5;y.set(g),$("ivs_rule_select_TrafficVehicleInBusRoute").value=d.Config.LaneNumber,$("ivs_vibr_CarTypeInBusLane").value=d.Config.CarTypeInBusLane;break;case"TrafficBacking":var g=d.Config.Sensitivity||5;A.set(g),$("ivs_rule_select_TrafficBacking").value=d.Config.LaneNumber;break;case"TrafficTollGate":$("ivs_TTG_DirectionO").checked=d.Config.Direction.contains("Obverse"),$("ivs_TTG_DirectionR").checked=d.Config.Direction.contains("Reverse"),$("ivs_TTG_SnapMotorcycle").checked=d.Config.SnapMotorcycle;break;case"RioterDetection":var g=d.Config.Sensitivity||5;B.set(g);break;case"FaceDetection":$("ivs_face_TriggerTargets").value=d.Config.TriggerTargets;break;case"VideoAbnormalDetection":break;case"SmokeDetection":$("ivs_input_minDuration6").value=d.Config.MinDuration;var g=d.Config.Sensitivity;D.set(g)}if(null!=d.Config.SizeFilter){$("ivs_rule_filter").checked=!0;var o=d.Config.SizeFilter.MinSize,p=d.Config.SizeFilter.MaxSize;$("ivs_rule_filter_minw").value=o[0],$("ivs_rule_filter_minh").value=o[1],$("ivs_rule_filter_maxw").value=p[0],$("ivs_rule_filter_maxh").value=p[1]}else $("ivs_rule_filter").checked=!1,$("ivs_rule_filter_minw").value=0,$("ivs_rule_filter_minh").value=0,$("ivs_rule_filter_maxw").value=8191,$("ivs_rule_filter_maxh").value=8191;E._showDisableRegion();var q=d.EventHandler;$("ivs_RecordEnable").checked=q.RecordEnable,$("ivs_AlarmOutEnable").checked=q.AlarmOutEnable,$("ivs_MailEnable").checked=q.MailEnable,$("ivs_SnapshotEnable").checked=q.SnapshotEnable,E._showAlarmOut(q)},_showInAreaInput:function(){$("ivs_MaxTargets").disabled=$("ivs_rule_action_inside").checked?!1:!0,$("ivs_MinTargets").disabled=$("ivs_rule_action_inside").checked?!1:!0,$("ivs_MinDuration").disabled=$("ivs_rule_action_inside").checked?!1:!0,$("ivs_ReportInterval").disabled=$("ivs_rule_action_inside").checked?!1:!0},_showThroughAreaInput:function(){$("ivs_direction0").disabled=$("ivs_rule_action_cross").checked?!1:!0},_showDisableRegion:function(){f?$$("#ivs_rule_filter_draw","#ivs_rule_filter_clean").setProperty("disabled",!$("ivs_rule_filter").checked):$("ivs_rule_filter").checked?$$("#ivs_rule_filter_draw","#ivs_rule_filter_clean").removeClass("ui-button-disabled"):$$("#ivs_rule_filter_draw","#ivs_rule_filter_clean").addClass("ui-button-disabled")},_onFaceSceneChange:function(){q=$("facedectetion_choiceScene").selectedIndex,Page.ivsSDConfig.ConfigManager.getConfig("VideoAnalyseGlobal").done(function(a){h=a,E._putValue()})},_buildJson:function(){for(var a=j[k]||[],b=a.length,c="",d=0;b>d;d++){var e=a[d].PtzPresetId-0,f=a[d].Type,g=JSON.encode(a[d].Config.Direction);if(g=void 0==g?null:g,"SmokeDetection"==a[d].Type&&(f="MoveDetection"),0!=e){switch(f){case"CrossLineDetection":c+='{"Name":"'+a[d].Name+'","Enable":'+a[d].Enable+',"Type":"CrossLineDetection","PtzPresetId":'+e+',"Config":{"Direction":"'+a[d].Config.Direction+'","DetectLine":'+JSON.encode(a[d].Config.DetectLine)+"}}";break;case"CrossFenceDetection":c+='{"Name":"'+a[d].Name+'","Enable":'+a[d].Enable+',"Type":"CrossFenceDetection","PtzPresetId":'+e+',"Config":{"Direction":"'+a[d].Config.Direction+'","UpstairsLine":'+JSON.encode(a[d].Config.UpstairsLine)+',"DownstairsLine":'+JSON.encode(a[d].Config.DownstairsLine)+"}}";break;case"TrafficTollGate":c+='{"Name":"'+a[d].Name+'","Enable":'+a[d].Enable+',"Type":"'+f+'","PtzPresetId":'+e+',"Config":{"DetectLine":'+JSON.encode(a[d].Config.DetectLine)+"}}";break;default:c+='{"Name":"'+a[d].Name+'","Enable":'+a[d].Enable+',"Type":"'+f+'","PtzPresetId":'+e+',"Config":{"Direction":'+g+',"DetectRegion":'+JSON.encode(a[d].Config.DetectRegion)+"}}"}b-1>d&&(c+=",")}}var h='{"result":true,"params":{"table":[['+c+"]]}}";$("ocx").SetIVSConfig(h,2)},onSceneChange:function(){E._saveRuleInfo();var a=$("ivs_rule_choiceScene").value;q=a,E._showRules(a);var b=g[k].Scene[a].PresetID;return $("ocx").SetCurShape(""),$("ocx").SetCurPtzID(-1),l.length<1?($("ivs_rule_copyto").innerHTML="",p=-1,void Page.ivsSDConfig._isgotoScene(b)):void Page.ivsSDConfig.IDevIntelliTracker.gotoScene(b).done(function(){$("ocx").SetCurPtzID(b),E._chkRuleList(0)})},_showRules:function(b){if(E._renderSelect(b),$("ivs_ruleList").innerHTML="",g[k].Scene.length<1)return void($("ivs_rule_paramMask").style.display="");$("ivs_rule_paramMask").style.display="none";var c=g[k].Scene[b].PresetID,d=j[k]||[],e=j[k].length;l=[],m=[];for(var f=0;e>f;f++)c==d[f].PtzPresetId&&(l.push(d[f]),m.push(f));var h=l.length;if(1>h)return $("ocx").SetCurShape(""),void($("ivs_rule_paramMask").style.display="");$("ivs_rule_paramMask").style.display="none";for(var i="<table>",f=0;h>f;f++){var n=f%2?"ui-table-tr-odd":"",o=f+1;i+='<tr id="ruleListnum_'+f+'" class="chkRuleList '+n+'">',i+="FaceDetection"==l[f].Type?'<td class="fn-widp10"><input type="checkbox" class = "chkRuleEnable fn-hide" id="chkrule_'+f+'"/></td>':'<td class="fn-widp10"><input type="checkbox" class = "chkRuleEnable" id="chkrule_'+f+'"/></td>',i+='<td class="fn-widp10">'+o+"</td>",i+='<td class="fn-widp30"><a class = "showRuleName fn-word-wrap fn-width120"  id="ruleName_'+f+'" title="'+l[f].Name+'">'+l[f].Name+'</a><input type="text" id="inputRuleName_'+f+'" class = "saveRuleName fn-width100" style="display:none;" maxlength=15 /></td>',i+='<td class="fn-widp30"><span class = "showRuleTypeList" id="ruleType_'+f+'">'+a(l[f].Type)+'</span><select id="inputRuleType_'+f+'" class="saveRuleType fn-width100 fn-height20" style=" display:none;" class = ""></select></td>',"FaceDetection"==l[f].Type?(i+='<td class="fn-widp10"><a href="javascript:;" class="ui-table-icon-area drawEx fn-hide" id="drawEx'+f+'"></a></td>',i+='<td><i class = "ui-table-icon-del deleteRule fn-hide" id="deleteRule'+f+'"></i></td>'):(i+='<td class="fn-widp10"><a href="javascript:;" class="ui-table-icon-area drawEx" id="drawEx'+f+'"></a></td>',i+='<td><i class = "ui-table-icon-del deleteRule" id="deleteRule'+f+'"></i></td>'),i+="</tr>"}i+="</table>",$("ivs_ruleList").innerHTML=i;for(var q=0;h>q;q++)$("chkrule_"+q).checked=l[q].Enable;$$("#page_ivs .chkRuleList").addEvent("click",function(){var a=this.id.replace(/[^\d]/g,"");$$("#page_ivs .chkRuleList").removeClass("ui-table-tr-current"),this.addClass("ui-table-tr-current"),E._chkRuleList(a)}),$$("#page_ivs .chkRuleEnable").addEvent("click",function(){var a=this.id.replace(/[^\d]/g,"");E._changeStyle(a);var b=m[a];j[k][b].Enable=$("chkrule_"+a).checked,$("ocx").SetCurEnable($("chkrule_"+a).checked)}),$$("#page_ivs .showRuleName").addEvent("dblclick",function(){var a=this.id.replace(/[^\d]/g,"");a==p&&($("ruleName_"+a).style.display="none",$("inputRuleName_"+a).style.display="",$("inputRuleName_"+a).focus(),$("inputRuleName_"+a).value=l[a].Name)}),$$("#page_ivs .saveRuleName").addEvent("blur",function(){var a=this.id.replace(/[^\d]/g,"");E._saveRuleName(a)}),$$("#page_ivs .showRuleTypeList").addEvent("dblclick",function(){var a=this.id.replace(/[^\d]/g,"");E._showRuleTypeList(a)}),$$("#page_ivs .saveRuleType").addEvent("change",function(){var a=this.id.replace(/[^\d]/g,"");E._saveRuleType(a),"FaceDetection"==this.value?$("drawEx"+a).addClass("fn-hide"):$("drawEx"+a).removeClass("fn-hide")}),$$("#page_ivs .saveRuleType").addEvent("blur",function(){var a=this.id.replace(/[^\d]/g,"");$("ruleType_"+a).style.display="",$("inputRuleType_"+a).style.display="none"}),$$("#page_ivs .drawEx").addEvent("click",function(a){var b=this.id.replace(/[^\d]/g,"");$$("#ivs_ruleList tr").removeClass("ui-table-tr-current"),$("ruleListnum_"+b).addClass("ui-table-tr-current"),E._onDrawRuleClick(b),a.stopPropagation()}),$$("#page_ivs .deleteRule").addEvent("click",function(a){var b=this.id.replace(/[^\d]/g,"");$$("#page_ivs .chkRuleList").removeClass("ui-table-tr-current"),$("ruleListnum_"+b).addClass("ui-table-tr-current"),E._chkRuleList(b),E._onDeleRuleClick(b),a.stop()}),$$("#page_ivs .chkRuleList")[0].addClass("ui-table-tr-current").fireEvent("click")},_chkRuleList:function(a){j[k];E._changeStyle(a),E._drawRuleCurrent(a)},_drawRuleCurrent:function(a){var b=j[k];if(!(a>b.length-1)){var c=b[o];null==c.Config.DetectLine&&null==c.Config.DetectRegion&&null==c.Config.UpstairsLine&&null==c.Config.DownstairsLine&&E._drawRuleType(a)
}},_drawRuleType:function(a){var b=(m[a],l[a].Name),c=l[a].Type,d=l[a].PtzPresetId;switch(c){case"CrossRegionDetection":var a=$("ivs_direction0").selectedIndex;$("ocx")&&$("ocx").AddShape(2,c,b,a,d);break;case"CrossLineDetection":var a=$("ivs_direction1").selectedIndex;$("ocx")&&$("ocx").AddShape(2,c,b,a,d);break;case"TakenAwayDetection":$("ocx")&&$("ocx").AddShape(2,c,b,-1,d);break;case"MoveDetection":$("ocx")&&$("ocx").AddShape(2,c,b,-1,d);break;case"WanderDetection":$("ocx")&&$("ocx").AddShape(2,c,b,-1,d);break;case"CrossFenceDetection":var a=$("ivs_slct_direction0").selectedIndex;$("ocx")&&$("ocx").AddShape(2,c,b,a,d);break;case"LeftDetection":$("ocx")&&$("ocx").AddShape(2,c,b,-1,d);break;case"ParkingDetection":$("ocx")&&$("ocx").AddShape(2,c,b,-1,d);break;case"TrafficCrossLane":case"TrafficOverLine":case"TrafficRetrograde":case"TrafficU-Turn":$("ocx")&&$("ocx").AddShape(2,c,b,-1,d);break;case"TrafficTollGate":$("ocx")&&$("ocx").AddShape(2,c,b,-1,d);break;case"FaceDetection":break;case"VideoAbnormalDetection":break;case"RioterDetection":case"SmokeDetection":default:$("ocx")&&$("ocx").AddShape(2,c,b,-1,d)}},_saveRuleName:function(b){var c=j[k],d=m[b],e=[],f=c[d].Name;""==$("inputRuleName_"+b).value.trim()&&($("inputRuleName_"+b).value=c[d].Name);for(var g=0;g<c.length;g++)d!=g&&e.push(c[g].Name);for(var h=0;h<e.length;h++)if($("inputRuleName_"+b).value==e[h])return $("ruleName_"+b).style.display="block",$("inputRuleName_"+b).style.display="none",$("ruleName_"+b).innerHTML=c[d].Name,void remarkDisplay("ivs_rule_remark",a("Saving failure"),3e3,1);$("ruleName_"+b).style.display="block",$("inputRuleName_"+b).style.display="none",c[d].Name=$("inputRuleName_"+b).value,$("ruleName_"+b).innerHTML=$("inputRuleName_"+b).value,$("ruleName_"+b).title=$("inputRuleName_"+b).value;var i=$("inputRuleName_"+b).value;$("ocx").SetCurName(i),$("ocx").SetCurShape(f+"_dir"),$("ocx").SetCurName(i+"_dir"),$("ocx").SetCurShape(i)},_showRuleTypeList:function(b){if(b==p){$("ruleType_"+b).style.display="none",$("inputRuleType_"+b).style.display="",$("inputRuleType_"+b).focus(),$("inputRuleType_"+b).innerHTML="",z.each(function(c){$("inputRuleType_"+b).options.add(new Option(a(c),c))});var c=m[b];$("inputRuleType_"+b).value=j[k][c].Type}},_saveRuleType:function(a){$("ruleType_"+a).style.display="",$("inputRuleType_"+a).style.display="none";var b=j[k],c=m[a],e=b[c].PtzPresetId,f=b[c].EventHandler,g=b[c].Enable,h=b[c].Name,i=$("inputRuleType_"+a).value;if($("ocx").DeleteShape(h+"_dir"),b[c].Type!=i){var l,n=JSON.encode([[3747,710],[3686,7863]]),o=JSON.encode([[1085,928],[921,6771],[6983,6635],[7044,1038]]);switch(i){case"CrossLineDetection":l='{"Config":{"DetectLine":'+n+',"Direction":"LeftToRight","SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]},"TriggerPosition":["Center"]},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"","Type":"CrossLineDetection"}';break;case"CrossRegionDetection":l='{"Config":{"Action":["Cross"],"DetectRegion":'+o+',"Direction":"Enter","MaxTargets":5,"MinDuration":5,"MinTargets":1,"ReportInterval":1,"SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]}},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Normal","Type":"CrossRegionDetection"}';break;case"TakenAwayDetection":l='{"Config":{"DetectRegion":'+o+',"MinDuration":6,"SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]},"TriggerPosition":["Center"]},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Normal","Type":"TakenAwayDetection"}';break;case"MoveDetection":var p=d.SupportedScenes[E.Mode].SupportedRules.MoveDetection.SupportedDetectTypes;l='{"Config":{"DetectRegion":'+o+',"TriggerSpeed":30,"MinDuration":5,"Sensitivity":5,"DetectType":["'+p[0]+'"],"SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]},"TriggerPosition":["Center"]},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Normal","Type":"MoveDetection"}';break;case"WanderDetection":l='{"Config":{"DetectRegion":'+o+',"TriggerTargetsNumber":1,"MinDuration":5,"ReportInterval":0,"SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]},"TriggerPosition":["Center"]},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Normal","Type":"WanderDetection"}';break;case"CrossFenceDetection":l='{"Config":{"UpstairsLine":[[2089, 3331], [6614, 3549]],"DownstairsLine":[[2212, 6799], [6696, 7017]],"Direction":"LeftToRight","SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]},"TriggerPosition":["Center"]},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Normal","Type":"CrossFenceDetection"}';break;case"LeftDetection":l='{"Config":{"DetectRegion":'+o+',"MinDuration":6,"SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]},"TriggerPosition":["Center"]},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Normal","Type":"LeftDetection"}';break;case"ParkingDetection":l='{"Config":{"DetectRegion":'+o+',"MinDuration":6,"SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]},"TriggerPosition":["Center"]},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Normal","Type":"ParkingDetection"}';break;case"TrafficParking":l='{"Config":{"DetectRegion":[],"LaneNumber":0,"ReportTimes":4,"Delay":30,"ParkingAllowedTime":600},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Traffic","Type":"TrafficParking"}';break;case"TrafficCrossLane":l='{"Config":{"DetectRegion":'+o+',"LaneNumber":0,"ReportTimes":4,"Delay":30,"ParkingAllowedTime":600},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Traffic","Type":"TrafficCrossLane"}';break;case"TrafficOverLine":l='{"Config":{"DetectRegion":'+o+',"Sensitivity":5,"LaneNumber":0,"ReportTimes":4,"Delay":30,"ParkingAllowedTime":600},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Traffic","Type":"TrafficOverLine"}';break;case"TrafficRetrograde":l='{"Config":{"DetectRegion":'+o+',"Direction":[],"LaneNumber":0,"ReportTimes":4,"Delay":30,"ParkingAllowedTime":600},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Traffic","Type":"TrafficRetrograde"}';break;case"TrafficU-Turn":l='{"Config":{"DetectRegion":'+o+',"LaneNumber":0,"ReportTimes":4,"Delay":30,"ParkingAllowedTime":600},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Traffic","Type":"TrafficU-Turn"}';break;case"TrafficVehicleInBusRoute":l='{"Config":{"DetectRegion":'+o+',"LaneNumber":0,"CarTypeInBusLane":2},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Traffic","Type":"TrafficVehicleInBusRoute"}';break;case"TrafficBacking":l='{"Config":{"DetectRegion":'+o+',"Direction":[],"LaneNumber":0},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Traffic","Type":"TrafficBacking"}';break;case"TrafficTollGate":l='{"Config":{"DetectLine":'+n+',"Direction":[\'Obverse\'], "SnapMotorcycle":true, "LaneNumber":0},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":[\'Vehicle\',\'Plate\'],"PtzPresetId":'+e+',"SceneType":"Traffic","Type":"TrafficTollGate"}';break;case"RioterDetection":l='{"Config":{"DetectRegion":'+o+',"MinDuration":5,"ReportInterval":0,"MinDetectRect":[[0,0],[100,100]]},"Enable":'+g+',"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"SceneType":"Normal","Type":"RioterDetection"}';break;case"FaceDetection":l='{"Config":{"HumanFaceTypes":[\'Normal\',\'HideNose\'],"DetectRegion":[],"MinDuration":"10","TriggerTargets":1,"SizeFilter":{"Type" : "ByLength","MinSize":[0,0],"MaxSize":[8191,8191]}},"Enable":true,"EventHandler":'+JSON.encode(f)+',"Name":"'+h+'","ObjectTypes":["Unknown"],"PtzPresetId":'+e+',"Type":"FaceDetection"}';break;case"VideoAbnormalDetection":l="{'Config':{'MinDuration':10,'DetectType':['SceneChange'],Sensitivity:5},'Enable':true,'EventHandler':"+JSON.encode(f)+",'Name':'"+h+"','PtzPresetId':"+e+",'Type':'"+i+"'}";break;case"SmokeDetection":default:l="{'Config':{'DetectRegion':[],'MinDuration':30,'Sensitivity':5},'Enable':true,'EventHandler':"+JSON.encode(f)+",'Name':'"+h+"','PtzPresetId':"+e+",'Type':'"+i+"'}"}b[c]=JSON.decode(l)}var q=$("ivs_rule_choiceScene").value;E._showRules(q),E._changeStyle(a),E._buildJson()},chkRuleEnable:function(a){E._changeStyle(a);var b=m[a],c=j[k];$("chkrule_"+a).checked?(c[b].Enable=!0,$("ocx")&&$("ocx").SetCurEnable(!0)):(c[b].Enable=!1,$("ocx")&&$("ocx").SetCurEnable(!1))},_postRuleCfg:function(){E._saveRuleInfo();for(var b=!1,c=0;c<j[k].length;c++){var d=j[k][c];if(0!=d.PtzPresetId)switch(d.Type){case"CrossFenceDetection":(void 0==d.Config.DownstairsLine||0==d.Config.DownstairsLine)&&(b=!0);break;case"CrossLineDetection":case"TrafficTollGate":(null==d.Config.DetectLine||0==d.Config.DetectLine.length)&&(b=!0);break;case"VideoAbnormalDetection":b=!1;break;default:(null==d.Config.DetectRegion||0==d.Config.DetectRegion.length)&&(b=!0)}}return C&&(b=!1),b?void remarkDisplay("ivs_rule_remark",a("Draw_Rule"),3e3,1):($$("#ivs_rule_choiceScene_wrap .ui-table-icon-area").removeClass("ui-table-icon-area-current"),void Page.ivsSDConfig.ConfigManager.setConfig("VideoAnalyseRule",j).done(function(){remarkDisplay("ivs_rule_remark",a("Succeed in saving configure"),3e3,0)}).fail(function(){remarkDisplay("ivs_rule_remark",a("Saving failure"),3e3,1)}))},_cclRuleCfg:function(){Page.ivsSDConfig.ConfigManager.getConfig(["VideoAnalyseRule"]).done(function(b){j=null==b[0].params||null==b[0].params.table||null==b[0].params.table[0]?[[]]:b[0].params.table,E._renderRuleElements(),remarkDisplay("ivs_rule_remark",a("Operateingsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_rule_remark",a("Operateingfailure"),3e3,1)})},_showAlarmOut:function(a){var b="";if(e>1){for(var c=0;e>c;c++)b+='<a href="javascript:;" class="ui-channel-item clkAlarmOut" id="b_almOut_0_'+c+'">'+(c+1)+"</a>";$("b_alarmOut0").innerHTML=b;for(var d=a.AlarmOutChannels.length,f=a.AlarmOutChannels,g=0;d>g;g++)$("b_almOut_0_"+f[g]).addClass("ui-channel-item-current")}$$("#page_ivs .clkAlarmOut").addEvent("click",function(){var a=this.id.split("_");$("b_almOut_0_"+a[3]).hasClass("ui-channel-item-current")?$("b_almOut_0_"+a[3]).removeClass("ui-channel-item-current"):$("b_almOut_0_"+a[3]).addClass("ui-channel-item-current")})},_saveRuleInfo:function(){var a=j[k][o];if(a&&-1!=p){a.ObjectTypes=[],a.ObjectTypes.include("Unknown");var b=a.Type;switch(b){case"CrossLineDetection":a.Config.TriggerPosition[0]=$("ivs_rule_triggerposition0").value,a.Config.Direction=$("ivs_direction1").value;break;case"CrossFenceDetection":a.Config.TriggerPosition[0]=$("ivs_rule_triggerposition4").value,a.Config.Direction=$("ivs_slct_direction0").value;break;case"CrossRegionDetection":a.Config.Action=[],$("ivs_rule_action_appear").checked&&a.Config.Action.include("Appear"),$("ivs_rule_action_inside").checked&&a.Config.Action.include("Inside"),$("ivs_rule_action_disappear").checked&&a.Config.Action.include("Disappear"),$("ivs_rule_action_cross").checked&&a.Config.Action.include("Cross"),a.Config.Direction=$("ivs_direction0").value,a.Config.MaxTargets=$("ivs_MaxTargets").value-0,a.Config.MinTargets=$("ivs_MinTargets").value-0,a.Config.MinDuration=$("ivs_MinDuration").value-0,a.Config.ReportInterval=$("ivs_ReportInterval").value-0;break;case"TakenAwayDetection":a.Config.TriggerPosition[0]=$("ivs_rule_triggerposition1").value,a.Config.MinDuration=$("ivs_input_minDuration0").value-0;break;case"MoveDetection":a.Config.DetectType[0]=$("ivs_slct_chkType").value,a.Config.TriggerPosition[0]=$("ivs_rule_triggerposition2").value,a.Config.MinDuration=$("ivs_input_minDuration1").value-0,a.Config.TriggerSpeed=$("ivs_input_speed").value-0,a.Config.Sensitivity=w;break;case"WanderDetection":a.Config.TriggerPosition[0]=$("ivs_rule_triggerposition3").value,a.Config.TriggerTargetsNumber=$("ivs_input_minTargets2").value-0,a.Config.MinDuration=$("ivs_input_minDuration2").value-0,a.Config.ReportInterval=$("ivs_input_reportInterval2").value-0;break;case"LeftDetection":a.Config.TriggerPosition[0]=$("ivs_rule_triggerposition5").value,a.Config.MinDuration=$("ivs_input_minDuration4").value-0;break;case"ParkingDetection":a.Config.TriggerPosition[0]=$("ivs_rule_triggerposition6").value,a.Config.MinDuration=$("ivs_input_minDuration5").value-0;break;case"TrafficParking":a.Config.Delay=$("traffic_park_delay").value-0,$("traffic_park_allow").value=3600*parseInt($("traffic_park_allow_h").value)+60*parseInt($("traffic_park_allow_m").value)+parseInt($("traffic_park_allow_s").value),a.Config.ParkingAllowedTime=($("traffic_park_allow").value-0).round(6,10800),a.Config.Sensitivity=$("ivs_Parking_first").getProperty("title")-0;for(var c=0;c<j[k].length;c++)"TrafficParking"==j[k][c].Type&&(j[k][c].Config.Sensitivity=$("ivs_Parking_first").getProperty("title")-0);break;case"TrafficCrossLane":a.Config.LaneNumber=$("ivs_rule_select_TrafficCrossLane").value-0,a.Config.Sensitivity=$("ivs_CrossLane_first").getProperty("title")-0;break;case"TrafficOverLine":a.Config.LaneNumber=$("ivs_rule_select_TrafficOverLine").value-0,a.Config.Sensitivity=$("ivs_OverLine_first").getProperty("title")-0;break;case"TrafficRetrograde":a.Config.LaneNumber=$("ivs_rule_select_TrafficRetrograde").value-0,a.Config.Sensitivity=$("ivs_Retrograde_first").getProperty("title")-0;break;case"TrafficU-Turn":a.Config.LaneNumber=$("ivs_rule_select_TrafficU-Turn").value-0,a.Config.Sensitivity=$("ivs_UTurn_first").getProperty("title")-0;break;case"TrafficVehicleInBusRoute":a.Config.LaneNumber=$("ivs_rule_select_TrafficVehicleInBusRoute").value-0,a.Config.CarTypeInBusLane=$("ivs_vibr_CarTypeInBusLane").value-0,a.Config.Sensitivity=$("ivs_BusRoute_first").getProperty("title")-0;break;case"TrafficBacking":a.Config.LaneNumber=$("ivs_rule_select_TrafficBacking").value-0,a.Config.Sensitivity=$("ivs_Backing_first").getProperty("title")-0;break;case"TrafficTollGate":a.Config.Direction=[],$("ivs_TTG_DirectionO").checked&&a.Config.Direction.push("Obverse"),$("ivs_TTG_DirectionR").checked&&a.Config.Direction.push("Reverse"),a.ObjectTypes=["Vehicle","Plate"],a.Config.SnapMotorcycle=$("ivs_TTG_SnapMotorcycle").checked;case"RioterDetection":a.Config.Sensitivity=$("ivs_RioterDetection_first").getProperty("title")-0;break;case"FaceDetection":a.Config.TriggerTargets=$("ivs_face_TriggerTargets").value-0,a.ObjectTypes=["Human"];break;case"SmokeDetection":a.Config.MinDuration=$("ivs_input_minDuration6").value-0,a.Config.Sensitivity=$("ivs_smoke_first").getProperty("title")-0;break;case"VideoAbnormalDetection":}if($("ivs_rule_filter").checked){var d=[$("ivs_rule_filter_minw").value-0,$("ivs_rule_filter_minh").value-0],f=[$("ivs_rule_filter_maxw").value-0,$("ivs_rule_filter_maxh").value-0];a.Config.SizeFilter={MinSize:d,MaxSize:f,Type:"ByLength"}}else a.Config.SizeFilter=null;if(e>1){for(var g=0,h=new Array,i=0;e>i;i++)$("b_almOut_0_"+i).hasClass("ui-channel-item-current")&&(h[g]=i,g+=1);a.EventHandler.AlarmOutChannels=h}else a.EventHandler.AlarmOutChannels=[0];a.EventHandler.RecordChannels=[0],a.EventHandler.SnapshotChannels=[0],a.EventHandler.ExAlarmOutChannels=[0],a.EventHandler.RecordEnable=$("ivs_RecordEnable").checked,a.EventHandler.AlarmOutEnable=$("ivs_AlarmOutEnable").checked,a.EventHandler.MailEnable=$("ivs_MailEnable").checked,a.EventHandler.SnapshotEnable=$("ivs_SnapshotEnable").checked}},_showSupportedDetectTypes:function(){if("FaceDetection"!=$("ivs_glogal_scene").value&&"Traffic"!=$("ivs_glogal_scene").value){if(!$chk(d.SupportedScenes)||!d.SupportedScenes[E.Mode].SupportedRules.MoveDetection)return;var b=d.SupportedScenes[E.Mode].SupportedRules.MoveDetection.SupportedDetectTypes;$("ivs_slct_chkType").empty(),b.contains("FastMove")&&$("ivs_slct_chkType").options.add(new Option(a("w_runFast"),"FastMove")),b.contains("AbruptSpeedup")&&$("ivs_slct_chkType").options.add(new Option(a("w_speedupSuuddely"),"AbruptSpeedup")),b.contains("AbruptSlowdown")&&$("ivs_slct_chkType").options.add(new Option(a("w_speeddownSuuddely"),"AbruptSlowdown"))}},_showTriggerPosition:function(){if("FaceDetection"!=$("ivs_glogal_scene").value&&"Traffic"!=$("ivs_glogal_scene").value){if(!$chk(d.SupportedScenes))return;var a=d.SupportedScenes[E.Mode].SupportedRules;$("ivs_rule_triggerposition4").style.display=a.CrossFenceDetection&&a.CrossFenceDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition_title4").style.display=a.CrossFenceDetection&&a.CrossFenceDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition_title0").style.display=a.CrossLineDetection&&a.CrossLineDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition0").style.display=a.CrossLineDetection&&a.CrossLineDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition5").style.display=a.LeftDetection&&a.LeftDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition_title5").style.display=a.LeftDetection&&a.LeftDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition2").style.display=a.MoveDetection&&a.MoveDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition_title2").style.display=a.MoveDetection&&a.MoveDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition6").style.display=a.ParkingDetection&&a.ParkingDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition_title6").style.display=a.ParkingDetection&&a.ParkingDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition1").style.display=a.TakenAwayDetection&&a.TakenAwayDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition_title1").style.display=a.TakenAwayDetection&&a.TakenAwayDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition3").style.display=a.WanderDetection&&a.WanderDetection.TriggerPosition?"":"none",$("ivs_rule_triggerposition_title3").style.display=a.WanderDetection&&a.WanderDetection.TriggerPosition?"":"none"}},_checkTpTimeLimit:function(){var a=$("traffic_park_allow_h").value,b=$("traffic_park_allow_m").value,c=$("traffic_park_allow_s").value,d=3600*a+60*b+c;6>d&&($("traffic_park_allow_h").value=0,$("traffic_park_allow_m").value=0,$("traffic_park_allow_s").value=6)}}}(),function(){var b=-1,c={},d=Page.ivsSDConfig.Tab.para={init:function(){d.translate(),d.bind()},translate:function(){$("ivs_title_shadow").set("text",a("w_shadow")),$("ivs_td_sensitivity").set("text",a("w_sensitivity")),$("ivs_span_low").set("text",a("w_low")),$("ivs_span_high").set("text",a("w_high")),$("ivs_title_modeleMinSize").set("text",a("w_leastSize")),$("ivs_title_modeleMaxSize").set("text",a("w_mostSize")),$("ivs_btn_drawModele").set("text",a("w_protract")),$("ivs_btn_delDrawModele").set("text",a("w_cleanup")),$("ivs_title_DetectBalance").set("text",a("w_detectBalance")),$("ivs_para_refresh").set("text",a("w_Refresh")),$("ivs_para_confirm").set("text",a("w_Save"));var b=$("ivs_select_DetectBalance").getElements("option");b[0].setProperty("text",a("w_middleCourse")),b[1].setProperty("text",a("w_detectLess")),b[2].setProperty("text",a("w_wrongLess")),$("ivs_para_region_detect").set("text",a("w_addDetectRegion")),$("ivs_para_region_exclude").set("text",a("w_addExcludeRegion"))},render:function(){Page.ivsSDConfig._stopSingleIVS(),Page.ivsSDConfig._openIVSVideo.delay(10,"",["ivs_para_vedio",Page.ivsSDConfig.Tab.para._onParaRefreshClick]),d._renderDom()},_renderDom:function(){},bind:function(){$("ivs_tab_para").style.display="",$("ivs_tab_para").style.position="absolute",$("ivs_tab_para").style.top="-10000px",c=new Slider($("ivs_slider_Sensitivity1"),$("ivs_slider_Sensitivity2"),{range:[1,10],steps:9,wheel:!0,onChange:function(a){$("ivs_slider_Sensitivity2").setProperty("title",a),y=a}}),$("ivs_tab_para").style.display="none",$("ivs_tab_para").style.position="",$("ivs_tab_para").style.top="",$("ivs_para_scene").addEvent("change",d._onParaSceneChange),$("ivs_para_refresh").addEvent("click",function(){d._onParaRefreshClick(!0)}),$("ivs_para_confirm").addEvent("click",d._onParaConfirmClick),$("ivs_para_region_detect").addEvent("click",d._onParaDetectRegionClick),$("ivs_para_region_exclude").addEvent("click",d._onParaExcludeRegionClick),$("ivs_btn_drawModele").addEvent("click",Page.ivsSDConfig._drawArea),$("ivs_btn_delDrawModele").addEvent("click",Page.ivsSDConfig._delArea)},_onParaSceneChange:function(){d._saveAnalyseModule(),q=this.selectedIndex,d._renderParaElements(q)},_saveAnalyseModule:function(){if(-1!=b){var a=x[k][b];a.DetectBalance=$("ivs_select_DetectBalance").value-0,a.Sensitivity=y,a.AntiDisturbance=$("ivs_input_antiDisturbance").checked,a.Shadow=$("ivs_input_shadow").checked,a.Category=[],$("ivs_input_Category_Motor").checked&&a.Category.push("Motor"),$("ivs_input_Category_UnlicensedMotor").checked&&a.Category.push("UnlicensedMotor"),$("ivs_input_Category_Unknown").checked&&a.Category.push("Non-Motor");var c=parseInt($("ivs_para_filter_minw").value),d=parseInt($("ivs_para_filter_minh").value),e=parseInt($("ivs_para_filter_maxw").value),f=parseInt($("ivs_para_filter_maxh").value);a.SizeFilter.MinSize=[c,d],a.SizeFilter.MaxSize=[e,f],a.SizeFilter.Type="ByLength"}},_renderParaElements:function(a){if(C?($("ivs_para_region_exclude").style.display="none",$("ivs_title_DetectBalance_wrap").style.display="none"):($("ivs_para_region_exclude").style.display="block",$("ivs_title_DetectBalance_wrap").style.display="block"),$chk(g[k].Scene)&&$chk(x[k])){var d=g[k].Scene[a].PresetID;b=-1;for(var e=0;e<x[k].length;e++)x[k][e].PtzPresetId==d&&(b=e);if(-1!=b){void 0!=d&&Page.ivsSDConfig.IDevIntelliTracker.gotoScene(d);var f=x[k][b];$("ivs_select_DetectBalance").value=f.DetectBalance,c.set(f.Sensitivity),$("ivs_input_antiDisturbance").checked=f.AntiDisturbance,$("ivs_input_shadow").checked=f.Shadow,$("ivs_input_Category_Motor").checked=f.Category.contains("Motor"),$("ivs_input_Category_UnlicensedMotor").checked=f.Category.contains("UnlicensedMotor"),$("ivs_input_Category_Unknown").checked=f.Category.contains("Non-Motor"),$("ivs_para_filter_minw").value=f.SizeFilter.MinSize[0],$("ivs_para_filter_minh").value=f.SizeFilter.MinSize[1],$("ivs_para_filter_maxw").value=f.SizeFilter.MaxSize[0],$("ivs_para_filter_maxh").value=f.SizeFilter.MaxSize[1],setTimeout(function(){$("ocx")&&$("ocx").SetIVSConfig(g_analyseModuleJson,1),$("ocx").AddShape(1,"","",2,d),$("ocx")&&$("ocx").SetCurModule(d)},1e3)}}},_onParaRefreshClick:function(b){Page.ivsSDConfig.ConfigManager.getConfig(["IntelliTrackScene","VideoAnalyseModule"]).done(function(c){if(g=c[0].params.table,$("ivs_para_scene").empty(),$chk(g[k].Scene)){for(var e=0;e<g[k].Scene.length;e++)$("ivs_para_scene").options.add(new Option(g[k].Scene[e].Name,e));x=null==c[1].params||null==c[1].params.table?[[]]:c[1].params.table,d._buildModuleJson(),-1!=q?($("ivs_para_scene").selectedIndex=q,d._renderParaElements(q)):d._renderParaElements(0),b&&remarkDisplay("ivs_para_remark",a("Operateingsuccess"),3e3,0)}}).fail(function(){remarkDisplay("ivs_para_remark",a("Operateingfailure"),3e3,1)})},_buildModuleJson:function(){for(var a=x[k],b="",c=0;c<a.length;c++){var d=a[c].PtzPresetId-0,e=a[c].DetectRegion,f=a[c].ExcludeRegion;f=f?JSON.encode(f):null,0!=d&&(b+='{"DetectRegion":'+JSON.encode(e)+',"ExcludeRegion":'+f+',"PtzPresetId":'+d+"}",c<a.length-1&&(b+=","))}g_analyseModuleJson='{"result":true,"params":{"table":[['+b+"]]}}"},_onParaConfirmClick:function(){d._saveAnalyseModule(),Page.ivsSDConfig.ConfigManager.setConfig("VideoAnalyseModule",x).done(function(){remarkDisplay("ivs_para_remark",a("Succeed in saving configure"),3e3,0)}).fail(function(){remarkDisplay("ivs_para_remark",a("Saving failure"),3e3,1)})},_onParaDetectRegionClick:function(){var a=$("ivs_para_scene").value;$("ocx")&&$("ocx").AddDetectionRegion("",g[k].Scene[a].PresetID)},_onParaExcludeRegionClick:function(){var a=$("ivs_para_scene").value;$("ocx")&&$("ocx").AddExcludeRegion("",g[k].Scene[a].PresetID)},OutPutModuleRect:function(a){if(-1!=b){var c=JSON.decode(a),e=x[k][b];e.DetectRegion=c.DetectRegion,e.ExcludeRegion=c.ExcludeRegion,d._buildModuleJson()}},setFilterValue:function(a){var b=JSON.decode(a).FilterArea,c=b[0][0],d=b[0][1],e=b[1][0],f=b[1][1];$("ivs_para_filter_minw").value=c,$("ivs_para_filter_minh").value=d,$("ivs_para_filter_maxw").value=e,$("ivs_para_filter_maxh").value=f}}}();var F={support:!1,rpcConfig:null,enableConfig:null,varSetSupport:function(b){F.support=b,b&&($("ivs_wv_wrap").removeClass("fn-hide"),$("ivs_g_line").removeClass("fn-hide"),F.setPageBind()),$("ivs_wideview").set("text",a("w_wv_set")),$("ivs_wv_enable_title").set("text",a("w_wv_enable"))},setPageBind:function(){$("ivs_wv_enable").addEvent("click",function(){var a=$(this).checked;F.varSetIsShowIcon(a)})},varSetIsShowIcon:function(a){$("ivs_glogal_enable").checked=!1,a?($("ivs_glogal_enable").setProperty("disabled","disabled"),$("ivs_glogal_enable").fireEvent("click"),$("ivs_wv_enable").checked=!0,F.uiTip()):$("ivs_glogal_enable").setProperty("disabled","")},uiTip:function(){remarkDisplay("ivs_glogal_remark",a("w_wv_tip2"),3e3,0)},domRender:function(){$("ivs_wv_enable").checked=null==F.enableConfig?!1:F.enableConfig.Enable,$("ivs_glogal_enable").disabled=1==$("ivs_wv_enable").checked?"disabled":"",$("ivs_wv_enable").disabled=$("ivs_glogal_enable").checked?"disabled":""},domSave:function(){F.enableConfig.Enable=$("ivs_wv_enable").checked},newRequestGetConfig:function(){F.newSupport=!0,Page.ivsSDConfig.ConfigManager.getConfig("WideViewControl").done(function(a){F.newConfig=a[0]})},newRequestSaveConfig:function(a){1==F.newSupport&&(F.newConfig.Enable=a,Page.ivsSDConfig.ConfigManager.setConfig("WideViewControl",[F.newConfig]))},requestGetConfig:function(){Page.ivsSDConfig.ConfigManager.getConfig("WideViewControl").done(function(a){F.enableConfig=a[0],F.domRender()})},requestSaveConfig:function(){F.domSave(),Page.ivsSDConfig.ConfigManager.setConfig("WideViewControl",[F.enableConfig])}};!function(){var b={MultiSceneExtention:[[{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}}],[{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}}],[{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}}],[{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}}],[{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}}],[{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}}],[{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}},{TimeSection:"1 00:00:00-00:00:00",MultiScene:{AlarmDelay:200,TourPath:[]}}]]},d=Page.ivsSDConfig.Tab.plan={allConfig:[],dateConfig:null,dateItemConfig:null,dateItemSceneConfig:[],dialogScene:null,arraydialogSceneId:[],schdule:null,schduleTimeList:[[],[],[],[],[],[],[]],init:function(){d.bind(),d.dialogScene=new Dialog("ivs_plan_dialog",d.dialogSaveData,"ivs_plan_dialog_confirm","ivs_plan_dialog_cancel",a("多场景巡航配置")),d.dialogScene.setPosition(100,100),d.initDom(),d.schedule=new Schedule("schedule_ivs_plan_canvas",{holiday:!1,displayMode:["general"]}),$("schedule_ivs_plan_canvas").removeEvents("mousedown"),$("schedule_ivs_plan_canvas").style.cursor="default"
},initDom:function(){var a=$$("#ivs_p_wrapTemplate tr")[0],b=0,c=null,d=new Element("tbody");for(b=0;16>b;b++)n=b+1,c=a.clone(),c.setProperty("id","ivs_p_wrap"+n),b%2==0&&c.addClass("ui-table-tr-odd"),c.getChildren("td")[0].set("text",n),c.getChildren("td")[1].setProperty("id","ivs_p_ts_t"+n),c.getChildren("td")[1].getChildren("div")[0].setProperty("id","ivs_p_ts_i"+n),c.getChildren("td")[1].getChildren("div")[0].setProperty("for","ivs_p_ts_s"+n),c.getChildren("td")[1].getChildren("span")[0].setProperty("id","ivs_p_ts_s"+n),c.getChildren("td")[2].setProperty("id","ivs_p_te_t"+n),c.getChildren("td")[2].getChildren("div")[0].setProperty("id","ivs_p_te_i"+n),c.getChildren("td")[2].getChildren("div")[0].setProperty("for","ivs_p_te_s"+n),c.getChildren("td")[2].getChildren("span")[0].setProperty("id","ivs_p_te_s"+n),c.getChildren("td")[3].getChildren("i")[0].setProperty("id","ivs_p_set_"+n),c.getChildren("td")[4].getChildren("i")[0].setProperty("id","ivs_p_del_"+n),c.inject(d);d.getChildren("tr")[0].addClass("ui-table-tr-current"),$("ivs_p_tbody").empty(),d.inject("ivs_p_tbody"),$$("#ivs_p_tbody .func-timeh").addEvent("keyup",function(){limit(this,24)}),$$("#ivs_p_tbody .func-timem").addEvent("keyup",function(){limit(this,59)})},schduleRender:function(){d.allConfig==[]&&(d.allConfig=$unlink(b).MultiSceneExtention);for(var a=0;7>a;a++)for(var c=0;16>c;c++)d.schduleTimeList[a][c]=d.allConfig[a][c].TimeSection;d.schedule.render(d.schduleTimeList)},render:function(){c.hide(),d.allConfigRefresh(!1)},bind:function(){$$("#ivs_p_nav li").addEvent("click",d.navChange),$("ivs_p_tbody").addEvent("click",d.configChange),$("ivs_p_dialog_tbody").addEvent("click",d.dialogConfigClick),$("ivs_plan_dialog_add").addEvent("click",d.dialogAddDom),$("ivs_p_input_dayall").addEvent("click",d.inputAllDay),$("ivs_p_copyConfig").addEvent("click",d.copyConfig),$("ivs_plan_reset").addEvent("click",d.allconfigReset),$("ivs_plan_refresh").addEvent("click",d.allConfigRefresh),$("ivs_plan_confirm").addEvent("click",d.allConfigSave)},allConfigRefresh:function(c){c=void 0==c?!0:c,Page.ivsSDConfig.ConfigManager.getConfig("IntelliTrackScene").done(function(e){g=e,d.allConfig=g[k].MultiSceneExtention,void 0==d.allConfig&&(d.allConfig=$unlink(b).MultiSceneExtention,g[k].MultiSceneExtention=d.allConfig),g[k].MultiScene&&"Tour"==g[k].MultiScene.PriorMode&&($("ivs_p_dtr_im_template").value=0,$("ivs_p_dtr_is_template").value=20);var f=$$("#ivs_p_nav .ui-table-tab-current")[0].getProperty("data-li");d.dataConfig=d.allConfig[f],d.dataRenderNavChange(),c&&remarkDisplay("ivs_plan_remark",a("刷新成功"),3e3,0),d.schduleRender()}).fail(function(){remarkDisplay("ivs_plan_remark",a("数据异常"),3e3,1)})},allConfigSave:function(){var b=$$("#ivs_p_tbody .ui-table-tr-current")[0].getProperty("id").substr(10,1)-0;d.dataSync(b),$$(".input-wrap").addClass("fn-hide"),$$("span.func-time").removeClass("fn-hide"),Page.ivsSDConfig.ConfigManager.setConfig("IntelliTrackScene",g).done(function(){d.schduleRender(),remarkDisplay("ivs_plan_remark",a("Succeed in saving configure"),3e3,0)}).fail(function(){remarkDisplay("ivs_plan_remark",a("Saving failure")+"请检查巡航时间段是否有冲突",3e3,1)})},allconfigReset:function(){d.allConfig=$unlink(b).MultiSceneExtention,g[k].MultiSceneExtention=d.allConfig;var c=$$("#ivs_p_nav .ui-table-tab-current")[0].getProperty("data-li");d.dataConfig=d.allConfig[c],d.dataRenderNavChange(),d.schduleRender(),remarkDisplay("ivs_plan_remark",a("全部清空成功，点击保存按钮保存配置"),3e3,0)},inputAllDay:function(){var a=0,b=$$("#ivs_tab_plan .ui-table-tab-current")[0].getProperty("data-li");if($("ivs_p_input_dayall").checked)for(a=0;7>a;a++)$("ivs_p_day"+a).checked=!0;else{for(a=0;7>a;a++)$("ivs_p_day"+a).checked=!1;$("ivs_p_day"+b).checked=!0}},copyConfig:function(){var b=$$("#ivs_tab_plan .ui-table-tab-current")[0].getProperty("data-li"),c=[],e=0;for(e=0;7>e;e++)1==$("ivs_p_day"+e).checked&&c.push(e);for(c=c.erase(b),e=0;e<c.length;e++)d.allConfig[c[e]]=$unlink(d.allConfig[b]);d.schduleRender(),remarkDisplay("ivs_plan_remark",a("复制配置成功，点击保存按钮保存配置"),3e3,0)},dialogConfigClick:function(a){var b=a.target.id,c=b.substr(0,12),e=b.substr(13,1),f=$("ivs_p_dtr_nm_"+e),g=f&&f.getProperty("data-row");switch(c){case"ivs_p_dtr_up":d.dialogChangeDom(g,"up");break;case"ivs_p_dtr_dn":d.dialogChangeDom(g,"down");break;case"ivs_p_dtr_de":d.dialogDelDom(e);break;case"ivs_p_dtr_se":}},dialogRenderDom:function(a,b){var c=0;for(d.dateConfig=d.allConfig[a],d.dateItemConfig=d.dateConfig[b],d.dateItemSceneConfig=d.dateItemConfig.MultiScene,$("ivs_p_dialog_tbody").empty(),d.arraydialogSceneId=[],c=0;c<d.dateItemSceneConfig.TourPath.length;c++){d.dialogAddDom();var e=c-0+1;$("ivs_p_dtr_se_"+e).value=d.dateItemSceneConfig.TourPath[c].PresetID,d.dialogRenderDomTime(e,d.dateItemSceneConfig.TourPath[c].Duration)}},dialogRenderDomTime:function(a,b){var c=parseInt(b/3600),d=parseInt((b-3600*c)/60),e=b%60;$("ivs_p_dtr_ih_"+a).value=c,$("ivs_p_dtr_im_"+a).value=d,$("ivs_p_dtr_is_"+a).value=e},dialogAddDom:function(){var a=0,b=null,c=1,e=null,f=$("ivs_p_dialog_tbody").getChildren("tr").length;if(0!=d.arraydialogSceneId.length)for(c=1;c<d.arraydialogSceneId.length+1;c++)if(c!=d.arraydialogSceneId[c-1]){a=c;break}if(0==a&&(a=d.arraydialogSceneId.length-0+1),d.arraydialogSceneId.push(a),d.arraydialogSceneId.sort(d.sortNumber),b=$("ivs_p_dtr_template").clone(),b.removeClass("fn-hide"),b.setProperty("id","ivs_p_dtr_"+a),(f+1)%2==1&&b.addClass("ui-table-tr-odd"),b.getFirst("td").set("text",f+1),b.getFirst("td").setProperty("data-row",f+1),b.getFirst("td").setProperty("id","ivs_p_dtr_nm_"+a),e=b.getChildren("td")[1].getChildren("select")[0],e.setProperty("id","ivs_p_dtr_se_"+a),null!=g[k].Scene)for(c=0;c<g[k].Scene.length;c++)e.options.add(new Option(g[k].Scene[c].Name,g[k].Scene[c].PresetID));b.getChildren("td")[2].getChildren("input")[0].setProperty("id","ivs_p_dtr_ih_"+a),b.getChildren("td")[2].getChildren("input")[1].setProperty("id","ivs_p_dtr_im_"+a),b.getChildren("td")[2].getChildren("input")[2].setProperty("id","ivs_p_dtr_is_"+a),b.getChildren("td")[3].getChildren("i")[0].setProperty("id","ivs_p_dtr_up_"+a),b.getChildren("td")[3].getChildren("i")[1].setProperty("id","ivs_p_dtr_dn_"+a),b.getChildren("td")[4].getChildren("i").setProperty("id","ivs_p_dtr_de_"+a),b.inject("ivs_p_dialog_tbody"),$$("#ivs_p_dialog_tbody input").removeEvents("keyup"),$$("#ivs_p_dialog_tbody input").addEvent("keyup",function(){limit(this,59)})},dialogDelDom:function(a){var b=0;d.arraydialogSceneId.erase(parseInt(a));var c=$$("#ivs_p_dialog_tbody tr");if("ivs_p_dtr_template"==c[0].getProperty("id")){var e=$("ivs_p_dtr_de_"+a).getParent("td").getParent("tr");e.dispose()}else $("ivs_p_dtr_"+a).dispose();for(c=$$("#ivs_p_dialog_tbody tr"),b=0;b<c.length;b++)c[b].getFirst("td").set("text",b+1),c[b].getFirst("td").setProperty("data-row",b+1),c[b].removeClass("ui-table-tr-odd"),b%2==0&&c[b].addClass("ui-table-tr-odd")},dialogChangeDom:function(a,b){a-=1;var c=$$("#ivs_p_dialog_tbody tr");switch(b){case"up":a>0&&c[a].inject(c[a-1],"before");break;case"down":a<c.length-1&&c[a].inject(c[a+1],"after")}c=$$("#ivs_p_dialog_tbody tr");for(var d=0;d<c.length;d++)c[d].getFirst("td").set("text",d+1),c[d].getFirst("td").setProperty("data-row",d+1),c[d].removeClass("ui-table-tr-odd"),d%2==0&&c[d].addClass("ui-table-tr-odd")},dialogSaveData:function(){var a=[],b=$$("#setSceneLIst tr"),c=0,e=null;for(c=0;c<b.length;c++){var f={PresetID:1,Duration:30};f.PresetID=b[c].getChildren("td")[1].getChildren("select")[0].value-0,e=b[c].getChildren("td")[2].getChildren("input"),f.Duration=3600*(e[0].value-0)+60*(e[1].value-0)+(e[2].value-0),a.push(f)}d.dateItemSceneConfig.TourPath=a,d.dialogScene.close()},configChange:function(a){var b=""==a.target.id?a.target.parentNode.id:a.target.id,c=b.substr(0,10),e=b.substr(10,2),f=$$("#ivs_p_tbody .ui-table-tr-current")[0].getProperty("id").substr(10,2),g=$$("#ivs_tab_plan .ui-table-tab-current")[0].getProperty("data-li");switch(d.dateItemConfig=d.dataConfig[e-1],$$(".input-wrap").addClass("fn-hide"),$$("span.func-time").removeClass("fn-hide"),c){case"ivs_p_set_":d.dialogScene.show(),d.dialogRenderDom(g,e-1);break;case"ivs_p_ts_i":case"ivs_p_ts_s":$("ivs_p_ts_s"+e).addClass("fn-hide"),$("ivs_p_ts_i"+e).removeClass("fn-hide");break;case"ivs_p_te_s":case"ivs_p_te_i":$("ivs_p_te_s"+e).addClass("fn-hide"),$("ivs_p_te_i"+e).removeClass("fn-hide");break;case"ivs_p_del_":d.domReset(e),d.dataReset(g,e)}d.dataSync(e),d.dataSync(f),$("ivs_p_wrap"+f).removeClass("ui-table-tr-current"),$("ivs_p_wrap"+e).addClass("ui-table-tr-current")},domReset:function(a){$("ivs_p_ts_i"+a).getChildren("input")[0].value="00",$("ivs_p_ts_i"+a).getChildren("input")[1].value="00",$("ivs_p_te_i"+a).getChildren("input")[0].value="00",$("ivs_p_te_i"+a).getChildren("input")[1].value="00",d.dataSync(a)},dataReset:function(){d.dateItemConfig.TimeSection="1 00:00:00-00:00:00",d.dateItemConfig.MultiScene.TourPath=[]},dataSync:function(a){var b="#ivs_p_wrap"+a+" input",c=$$(b),e=$("ivs_p_ts_s"+a),f=$("ivs_p_te_s"+a),g=time1_m=time1_s=time2=time2_m=time2_s=Timesec="",h=t2=0;time1_m=c[0].value-0<10?"0"+(c[0].value-0):c[0].value,time1_s=c[1].value-0<10?"0"+(c[1].value-0):c[1].value,time1_s="24"==time1_m?"00":time1_s,g=time1_m+":"+time1_s,time2_m=c[2].value-0<10?"0"+(c[2].value-0):c[2].value,time2_s=c[3].value-0<10?"0"+(c[3].value-0):c[3].value,time2_s="24"==time2_m?"00":time2_s,time2=time2_m+":"+time2_s,h=time1_s-0+60*(time1_m-0),t2=time2_s-0+60*(time2_m-0),t2<h&&(time2=g,c[2].value=c[0].value,c[3].value=c[1].value),e.set("text",g),f.set("text",time2),Timesec="1 "+g+":00-"+time2+":00",d.dataConfig[a-1].TimeSection=Timesec,d.schduleRender()},navChange:function(a){var b=$$("#ivs_p_nav .ui-table-tab-current")[0].getProperty("data-li"),c=a.target.attributes["data-li"].value;$$("#ivs_p_nav .ui-table-tab-current").removeClass("ui-table-tab-current"),$(this).addClass("ui-table-tab-current"),$("ivs_p_day"+b).disabled="",$("ivs_p_day"+c).disabled="disabled",$("ivs_p_input_dayall").checked=!1,$("ivs_p_input_dayall").fireEvent("click"),d.dataConfig=d.allConfig[c],d.dataRenderNavChange()},dataRenderNavChange:function(){var a=0,b=0,c=[];for(a=0;16>a;a++)b=a+1,c=d.dataChangeTI(d.dataConfig[a].TimeSection),$("ivs_p_ts_i"+b).getChildren("input")[0].value=c[0],$("ivs_p_ts_i"+b).getChildren("input")[1].value=c[1],$("ivs_p_te_i"+b).getChildren("input")[0].value=c[2],$("ivs_p_te_i"+b).getChildren("input")[1].value=c[3],$("ivs_p_ts_s"+b).set("text",c[0]+":"+c[1]),$("ivs_p_te_s"+b).set("text",c[2]+":"+c[3])},dataChangeTI:function(a){var b=[];return b[0]=a.substr(2,2),b[1]=a.substr(5,2),b[2]=a.substr(11,2),b[3]=a.substr(14,2),b},sortNumber:function(a,b){return a-b},translate:function(){}}}();var G=null,H=null,I=null,J=[],K="";!function(){var b=$("ivs_tab_lane"),c=Page.ivsSDConfig.Tab.lane={trTemplate:'<tr uuid="{number}" class="{odd}"><td class="ivs-lane-name fn-widp70">{name}</td><td class="fn-widp15"><a href="javascript:void(0)" class="ivs-redraw"></a></td><td class="fn-widp15"><a href="javascript:void(0)" class="ivs-delete"></a></td></tr>',currentTr:null,$:function(a){return b.getElements(a)[0]||null},init:function(){b=$("ivs_tab_lane"),c.translate(),c.bind()},translate:function(){},render:function(){Page.ivsSDConfig._openIVSVideo.delay(10,"","ivs_lane_vedio"),Page.ivsSDConfig.ConfigManager.getConfig(["IntelliTrackScene","VideoAnalyseGlobal"]).done(function(a){if(a[0].result&&(I=a[0].params.table[k]),a[1].result){var b=a[1].params.table;K=b[k].Scene.Detail.PlateHints,delete b[k].Scene.Detail.PlateHints;var d=c._json2Array(b);a[1].params.table=d,a[1].TrafficLane=!0,H=a[1].params.table,G=a[1]}c._renderSenceSelect(),c._renderlaneType(0)})},bind:function(){c.$("#ivs_lane_senceSelect").addEvent("change",c._changeSence),c.$(".ivs-lane-tbody").addEvent("click",c.laneTableHandler),c.$("#ivs_lane_draw").addEvent("click",c._drawWinlane),c.$("#ivs_lane_confirm").addEvent("click",c._saveLanes),c.$("#ivs_lane_refresh").addEvent("click",c._refleshLanes)},_renderSenceSelect:function(){c.$("#ivs_lane_senceSelect").innerHTML="";for(var a=0;a<I.Scene.length;a++){var b=I.Scene[a];c.$("#ivs_lane_senceSelect").options.add(new Option(b.Name,b.PresetID))}c.$("#ivs_lane_senceSelect").fireEvent("change"),c._showlaneByName()},_changeSence:function(){var a=this.selectedIndex;if(q=a,Page.ivsSDConfig._isgotoScene(this.value-0),0==a&&(a=""),J=H[k][0]["Scene"+a],!J){var b={Dejitter:!1,Type:"Traffic",Jitter:50,Detail:{Lanes:[],ReportMode:"all",PlateMatch:80,Type:"Junction"}};H[k][0]["Scene"+a]=b,J=H[k][0]["Scene"+a]}var d=$unlink(G);d.params.table[0][0]={},d.params.table[0][0]["Scene"+a]=J,$("ocx")&&$("ocx").SetIVSConfig(JSON.encode(d),0),$("ocx")&&$("ocx").SetCurPtzID(a-0),c._renderlaneTable()},_saveLanes:function(){var b=c._array2Json(H);b[0].Scene.Detail.PlateHints=K,Page.ivsSDConfig.ConfigManager.setConfig("VideoAnalyseGlobal",b).done(function(){remarkDisplay("ivs_lane_remark",a("Succeed in saving configure"),3e3,0)}).fail(function(){remarkDisplay("ivs_lane_remark",a("Saving failure"),3e3,1)})},_refleshLanes:function(){Page.ivsSDConfig.ConfigManager.getConfig(["VideoAnalyseGlobal"]).done(function(b){if(b[0].result){var d=b[0].params.table;K=d[0].Scene.Detail.PlateHints,delete d[0].Scene.Detail.PlateHints;var e=c._json2Array(d);b[0].params.table=e,b[0].TrafficLane=!0,H=b[0].params.table}c.$("#ivs_lane_senceSelect").fireEvent("change"),c._renderlaneType(0),remarkDisplay("ivs_lane_remark",a("Operateingsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_lane_remark",a("Operateingfailure"),3e3,1)})},_json2Array:function(a){for(var b=[],c=null,d=0;d<a.length;d++)c=[a[d]],b.push(c);return b},_array2Json:function(a){for(var b=[],c=null,d=0;d<a.length;d++)c=a[d],b.push(c[0]);return b},_getLineMessage:function(a){if(a){var b={};b.LeftLineType=a.LeftLineType,b.RightLineType=a.RightLineType,b.LeftLine=a.LeftLine,b.RightLine=a.RightLine,b.DetectLine=a.DetectLine,b.Number=a.Number;var d=c._findItemFromLanes(b.Number);void 0!=d?c._updateItemByIndex(d,b):c._extendLanes(b.Number,b)}},_getNumber:function(){var a=0,b=J.Detail.Lanes;return b.each(function(b){return b.Number!=a?a:void a++}),a},_extendLanes:function(a,b){var c=J.Detail.Lanes;J.Detail.Lanes=c.slice(0,a).concat(b).concat(c.slice(a))},_getLineColor:function(){var a=c.$("#ivs_lane_leftlane").value;a="WhiteSolid"==a?0:"WhiteDotted"==a?1:2;var b=c.$("#ivs_lane_rightlane").value;return b="WhiteSolid"==b?0:"WhiteDotted"==b?1:2,{leftLineColor:a,rightLineColor:b}},_drawWinlane:function(){var b=J.Detail.Lanes;if(b.length>=10)return remarkDisplay("ivs_lane_remark",a("车道线数已达到最大数量"),3e3,1),!1;var d=c._getNumber(),e=a("w_lane")+"@"+d,f=c.$("#ivs_lane_senceSelect").selectedIndex-0,g=c._getLineColor(),h={LeftLineType:"WhiteSolid",RightLineType:"WhiteSolid",LeftLine:[[],[]],RightLine:[[],[]],Number:d};c._getLineMessage(h),c._renderlaneTable(),$("ocx").AddShape(0,"TrafficLane",e,0,f),$("ocx").SetLineProperty(a("w_lane")+d,g.leftLineColor,0,0,"eLeftLane"),$("ocx").SetLineProperty(a("w_lane")+d,g.rightLineColor,0,0,"eRightLane")},laneTableHandler:function(a){var b=a.target;c._laneTableSelect(b),b.hasClass("ivs-redraw")?c._redrawlaneByName():b.hasClass("ivs-delete")?c._deletelaneByName():b.hasClass("ivs-dLine")&&c._addDetectLine()},_addDetectLine:function(){var b=c.currentTr.getProperty("uuid")-0,d=a("w_lane")+b+"_line",e=$("ivs_lane_senceSelect").selectedIndex-0;return 0==J.Detail.Lanes[b].LeftLine[0].length?void remarkDisplay("ivs_lane_remark",a("请先绘制当前车道线，再绘制检测线"),3e3,1):($("ocx")&&$("ocx").DeleteShape(d),void($("ocx")&&$("ocx").AddShape(0,"TrafficLane",d,-1,e)))},_laneTableSelect:function(a){var d=a;"TR"!=d.tagName&&(d=d.getParent("tr"));var e=b.getElements(".ivs-lane-tbody tr");e.removeClass("ui-table-tr-current"),d.addClass("ui-table-tr-current"),c.currentTr=d,c._showlaneByName(),a.hasClass("ivs-redraw")||c._renderlaneType(c.currentTr.getProperty("uuid")-0)},_findItemFromLanes:function(a){if(J)for(var b=J.Detail.Lanes,c=0;c<b.length;c++)if(b[c].Number==a)return c},_updateItemByIndex:function(a,b){if(J){var c=J.Detail.Lanes;c[a].LeftLine=b.LeftLine,c[a].LeftLineType=b.LeftLineType,c[a].Number=b.Number,c[a].RightLine=b.RightLine,c[a].RightLineType=b.RightLineType,c[a].DetectLine=b.DetectLine}},_removeItemFromLanes:function(a){var b=J.Detail.Lanes;a-=0,J.Detail.Lanes=b.slice(0,a).concat(b.slice(a+1))},_getlaneName:function(){return c.currentTr?c.currentTr.getElements(".ivs-lane-name")[0].innerHTML:""},_deletelaneByName:function(){if(confirm("确定要删除此项么？")){var a=(J.Detail.Lanes,c._findItemFromLanes(c.currentTr.getProperty("uuid")));c._removeItemFromLanes(a),$("ocx").DeleteShape(c._getlaneName()),c._renderlaneTable()}},_showlaneByName:function(){$("ocx").SetCurShape(c._getlaneName())},_redrawlaneByName:function(){var b=(J.Detail.Lanes,c.currentTr.getProperty("uuid")),d=c._findItemFromLanes(b);c._removeItemFromLanes(d);var e=a("w_lane")+"@"+b,f=c._getLineColor();$("ocx").ReDrawCurShape("TrafficLane",e),$("ocx").SetLineProperty(c._getlaneName(),f.leftLineColor,0,0,"eLeftLane"),$("ocx").SetLineProperty(c._getlaneName(),f.rightLineColor,0,0,"eRightLane")},_renderlaneType:function(a){var b=c._findItemFromLanes(a);void 0!=b&&(c.$("#ivs_lane_leftlane").value=J.Detail.Lanes[b].LeftLineType,c.$("#ivs_lane_rightlane").value=J.Detail.Lanes[b].RightLineType)},createEl:function(a){return document.createElement(a)},_renderlaneTable:function(){if(trNode=null,tdNode1=null,tdNode2=null,tdNode3=null,redrawNode=null,deleteNode=null,J){J.Detail.Lanes||(J.Detail.Lanes=[]);var b=J.Detail.Lanes;c.$(".ivs-lane-tbody").empty();for(var d=0;d<b.length;d++)lane=b[d],trNode=c.createEl("tr"),trNode.setAttribute("uuid",lane.Number),trNode.className=d%2?"ui-table-tr-odd":"",tdNode1=c.createEl("td"),tdNode1.innerHTML=a("w_lane")+lane.Number,tdNode1.className="ivs-lane-name fn-widp55",tdNode2=c.createEl("td"),tdNode2.className="fn-widp15",redrawNode=c.createEl("a"),redrawNode.className="ivs-redraw",redrawNode.href="javascript:void(0)",tdNode2.appendChild(redrawNode),tdNode4=c.createEl("td"),tdNode4.className="fn-widp15",redrawNode=c.createEl("a"),redrawNode.className="ivs-dLine",redrawNode.href="javascript:void(0)",tdNode4.appendChild(redrawNode),tdNode3=c.createEl("td"),tdNode3.className="fn-widp15",deleteNode=c.createEl("a"),deleteNode.className="ivs-delete",deleteNode.href="javascript:void(0)",tdNode3.appendChild(deleteNode),trNode.appendChild(tdNode1),trNode.appendChild(tdNode2),trNode.appendChild(tdNode4),trNode.appendChild(tdNode3),c.$(".ivs-lane-tbody").appendChild(trNode)}},setFilterValue:function(a){var b=JSON.decode(a)[0].config.Lanes[0];c._getLineMessage(b),c._renderlaneTable()}}}(),function(){var c=null,d=null,e=null,f=null,g=null,i=null,j=[],l=1,m=0,n=Page.ivsSDConfig.Tab.global={init:function(){n.configManager=b.ConfigManager,n.iDevIpcIntelligence=b.DevVideoAnalyse,n.ivsCap=b.DevVideoAnalyse,n.translate(),n.bind()},translate:function(){$("ivs_tab_global").translation()},bind:function(){$("ivs_AddScaleArea").addEvents({click:function(){"hidden"==$("ivs_ScaleAreaShow").getStyle("visibility")?($("ocx")&&$("ocx").SetCalibrateAndRules("CalibrateArea",0,!0),$("ivs_ScaleAreaShow").setStyle("visibility","visible")):remarkDisplay("ivs_global_remark",a("w_areaError"),3e3,1)}}),$("ivs_DeleteScaleArea").addEvent("click",function(){$("ivs_ScaleAreaCheck").hasClass("scale_current")&&($("ivs_ScaleAreaShow").setStyle("visibility","hidden"),$("ivs_ScaleAreaCheck").removeClass("scale_current"),$("ocx")&&$("ocx").SetCalibrateAndRules("CalibrateArea",0,!1),e=null,h[k][n._getCalibrateArea()][0]=e,c=$unlink(h),$("ivs_ScaleListShow").empty(),j.empty(),n.disableStaffOperation())});var b=$("ivs_scaleContent");$("ivs_AddScale").addEvent("click",function(){if(!this.hasClass("ui-button-disabled")){if("hidden"==$("ivs_ScaleAreaShow").getStyle("visibility")||!e)return void remarkDisplay("ivs_global_remark",a("w_areadraw"),3e3,1);if(j.contains("Horizontal")&&!$("scaleVertical").checked)return void remarkDisplay("ivs_global_remark",a("w_horizontalError"),3e3,1);if(3==j.length&&0==$unlink(j).erase("Vertical").length&&$("scaleVertical").checked||4==j.length)return void remarkDisplay("ivs_global_remark",a("w_verticalError"),3e3,1);if(!e.Staffs&&j.length||e.Staffs&&j.length!=e.Staffs.length)return void remarkDisplay("ivs_global_remark",a("Please draw shape"),3e3,1);n.saveCurrentStaff();var c=$("scaleVertical").checked?"Vertical":"Horizontal",d=0;j.each(function(a){a==c&&d++}),j.push(c),$("ocx")&&$("ocx").SetCalibrateAndRules(c,0,!0),$("ivs_ScaleListShow").getElements("i.scale_bottom_icon").set("class","scale_main_icon"),b.getElements("a").removeClass("scale_current");var f=new Element("span",{name:c});f.innerHTML='<div class="fn-clear scale-region"><i class="scale_bottom_icon"></i><a href="javascript:;" class="scale_current" data-staffIndex="'+(j.length-1)+'" scale-index="'+d+'" data-type="'+c+'">'+a("w_"+c)+"</a></div>",f.inject($("ivs_ScaleListShow")),$("scaleLength").value=l}}),$("ivs_DeleteScale").addEvent("click",function(){if(!this.hasClass("ui-button-disabled")){var c=b.getElement("#ivs_ScaleListShow a.scale_current");if(!c)return void remarkDisplay("ivs_global_remark",a("pleaseSelectStaff"),3e3,1);var d=c.getProperty("data-type"),e=parseInt(c.getProperty("scale-index"));$("ocx")&&$("ocx").SetCalibrateAndRules(d,e,!1),c.getParent("span").destroy();for(var f=0,g=0;g<j.length&&(j[g]!=d||(f++,f!=e+1));g++);j.splice(g,1);var h=$$("#ivs_ScaleListShow a"),i=$$("#ivs_ScaleListShow span").getProperty("name"),k=0;j.each(function(a,b){var c=0;"Vertical"==i[b]&&(c=k++),h[b].setProperties({"scale-index":c,"data-staffIndex":b})}),$("ivs_ScaleListShow").getLast()&&$("ivs_ScaleListShow").getLast().getElements("i").set("class","scale_bottom_icon")}}),b.addEvent("click:relay([data-toggle])",function(){var a,b,c,c=this.getProperty("data-toggle"),d=this.getParent().getNext("span");"fold"==c?(a="visible",b="scale_icon_hide",c="unfold"):(a="hidden",b="scale_icon_show",c="fold"),d.setStyle("visibility",a),$("ivs_ScaleIcon").setProperty("class",b),this.setProperty("data-toggle",c)}),b.addEvent("click:relay(a)",function(){var a=this.getProperty("data-type"),c=null,d=this.getProperty("scale-index")||0;d=parseInt(d),n.saveCurrentStaff(),b.getElements("a").removeClass("scale_current"),this.addClass("scale_current"),"Horizontal"==a||"Vertical"==a?(c=n.getStaff(a,d),$("ivs_global_staffType").getElement("input[value="+a+"]").checked=!0,$("scaleLength").setProperty("disabled",!1).value=c.Length):$("scaleLength").setProperty("disabled",!0),$("ocx")&&$("ocx").SelectRule(a,d)}),$("ivs_scaleCheck").addEvent("click",function(){return e&&e.Area&&e.Staffs&&4==e.Staffs.length?($$("#ivs_ScaleListShow a").removeClass("scale_current"),scaleCheckNum=$("ivs_scaleValue").value-0,void($("ocx")&&$("ocx").SetCalibrateAndRules("CheckedLength",scaleCheckNum,!0))):void remarkDisplay("ivs_global_remark",a("w_scaleAll"),3e3,1)}),$("ivs_global_choiceScene").addEvent("change",n._sceneChange),$("ivs_global_default").addEvent("click",n._onDefaultClick),$("ivs_global_refresh").addEvent("click",n._onRefreshClick),$("ivs_global_confirm").addEvent("click",n._onConfirmClick),attachLimit("scaleLength",1,10)},render:function(){n.configManager.getConfig(["VideoAnalyseGlobal","IntelliTrackScene"]).done(function(a){var b=a[1].params.table[0].Scene;n._renderSceneList(b),h=a[0].params.table,c=$unlink(h),n._renderGlobalElements(0)}),n.ivsCap.getCaps().done(function(a){d=a,n.saveMaxPoint()}),Page.ivsSDConfig._openIVSVideo.delay(10,"","ivs_global_video")},_renderSceneList:function(a){var b=$("ivs_global_choiceScene");b.empty(),a.each(function(a,c){var d=new Option(a.Name,c+"_"+a.PresetID);b.options.add(d)})},_getCalibrateArea:function(){var a=$("ivs_global_choiceScene").value.split("_")[0]-0,b=0==a?"CalibrateArea":"CalibrateArea"+a;return b},_sceneChange:function(){var a=$("ivs_global_choiceScene").value.split("_");q=a[0]-0;var b=a[1]-0;Page.ivsSDConfig._gotoScene(b),n._renderGlobalElements()},_pointSceneNow:function(){var a=$("ivs_global_choiceScene");a.getElements("option").each(function(b,c){var d=b.value.split("_")[0]-0;return d==q?void(a.selectedIndex=c):void 0})},_renderGlobalElements:function(){$("ocx").SetCurPtzID(0),n._pointSceneNow(),n._renderScale(),$("scaleVertical").checked=!0,function(){n._buildAnalyseGlobal(),$("ocx")&&$("ocx").SetIVSConfig(f,0),$("ocx")&&$("ocx").SubVideoWndCtrl(12,1)}.delay(50)},_buildAnalyseGlobal:function(){var a=h[m][n._getCalibrateArea()]||[];e=a[0]||{};var b={result:!0,params:{table:[a]}};f=JSON.encode(b)},_renderScale:function(){var b=h[m][n._getCalibrateArea()]||[],c=b[0];if(j.empty(),$("ivs_ScaleListShow").empty(),!c||!c.Area)return void $("ivs_ScaleAreaShow").setStyle("visibility","hidden");$("ivs_ScaleAreaShow").setStyle("visibility","visible");var d="",e=0;c.Staffs&&c.Staffs.each(function(b,c){var f=0;f="Horizontal"==b.Type?0:e++,d+="<span name="+b.Type+'><div class="fn-clear scale-region"><i class="scale_main_icon"></i><a href="javascript:;" data-staffIndex="'+c+'" scale-index="'+f+'" data-type="'+b.Type+'">'+a("w_"+b.Type)+"</a></div></span>",j.push(b.Type),"Vertical"==b.Type?($("scaleLength").value=b.Length,g=b.Length):i=b.Length}),$("ivs_ScaleListShow").innerHTML=d,$("ivs_ScaleListShow").getLast().getElements("i").set("class","scale_bottom_icon")},getStaff:function(a,b){var c=e.Staffs,d=c.filter(function(b){return b.Type==a});return d[b]},saveCurrentStaff:function(){var a=$("ivs_ScaleListShow").getElement("a.scale_current");if(a&&e.Staffs){var b=parseInt(a.getProperty("data-staffIndex")),c=parseFloat($("scaleLength").value);e.Staffs[b].Length=isNaN(c)?l:c}},OutPutGlobalCalibrateInfo:function(a){e=JSON.decode(a);var b=e.Staffs,c=h[m][n._getCalibrateArea()]||[];if(b){var d=c[0]||{},f=d.Staffs;b&&f&&b.each(function(a,b){var c=l;f[b]&&(c=f[b].Length),a.Length=c})}else e.Area.length>0&&n.enableStaffOperation();c[0]=e,h[m][n._getCalibrateArea()]=c},OutPutCheckedInfo:function(a){var b=JSON.decode(a),c=b.CheckedLength[0],d=b.CheckedLength[1];if(0==scaleCheckNum)var e="Horizontal";else var e="Vertical";n.iDevIpcIntelligence.testCalibrateWithScreenPoints(e,c,d,function(a,b){b.result&&$("ocx")&&$("ocx").GetLength(b.params.length.toFixed(2))})},_setScaleLength:function(){$("scaleLength").disabled=!0,!j.contains("Vertical")&&$("scaleVertical").checked&&($("scaleLength").disabled=!1),j.contains("Horizontal")||$("scaleVertical").checked||($("scaleLength").disabled=!1),n._bindScaleLength(),n._putScaleLength()},disableStaffOperation:function(){$("ivs_global_staffType").getElements("input[name=scaleLine]").setProperty("disabled",!0),$("scaleLength").disabled=!0,$("ivs_AddScale").addClass("ui-button-disabled"),$("ivs_DeleteScale").addClass("ui-button-disabled")},enableStaffOperation:function(){$("ivs_global_staffType").getElements("input[name=scaleLine]").setProperty("disabled",!1),$("scaleLength").disabled=!1,$("ivs_AddScale").removeClass("ui-button-disabled"),$("ivs_DeleteScale").removeClass("ui-button-disabled")},_bindScaleLength:function(){$("scaleLength").addEvent("blur",function(){$("scaleVertical").checked?g=$("scaleLength").value-0:i=$("scaleLength").value-0})},_putScaleLength:function(){g||(g=1),i||(i=1),$("scaleLength").value=$("scaleVertical").checked?g:i},saveMaxPoint:function(){var a=d.MaxPointOfLine,b=d.MaxPointOfRegion;$("ocx")&&$("ocx").SetMaxPntNum(a,b)},_onDefaultClick:function(){n.configManager.getDefault(["VideoAnalyseGlobal"]).done(function(b){h=b[0].params.table,c=$unlink(h),n._renderGlobalElements(0),remarkDisplay("ivs_global_remark",a("Defaultsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_global_remark",a("Defaultfailure"),3e3,1)})},_saveGlobalScale:function(){e&&n.saveCurrentStaff()},_onRefreshClick:function(){n.configManager.getConfig(["VideoAnalyseGlobal"]).done(function(b){h=b[0].params.table,c=$unlink(h),n._renderGlobalElements(0),remarkDisplay("ivs_global_remark",a("Operateingsuccess"),3e3,0)}).fail(function(){remarkDisplay("ivs_global_remark",a("Operateingfailure"),3e3,1)})},_onConfirmClick:function(){return e&&e.Area&&e.Staffs&&4==e.Staffs.length||!e?"visible"==$("ivs_ScaleAreaShow").getStyle("visibility")&&$$("#ivs_ScaleListShow span").length<4?void remarkDisplay("ivs_global_remark",a("w_areadraw"),3e3,1):(n._saveGlobalScale(),void n.configManager.setConfig(["VideoAnalyseGlobal"],[h]).done(function(b){c=$unlink(h),remarkDisplay("ivs_global_remark",a("Succeed in saving configure"),3e3,0),isNeedReboot(b,"The configration take effect! The device is restarting now,please reconnect later...",!1,!1)}).fail(function(){remarkDisplay("ivs_global_remark",a("Saving failure"),3e3,1)})):void remarkDisplay("ivs_global_remark",a("w_scaleAll"),3e3,1)}}}()})}();